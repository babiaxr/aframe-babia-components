(function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId]){return installedModules[moduleId].exports}var module=installedModules[moduleId]={i:moduleId,l:false,exports:{}};modules[moduleId].call(module.exports,module,module.exports,__webpack_require__);module.l=true;return module.exports}__webpack_require__.m=modules;__webpack_require__.c=installedModules;__webpack_require__.i=function(value){return value};__webpack_require__.d=function(exports,name,getter){if(!__webpack_require__.o(exports,name)){Object.defineProperty(exports,name,{configurable:false,enumerable:true,get:getter})}};__webpack_require__.n=function(module){var getter=module&&module.__esModule?function getDefault(){return module["default"]}:function getModuleExports(){return module};__webpack_require__.d(getter,"a",getter);return getter};__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)};__webpack_require__.p="";return __webpack_require__(__webpack_require__.s=23)})([function(module,exports){if(typeof AFRAME==="undefined"){throw new Error("Component attempted to register before AFRAME was available.")}AFRAME.registerComponent("babia-filter",{schema:{from:{type:"string"},filter:{type:"string"},data:{type:"string"}},multiple:false,init:function(){},update:function(oldData){let data=this.data;let el=this.el;let self=this;if(data.data&&oldData.data!==data.data){let rawData=parseEmbeddedJSONData(data.data);let dataFiltered=filterData(data,rawData);self.babiaData=dataFiltered;self.babiaMetadata={id:self.babiaMetadata.id++};dataReadyToSend("babiaData",self)}else{if(data.from!==oldData.from){if(self.querierComponent){self.querierComponent.unregister(el)}findQuerier(data,el,self);el.addEventListener("babiaQuerierDataReady",function(e){self.querierDataPropertyName=e.detail;let rawData=self.querierComponent[self.querierDataPropertyName];let dataFiltered=filterData(data,rawData);self.babiaData=dataFiltered;self.babiaMetadata={id:self.babiaMetadata.id++};dataReadyToSend("babiaData",self)});self.querierComponent.register(el)}if(oldData.filter&&data.filter!==oldData.filter){let rawData=self.querierComponent[self.querierDataPropertyName];let dataFiltered=filterData(data,rawData);self.babiaData=dataFiltered;self.babiaMetadata={id:self.babiaMetadata.id++};dataReadyToSend("babiaData",self)}}},remove:function(){},pause:function(){},play:function(){},querierComponent:undefined,querierDataPropertyName:"babiaData",babiaData:undefined,babiaMetadata:{id:0},register:function(interestedElem){let el=this.el;this.interestedElements.push(interestedElem);if(this.babiaData){dispatchEventOnElement(interestedElem,"babiaData")}},unregister:function(interestedElem){const index=this.interestedElements.indexOf(interestedElem);if(index>-1){this.interestedElements.splice(index,1)}},interestedElements:[]});let filterData=(data,rawData)=>{let filter=data.filter.split("=");if(filter[0]&&filter[1]){let dataFiltered=rawData.filter(key=>key[filter[0]]==filter[1]);return dataFiltered}else{console.error("Error on filter, please use key=value syntax");return[]}};let findQuerier=(data,el,self)=>{if(data.from){let querierElement=document.getElementById(data.from);if(querierElement.components["babia-queryjson"]){self.querierComponent=querierElement.components["babia-queryjson"]}else if(querierElement.components["babia-queryes"]){self.querierComponent=querierElement.components["babia-queryes"]}else if(querierElement.components["babia-querygithub"]){self.querierComponent=querierElement.components["babia-querygithub"]}else{console.error("Problem registering to the querier");return}}else{if(el.components["babia-queryjson"]){self.querierComponent=el.components["babia-queryjson"]}else if(el.components["babia-queryes"]){self.querierComponent=el.components["babia-queryes"]}else if(el.components["babia-querygithub"]){self.querierComponent=el.components["babia-querygithub"]}else{if(document.querySelectorAll("[babia-queryjson]").length>0){self.querierComponent=document.querySelectorAll("[babia-queryjson]")[0].components["babia-queryjson"]}else if(document.querySelectorAll("[babia-queryjson]").length>0){self.querierComponent=document.querySelectorAll("[babia-queryes]")[0].components["babia-queryes"]}else if(document.querySelectorAll("[babia-querygithub]").length>0){self.querierComponent=document.querySelectorAll("[babia-querygithub]")[0].components["babia-querygithub"]}else{console.error("Error, querier not found");return}}}};let parseEmbeddedJSONData=embedded=>{let dataRetrieved=JSON.parse(embedded);return dataRetrieved};let dataReadyToSend=(propertyName,self)=>{self.interestedElements.forEach(element=>{dispatchEventOnElement(element,propertyName)})};let dispatchEventOnElement=(element,propertyName)=>{element.emit("babiaFilterDataReady",propertyName)}},function(module,exports){if(typeof AFRAME==="undefined"){throw new Error("Component attempted to register before AFRAME was available.")}AFRAME.registerComponent("babia-treebuilder",{schema:{from:{type:"string"},field:{type:"string"},split_by:{type:"string"},data:{type:"string"}},multiple:false,init:function(){},update:function(oldData){let data=this.data;let el=this.el;let self=this;if(data.data&&oldData.data!==data.data){let rawData=parseEmbeddedJSONData(data.data);let dataTreeFormat=generateTree(data,rawData);self.babiaData=dataTreeFormat;self.babiaMetadata={id:self.babiaMetadata.id++};dataReadyToSend("babiaData",self)}else{if(data.from!==oldData.from){if(self.dataComponent){self.dataComponent.unregister(el)}let eventName=findDataComponent(data,el,self);if(self.dataComponentEventName&&self.dataComponentEventName!==eventName){el.removeEventListener(self.dataComponentEventName,_listener,true)}self.dataComponentEventName=eventName;el.addEventListener(self.dataComponentEventName,_listener=(e=>{self.dataComponentDataPropertyName=e.detail;let rawData=self.dataComponent[self.dataComponentDataPropertyName];let dataTreeFormat=generateTree(data,rawData);self.babiaData=dataTreeFormat;self.babiaMetadata={id:self.babiaMetadata.id++};dataReadyToSend("babiaData",self)}));self.dataComponent.register(el);return}if(oldData.split_by&&data.split_by!==oldData.split_by||oldData.field&&data.field!==oldData.field){let rawData=self.dataComponent[self.dataComponentDataPropertyName];let dataTreeFormat=generateTree(data,rawData);self.babiaData=dataTreeFormat;self.babiaMetadata={id:self.babiaMetadata.id++};dataReadyToSend("babiaData",self)}}},remove:function(){},pause:function(){},play:function(){},dataComponent:undefined,dataComponentDataPropertyName:"babiaData",dataComponentEventName:undefined,babiaData:undefined,babiaMetadata:{id:0},register:function(interestedElem){let el=this.el;this.interestedElements.push(interestedElem);if(this.babiaData){dispatchEventOnElement(interestedElem,"babiaData")}},unregister:function(interestedElem){const index=this.interestedElements.indexOf(interestedElem);if(index>-1){this.interestedElements.splice(index,1)}},interestedElements:[]});let findDataComponent=(data,el,self)=>{let eventName="babiaQuerierDataReady";if(data.from){let dataElement=document.getElementById(data.from);if(dataElement.components["babia-filter"]){self.dataComponent=dataElement.components["babia-filter"];eventName="babiaFilterDataReady"}else if(dataElement.components["babia-queryjson"]){self.dataComponent=dataElement.components["babia-queryjson"]}else if(dataElement.components["babia-queryes"]){self.dataComponent=dataElement.components["babia-queryes"]}else if(dataElement.components["babia-querygithub"]){self.dataComponent=dataElement.components["babia-querygithub"]}else{console.error("Problem registering to the querier");return}}else{if(el.components["babia-filter"]){self.dataComponent=el.components["babia-filter"];eventName="babiaFilterDataReady"}else if(el.components["babia-queryjson"]){self.dataComponent=el.components["babia-queryjson"]}else if(el.components["babia-queryes"]){self.dataComponent=el.components["babia-queryes"]}else if(el.components["babia-querygithub"]){self.dataComponent=el.components["babia-querygithub"]}else{if(document.querySelectorAll("[babia-filter]").length>0){self.dataComponent=document.querySelectorAll("[babia-filter]")[0].components["babia-filter"];eventName="babiaFilterDataReady"}else if(document.querySelectorAll("[babia-queryjson]").length>0){self.dataComponent=document.querySelectorAll("[babia-queryjson]")[0].components["babia-queryjson"]}else if(document.querySelectorAll("[babia-queryjson]").length>0){self.dataComponent=document.querySelectorAll("[babia-queryes]")[0].components["babia-queryes"]}else if(document.querySelectorAll("[babia-querygithub]").length>0){self.dataComponent=document.querySelectorAll("[babia-querygithub]")[0].components["babia-querygithub"]}else{console.error("Error, querier not found");return}}}return eventName};function generateTree(data,paths){let tree=[];for(let i=0;i<paths.length;i++){let path=paths[i][data.field].split(data.split_by);let currentLevel=tree;for(let j=0;j<path.length;j++){if(!path[j]){continue}let part=path[j];let existingPath=findWhere(currentLevel,"id",part);if(existingPath){currentLevel=existingPath.children}else{let newPart={};if(j===path.length-1){newPart=paths[i]}else{newPart["children"]=[]}newPart["id"]=part;currentLevel.push(newPart);currentLevel=newPart.children}}}return tree;function findWhere(array,key,value){t=0;while(t<array.length&&array[t][key]!==value){t++}if(t<array.length){return array[t]}else{return false}}}let parseEmbeddedJSONData=embedded=>{let dataRetrieved=JSON.parse(embedded);return dataRetrieved};let dataReadyToSend=(propertyName,self)=>{self.interestedElements.forEach(element=>{dispatchEventOnElement(element,propertyName)})};let dispatchEventOnElement=(element,propertyName)=>{element.emit("babiaTreeDataReady",propertyName)}},function(module,exports){var debug=AFRAME.utils.debug;var coordinates=AFRAME.utils.coordinates;var warn=debug("components:babia-lookat:warn");var isCoordinates=coordinates.isCoordinates||coordinates.isCoordinate;delete AFRAME.components["babia-lookat"];AFRAME.registerComponent("babia-lookat",{schema:{default:"0 0 0",parse:function(value){if(isCoordinates(value)||typeof value==="object"){return coordinates.parse(value)}return value},stringify:function(data){if(typeof data==="object"){return coordinates.stringify(data)}return data}},init:function(){this.target3D=null;this.vector=new THREE.Vector3;this.cameraListener=AFRAME.utils.bind(this.cameraListener,this);this.el.addEventListener("componentinitialized",this.cameraListener);this.el.addEventListener("componentremoved",this.cameraListener)},update:function(){var self=this;var target=self.data;var targetEl;if(!target||typeof target==="object"&&!Object.keys(target).length){return self.remove()}if(typeof target==="object"){return this.lookAt(new THREE.Vector3(target.x,target.y,target.z))}targetEl=self.el.sceneEl.querySelector(target);if(!targetEl){warn('"'+target+'" does not point to a valid entity to babia-lookat');return}if(!targetEl.hasLoaded){return targetEl.addEventListener("loaded",function(){self.beginTracking(targetEl)})}return self.beginTracking(targetEl)},tick:function(){var vec3=new THREE.Vector3;return function(t){var target3D=this.target3D;if(target3D){target3D.getWorldPosition(vec3);this.lookAt(vec3)}}}(),remove:function(){this.el.removeEventListener("componentinitialized",this.cameraListener);this.el.removeEventListener("componentremoved",this.cameraListener)},beginTracking:function(targetEl){this.target3D=targetEl.object3D},cameraListener:function(e){if(e.detail&&e.detail.name==="camera"){this.update()}},lookAt:function(position){var vector=this.vector;var object3D=this.el.object3D;if(this.el.getObject3D("camera")){vector.subVectors(object3D.position,position).add(object3D.position)}else{vector.copy(position)}object3D.lookAt(vector)}})},function(module,exports){if(typeof AFRAME==="undefined"){throw new Error("Component attempted to register before AFRAME was available.")}let MAX_SIZE_BAR=10;AFRAME.registerComponent("babia-ui",{schema:{target:{type:"string"}},multiple:false,init:function(){console.log("WELCOME TO UI: Control your data.")},update:function(oldData){const self=this;let data=this.data;let el=this.el;let eventName=findVisualizerComponent(data,self);findQuerierComponents(self);if(self.targetComponent.visProperties){self.targetComponentVisProperties=self.targetComponent.visProperties}self.targetComponentEventName=eventName;el.addEventListener(self.targetComponentEventName,function _listener(e){console.log("Visualizer is Updated.");updateInterfaceEventCallback(self,e)});self.targetComponent.register(el)},targetComponent:undefined,targetComponentEventName:undefined,targetComponentVisProperties:undefined,dataMetrics:undefined,interface:undefined,dataQueriers:undefined,handController:undefined,dataComponentDataPropertyName:"babiaData"});let findQuerierComponents=self=>{self.dataQueriers=[];document.querySelectorAll("[babia-queryjson]").forEach(querier=>{if(querier.id!=self.data.target||querier.id==self.data.target&&!self.targetComponent.dataComponent.attrName=="babia-filter"){self.dataQueriers.push(querier.id)}});document.querySelectorAll("[babia-queryes]").forEach(querier=>{self.dataQueriers.push(querier.id)});document.querySelectorAll("[babia-querygithub]").forEach(querier=>{self.dataQueriers.push(querier.id)});document.querySelectorAll("[babia-filter]").forEach(querier=>{self.dataQueriers.push(querier.id)})};let findVisualizerComponent=(data,self)=>{let eventName="babiaVisualizerUpdated";if(data.target){let targetElement=document.getElementById(data.target);if(targetElement!=null){if(targetElement.components["babia-bars"]){self.targetComponent=targetElement.components["babia-bars"]}else if(targetElement.components["babia-barsmap"]){self.targetComponent=targetElement.components["babia-barsmap"]}else if(targetElement.components["babia-cyls"]){self.targetComponent=targetElement.components["babia-cyls"]}else if(targetElement.components["babia-cylsmap"]){self.targetComponent=targetElement.components["babia-cylsmap"]}else if(targetElement.components["babia-pie"]){self.targetComponent=targetElement.components["babia-pie"]}else if(targetElement.components["babia-doughnut"]){self.targetComponent=targetElement.components["babia-doughnut"]}else if(targetElement.components["babia-bubbles"]){self.targetComponent=targetElement.components["babia-bubbles"]}else if(targetElement.components["babia-city"]){self.targetComponent=targetElement.components["babia-city"]}else if(targetElement.components["babia-boats"]){self.targetComponent=targetElement.components["babia-boats"]}else{console.error("Visualizer not found.");return}}else{console.error("Target not exist.");return}}else{console.error("Error: Target not inserted. ");return}return eventName};let updateInterfaceEventCallback=(self,e)=>{self.dataComponentDataPropertyName=e.detail;if(self.targetComponent[e.detail].data){getDataMetrics(self,JSON.parse(self.targetComponent[e.detail].data),self.targetComponentVisProperties)}else{getDataMetrics(self,self.targetComponent[e.detail],self.targetComponentVisProperties)}while(self.el.firstChild)self.el.firstChild.remove();console.log("Generating interface...");if(document.querySelector("#babia-menu-hand")){let hand_ui=document.querySelector("#babia-menu-hand");hand_ui.parentNode.removeChild(hand_ui);insertInterfaceOnHand(self,self.handController)}else{self.interface=generateInterface(self,self.dataMetrics,self.el)}document.addEventListener("controllerconnected",event=>{while(self.el.firstChild)self.el.firstChild.remove();controller=event.detail.name;let hand=event.target.getAttribute(controller).hand;if(hand==="left"&&!document.querySelector("#babia-menu-hand")){self.handController=event.target.id;insertInterfaceOnHand(self,self.handController)}})};let insertInterfaceOnHand=(self,hand)=>{let hand_entity=document.getElementById(hand);let scale=.03;self.interface=generateInterface(self,self.dataMetrics,hand_entity);self.interface.id="babia-menu-hand";self.interface.setAttribute("scale",{x:scale,y:scale,z:scale});self.interface.setAttribute("position",{x:-scale*self.interface.width/2,y:scale*self.interface.height/2,z:-.1});self.interface.setAttribute("rotation",{x:-60});self.interface.setAttribute("rotation",{x:-60});self.interface.setAttribute("rotation",{x:-60});self.interface.setAttribute("rotation",{x:-60});self.interface.setAttribute("rotation",{x:-60});self.interface.setAttribute("rotation",{x:-60});self.interface.setAttribute("rotation",{x:-60});self.interface.setAttribute("rotation",{x:-60});self.interface.setAttribute("rotation",{x:-60});openCloseMenu(self.handController,self.interface)};let getDataMetrics=(self,data,properties)=>{self.dataMetrics=[];let number_properties=["height","radius","width","size","farea","fheight","area","depth"];let number_metrics=[];let last_child;if(self.targetComponent.attrName=="babia-city"){last_child=getLastChild(data)}else if(self.targetComponent.attrName=="babia-boats"){last_child=getLastChild(data[0])}else{last_child=data[0]}Object.keys(last_child).forEach(metric=>{if(typeof last_child[metric]=="number"){number_metrics.push(metric)}});properties.forEach(property=>{if(number_properties.includes(property)){self.dataMetrics.push({property:property,metrics:number_metrics})}else{self.dataMetrics.push({property:property,metrics:Object.keys(data[0])})}})};let getLastChild=data=>{if(data.children){child=getLastChild(data.children[0])}else{child=data}return child};let generateInterface=(self,metrics,parent)=>{self.interface=document.createElement("a-entity");self.interface.id="babia-menu";let posY=0;let posX=0;let maxX=0;if(self.dataQueriers.length>1){let button=createProperty("Data",posX,posY);self.interface.appendChild(button);self.dataQueriers.forEach(data=>{posX+=3.25;let button=createDataSelect(self,data,posX,posY);button.classList.add("babiaxraycasterclass");self.interface.appendChild(button)})}--posY;if(maxX<posX){maxX=posX}posX=0;metrics.forEach(property=>{let button=createProperty(property.property,posX,posY);self.interface.appendChild(button);property.metrics.forEach(metric=>{posX+=3.25;let button=createMetric(self,property.property,metric,posX,posY);button.classList.add("babiaxraycasterclass");self.interface.appendChild(button)});--posY;if(maxX<posX){maxX=posX}posX=0});self.interface.width=maxX+3;self.interface.height=Math.abs(posY);self.interface.setAttribute("position",{x:-self.interface.width/2,y:self.interface.height,z:0});parent.appendChild(self.interface);return self.interface};let createMetric=(self,property,metric,positionX,positionY)=>{let entity=document.createElement("a-box");entity.property=property;entity.metric=metric;entity.classList.add("babiaxraycasterclass");entity.setAttribute("position",{x:positionX,y:positionY,z:0});entity.setAttribute("rotation",{x:0,y:0,z:0});entity.setAttribute("height",.8);entity.setAttribute("width",3);entity.setAttribute("depth",.01);let text=document.createElement("a-entity");text.setAttribute("text",{value:metric,align:"center",width:"10",color:"black"});text.setAttribute("position","0 0 0.01");entity.appendChild(text);if(self.targetComponent.data[property]==metric){entity.setAttribute("color","#555555")}selection_events(entity,self.targetComponent,false);return entity};let selection_events=(entity,visualizer,isData)=>{entity.addEventListener("mouseenter",function(){entity.children[0].setAttribute("text",{color:"#FFFFFF"});entity.setAttribute("color","#333333")});if(isData){entity.addEventListener("mouseleave",function(){entity.children[0].setAttribute("text",{color:"black"});if(visualizer.data.from==entity.from){entity.setAttribute("color","#555555")}else if(visualizer.data.from==""||visualizer.data.from!=entity.from){entity.setAttribute("color","#FFFFFF")}})}else{entity.addEventListener("mouseleave",function(){entity.children[0].setAttribute("text",{color:"black"});if(visualizer.data[entity.property]==entity.metric){entity.setAttribute("color","#555555")}else{entity.setAttribute("color","#FFFFFF")}})}entity.addEventListener("click",function(){if(entity.property&&entity.metric){if(visualizer.attrName=="babia-boats"&&entity.property=="area"){visualizer.el.removeAttribute(visualizer.attrName,"width");visualizer.el.removeAttribute(visualizer.attrName,"depth")}else if(visualizer.attrName=="babia-boats"&&(entity.property=="width"||entity.property=="depth")&&visualizer.el.getAttribute("babia-boats").area){visualizer.el.removeAttribute(visualizer.attrName,"area");if(entity.property=="width"){visualizer.el.setAttribute(visualizer.attrName,"depth",entity.metric)}else{visualizer.el.setAttribute(visualizer.attrName,"width",entity.metric)}}visualizer.el.setAttribute(visualizer.attrName,entity.property,entity.metric)}else if(entity.from){visualizer.el.setAttribute(visualizer.attrName,"from",entity.from)}})};let createProperty=(property,positionX,positionY)=>{let entity=document.createElement("a-plane");entity.setAttribute("position",{x:positionX,y:positionY,z:0});entity.setAttribute("rotation",{x:0,y:0,z:0});entity.setAttribute("height",.8);entity.setAttribute("width",3);entity.setAttribute("text",{value:property,align:"center",width:"10",color:"#FFFFFF"});entity.setAttribute("color","black");return entity};let createDataSelect=(self,id,positionX,positionY)=>{let entity=document.createElement("a-box");entity.from=id;entity.classList.add("babiaxraycasterclass");entity.setAttribute("position",{x:positionX,y:positionY,z:0});entity.setAttribute("rotation",{x:0,y:0,z:0});entity.setAttribute("height",.8);entity.setAttribute("width",3);entity.setAttribute("depth",.01);let text=document.createElement("a-entity");text.setAttribute("text",{value:id,align:"center",width:"10",color:"black"});text.setAttribute("position","0 0 0.01");entity.appendChild(text);if(self.targetComponent.data.from&&self.targetComponent.data.from==id){entity.setAttribute("color","#555555")}else{entity.setAttribute("color","#FFFFFF")}selection_events(entity,self.targetComponent,true);return entity};let openCloseMenu=(hand_id,entity_menu)=>{let menu_opened=true;let entity_hand=document.getElementById(hand_id);entity_hand.addEventListener("gripdown",function(){if(menu_opened){menu_opened=false;entity_menu.setAttribute("visible",false)}else{menu_opened=true;entity_menu.setAttribute("visible",true)}})}},function(module,exports){if(typeof AFRAME==="undefined"){throw new Error("Component attempted to register before AFRAME was available.")}AFRAME.registerComponent("babiaxr-debug-data",{schema:{inputEvent:{type:"string"}},multiple:false,init:function(){let data=this.data;let el=this.el;if(data.input&&data.output){listenEvent(data,el)}},update:function(oldData){let data=this.data;let el=this.el;if(data!==oldData){if(data.inputEvent!==oldData.inputEvent){console.log("Change event because from has changed");el.removeEventListener(data.inputEvent,function(e){});listenEvent(data,el)}}},remove:function(){},pause:function(){},play:function(){}});let listenEvent=(data,el)=>{el.addEventListener(data.inputEvent,function(e){showDebugPlane(data,el)})};let showDebugPlane=(data,el)=>{if(!el.querySelector(".debug-data")){let debugPanel=generateDebugPanel(data,el,el.getAttribute("babiaData"));el.appendChild(debugPanel)}};function generateDebugPanel(data,el,dataToShow){const HEIGHT_PLANE_DEBUG=10;const WIDTH_PLANE_DEBUG=10;let entity=document.createElement("a-plane");entity.setAttribute("color","white");entity.setAttribute("class","debug_data");entity.setAttribute("width",HEIGHT_PLANE_DEBUG);entity.setAttribute("height",WIDTH_PLANE_DEBUG);let parentPos=el.getAttribute("position");let parentWidth=0;let parentHeight=0;if(el.getAttribute("geometry")){if(el.components.geometry.data.primitive==="box"){parentWidth=el.getAttribute("geometry").width/2;parentHeight=el.getAttribute("geometry").height/2}else if(el.components.geometry.data.primitive==="sphere"){parentWidth=el.getAttribute("geometry").radius}else{parentWidth=0;parentHeight=0}}entity.setAttribute("position",{x:parentPos.x+parentWidth+WIDTH_PLANE_DEBUG/2,y:0-parentHeight+HEIGHT_PLANE_DEBUG/2,z:parentPos.z});let textEntity=document.createElement("a-text");textEntity.setAttribute("value",JSON.stringify(dataToShow));textEntity.setAttribute("width",HEIGHT_PLANE_DEBUG);textEntity.setAttribute("height",WIDTH_PLANE_DEBUG);textEntity.setAttribute("color","black");textEntity.setAttribute("position",{x:0-entity.getAttribute("width")/2,y:0-el.getAttribute("height")/2,z:0});entity.appendChild(textEntity);return entity}},function(module,exports){if(typeof AFRAME==="undefined"){throw new Error("Component attempted to register before AFRAME was available.")}AFRAME.registerComponent("babiaxr-event-controller",{schema:{navigation:{type:"string"},targets:{type:"string"}},multiple:false,init:function(){},update:function(oldData){el=this.el;let data=this.data;navigation=data.navigation;charts=JSON.parse(data.targets);time_evol(navigation)},remove:function(){},pause:function(){},play:function(){}});let el;let navigation;let charts;var data_array;var data_array_reverse=[];let current;let last;let reverse=false;let first_time=true;let firts_point=0;function time_evol(navigation){let commits=document.getElementById(navigation).getAttribute("babiaxr-navigation-bar").commits;if(commits&&first_time){data_array=JSON.parse(commits);for(let i in data_array){data_array_reverse.push(data_array[i])}data_array_reverse.reverse();if(reverse){let position=data_array.length-1-firts_point;current=data_array_reverse[firts_point];last=position}else{current=data_array[firts_point];last=firts_point}first_time=false;controls()}}function play(array){let i=0;for(let x in array){if(array[x]==current){i=parseInt(x)+1}}let loop=setInterval(function(){if(i<array.length){current=array[i];if(reverse){let x=array.length-1-i;showDate(x);last=x}else{showDate(i);last=i}changeChart();i++;document.addEventListener("babiaxrStop",function(){clearInterval(loop)});if(i==array.length){let pause_button=document.getElementsByClassName("babiaxrPause")[0];pause_button.emit("click")}}else{el.emit("babiaxrStop")}},3e3)}function skip(destination){for(let x in data_array){if(data_array[x]==current){if(destination=="next"&&x<data_array.length-1){x++}else if(destination=="prev"&&x>=1){x--}current=data_array[x];showDate(x);last=x;break}}changeChart()}function changePoint(point){for(let x in data_array){if(data_array[x].commit==point.commit){current=data_array[x];showDate(x);last=x;break}}changeChart()}function changeChart(){let data=document.getElementById(current.commit).getAttribute("babiadata");for(let i in charts){let entity=document.getElementById(charts[i].id);if(entity){entity.setAttribute("babiaxr-vismapper","dataToShow",data)}}}function controls(){if(reverse){play(data_array_reverse)}else{play(data_array)}document.addEventListener("babiaxrShow",function(event){changePoint(event.detail.data);el.emit("babiaxrStop")});document.addEventListener("babiaxrContinue",function(){console.log("PLAY");if(reverse){play(data_array_reverse)}else{play(data_array)}});document.addEventListener("babiaxrToPresent",function(){console.log("TO PRESENT");reverse=false;el.emit("babiaxrStop");play(data_array)});document.addEventListener("babiaxrToPast",function(){console.log("TO PAST");reverse=true;el.emit("babiaxrStop");play(data_array_reverse)});document.addEventListener("babiaxrSkipNext",function(){console.log("SKIP NEXT");el.emit("babiaxrStop");skip("next")});document.addEventListener("babiaxrSkipPrev",function(){console.log("SKIP PREV");el.emit("babiaxrStop");skip("prev")})}function showDate(i){let entities=document.getElementsByClassName("babiaxrTimeBar")[0].children;if(last||last==0){let pointToHide=entities[last];pointToHide.emit("removeinfo")}let pointToShow=entities[i];pointToShow.emit("showinfo")}},function(module,exports){if(typeof AFRAME==="undefined"){throw new Error("Component attempted to register before AFRAME was available.")}AFRAME.registerComponent("babiaxr-interaction-mapper",{schema:{input:{type:"string"},output:{type:"string"}},multiple:false,init:function(){let data=this.data;let el=this.el;if(data.input&&data.output){mapEvents(data,el)}},update:function(oldData){let data=this.data;let el=this.el;if(data!==oldData){if(data.input!==oldData.input||data.output!==oldData.output){console.log("Change event because from has changed");el.removeEventListener(oldData.input,function(e){});mapEvents(data,el)}}},remove:function(){},pause:function(){},play:function(){}});let mapEvents=(data,el)=>{el.addEventListener(data.input,function(e){el.emit(data.output,e,false)})}},function(module,exports){if(typeof AFRAME==="undefined"){throw new Error("Component attempted to register before AFRAME was available.")}let points;let size;let play_button;let pause_button;let player;let el;let last_color;let point_color;let to;let start;let max_points;AFRAME.registerComponent("babiaxr-navigation-bar",{schema:{commits:{type:"string"},size:{type:"number",default:"5"},points_by_line:{type:"number",default:"5"},to:{type:"string",default:"left"},start_point:{type:"number",default:"0"}},multiple:false,init:function(){let data=this.data;el=this.el;points=JSON.parse(data.commits);size=data.size;to=data.to;start=data.start_point;max_points=data.points_by_line;let time_bar=createTimeBar(points,size,max_points);this.el.appendChild(time_bar);player=createPlayer();this.el.appendChild(player);setStart()},update:function(oldData){},remove:function(){},pause:function(){},play:function(){}});function createTimeBar(elements,size,maxpoints){let timebar_entity=document.createElement("a-entity");timebar_entity.classList.add("babiaxrTimeBar");let posX=0;let posY=Math.ceil(elements.length/maxpoints)/5-.2;let stepX=size/(maxpoints-1);let last_posX=0;let lines=1;for(let i in elements){let point=createTimePoint(elements[i]);point.classList.add("babiaxraycasterclass");point.setAttribute("position",{x:posX,y:posY,z:0});timebar_entity.appendChild(point);let x=i%maxpoints;if(x==maxpoints-1&&i!=elements.length-1){lines++;posY-=.2;posX=0}else if(i!=elements.length-1){posX+=stepX}last_posX=posX}for(let i=0;i<lines;i++){let bar_line=document.createElement("a-entity");if(last_posX!=0&&i==0||max_points==1){bar_line.setAttribute("line",{start:"0 "+posY+" 0",end:last_posX+" "+posY+" 0",color:"#FF0000"})}else if(last_posX==0&&i==0){bar_line.setAttribute("line",{start:"0 "+posY+" 0",end:last_posX+" "+posY+" 0",color:"#FF0000"})}else{bar_line.setAttribute("line",{start:"0 "+posY+" 0",end:size+" "+posY+" 0",color:"#FF0000"})}posY+=.2;timebar_entity.appendChild(bar_line)}return timebar_entity}function createTimePoint(point){let entity=document.createElement("a-sphere");entity.setAttribute("radius",.05);entity.setAttribute("material",{color:"#FF0000"});showInfo(entity,point);setPoint(entity,point);return entity}function setStart(){let points=document.getElementsByClassName("babiaxrTimeBar")[0].children;for(let i in points){if(i==start){points[i].emit("showinfo")}}}function setPoint(element,data){element.addEventListener("click",function(){this.setAttribute("material",{color:"#00AA00"});point_color=this.getAttribute("material").color;el.emit("babiaxrShow",{data:data});if(document.getElementsByClassName("babiaxrPause")[0]){player.removeChild(pause_button);player.appendChild(play_button)}})}function showInfo(element,data){let legend;let legend2;element.addEventListener("mouseenter",function(){point_color=this.getAttribute("material").color;this.setAttribute("scale",{x:1.1,y:1.1,z:1.1});this.setAttribute("material",{color:"#AAAA00"});legend2=generateLegend(data);this.appendChild(legend2)});element.addEventListener("showinfo",function(){legend=generateLegend(data);this.setAttribute("material",{color:"#00AA00"});this.appendChild(legend)});element.addEventListener("mouseleave",function(){this.setAttribute("scale",{x:1,y:1,z:1});this.setAttribute("material",{color:point_color});this.removeChild(legend2)});element.addEventListener("removeinfo",function(){if(legend){this.removeChild(legend);this.setAttribute("material",{color:"#FF0000"})}})}function generateLegend(data){let text="";let lines=[];lines.push("Date: "+data["date"]+"\n");lines.push("commit: "+data["commit"]+"\n");let width=1;for(let line of lines){if(line.length>10&&width<line.length/2){width=line.length/7}text+=line}let entity=document.createElement("a-plane");entity.setAttribute("position",{x:0,y:.4,z:.1});entity.setAttribute("scale",{x:.5,y:.5,z:1});entity.setAttribute("height","1");entity.setAttribute("width",width);entity.setAttribute("color","white");entity.setAttribute("text",{value:text,align:"center",width:6,color:"black"});entity.setAttribute("material",{opacity:.6});return entity}function createPlayer(){let player_entity=document.createElement("a-entity");player_entity.classList.add("babiaxrPlayer");player_entity.setAttribute("position",{x:(size-5)/2,y:0,z:0});player_entity.classList.add("babiaxraycasterclass");play_button=playButton(player_entity);play_button.setAttribute("position",{x:2.35,y:-.65,z:0});play_button.classList.add("babiaxraycasterclass");pause_button=pauseButton();pause_button.setAttribute("position",{x:2.35,y:-.65,z:0});pause_button.classList.add("babiaxraycasterclass");player_entity.appendChild(pause_button);let rewind_button=rewindButton();rewind_button.setAttribute("position",{x:1.25,y:-.65,z:0});rewind_button.classList.add("babiaxraycasterclass");player_entity.appendChild(rewind_button);let forward_button=forwardButton();forward_button.setAttribute("position",{x:3.7,y:-.65,z:0});forward_button.classList.add("babiaxraycasterclass");player_entity.appendChild(forward_button);let skip_prev_button=skipPreviousButton();skip_prev_button.setAttribute("position",{x:1.95,y:-.65,z:0});skip_prev_button.classList.add("babiaxraycasterclass");player_entity.appendChild(skip_prev_button);let skip_next_button=skipNextButton();skip_next_button.setAttribute("position",{x:3,y:-.65,z:0});skip_next_button.classList.add("babiaxraycasterclass");player_entity.appendChild(skip_next_button);return player_entity}function playButton(player){let entity=document.createElement("a-entity");entity.classList.add("babiaxrPlay");let vertices=[[0,0,0],[0,3,0],[2.5,1.5,0],[0,0,0]];let button=load_model(vertices);entity.setObject3D("mesh",button);emitEvents(entity,"babiaxrContinue");mouseOver(entity);return entity}function rewindButton(){let entity=document.createElement("a-entity");entity.classList.add("babiaxrRewind");let vertices=[[0,0,0],[0,3,0],[1.25,1.5,0],[1.25,3,0],[2.5,1.5,0],[1.25,0,0],[1.25,1.5,0],[0,0,0]];let button=load_model(vertices);entity.setObject3D("mesh",button);entity.setAttribute("rotation",{x:0,y:180,z:0});if(to=="left"){entity.object3DMap.mesh.material.color={r:85/255,g:85/255,b:85/255}}emitEvents(entity,"babiaxrToPast");mouseOver(entity);return entity}function forwardButton(){let entity=document.createElement("a-entity");entity.classList.add("babiaxrForward");let vertices=[[0,0,0],[0,3,0],[1.25,1.5,0],[1.25,3,0],[2.5,1.5,0],[1.25,0,0],[1.25,1.5,0],[0,0,0]];let button=load_model(vertices);entity.setObject3D("mesh",button);if(to=="right"){entity.object3DMap.mesh.material.color={r:85/255,g:85/255,b:85/255}}emitEvents(entity,"babiaxrToPresent");mouseOver(entity);return entity}function skipPreviousButton(){let entity=document.createElement("a-entity");entity.classList.add("babiaxrSkipPrev");let vertices=[[0,0,0],[0,3,0],[1,1.5,0],[1,3,0],[2,1.5,0],[2,3,0],[2.5,3,0],[2.5,0,0],[2,0,0],[2,1.5,0],[1,0,0],[1,1.5,0],[0,0,0]];let button=load_model(vertices);entity.setObject3D("mesh",button);entity.setAttribute("rotation",{x:0,y:180,z:0});emitEvents(entity,"babiaxrSkipPrev");mouseOver(entity);return entity}function skipNextButton(){let entity=document.createElement("a-entity");entity.classList.add("babiaxrSkipNext");let vertices=[[0,0,0],[0,3,0],[1,1.5,0],[1,3,0],[2,1.5,0],[2,3,0],[2.5,3,0],[2.5,0,0],[2,0,0],[2,1.5,0],[1,0,0],[1,1.5,0],[0,0,0]];let button=load_model(vertices);entity.setObject3D("mesh",button);emitEvents(entity,"babiaxrSkipNext");mouseOver(entity);return entity}function pauseButton(){let entity=document.createElement("a-entity");entity.classList.add("babiaxrPause");let vertices_1=[[0,0,0],[0,3,0],[1,3,0],[1,0,0],[0,0,0]];let vertices_2=[[1.5,0,0],[1.5,3,0],[2.5,3,0],[2.5,0,0],[1.5,0,0]];let button=merge_model(vertices_1,vertices_2);entity.setObject3D("mesh",button);emitEvents(entity,"babiaxrStop");mouseOver(entity);return entity}function load_model(vertices){let vertices_len=vertices.length;let array_extrude=[];const scale=.11;for(i=0;i<vertices_len;i++){let x=scale*vertices[i][0];let y=scale*vertices[i][1];let z=scale*vertices[i][2];let vector=new THREE.Vector3(x,y,z);array_extrude.push(vector)}let fig_form=new THREE.Shape(array_extrude);let extrude_data={depth:.05,bevelEnabled:false,bevelSegments:1,steps:1,bevelThickness:1};let material=new THREE.MeshBasicMaterial({color:16777215,side:THREE.DoubleSide,wireframe:false});let geometry_extrude=new THREE.ExtrudeGeometry(fig_form,extrude_data);let mesh_extrude=new THREE.Mesh(geometry_extrude,material);return mesh_extrude}function merge_model(vertices1,vertices2){let vertices1_len=vertices1.length;let vertices2_len=vertices2.length;let array_extrude1=[];let array_extrude2=[];const scale=.11;for(i=0;i<vertices1_len;i++){let x=scale*vertices1[i][0];let y=scale*vertices1[i][1];let z=scale*vertices1[i][2];let vector=new THREE.Vector3(x,y,z);array_extrude1.push(vector)}for(i=0;i<vertices2_len;i++){let x=scale*vertices2[i][0];let y=scale*vertices2[i][1];let z=scale*vertices2[i][2];let vector=new THREE.Vector3(x,y,z);array_extrude2.push(vector)}let fig_form1=new THREE.Shape(array_extrude1);let fig_form2=new THREE.Shape(array_extrude2);let extrude_data={depth:.05,bevelEnabled:false,bevelSegments:1,steps:1,bevelThickness:1};let material=new THREE.MeshBasicMaterial({color:16777215,side:THREE.DoubleSide,wireframe:false});let geometry_extrude1=new THREE.ExtrudeGeometry(fig_form1,extrude_data);let geometry_extrude2=new THREE.ExtrudeGeometry(fig_form2,extrude_data);let mesh_extrude1=new THREE.Mesh(geometry_extrude1,material);mesh_extrude1.updateMatrix();geometry_extrude2.merge(mesh_extrude1.geometry,mesh_extrude1.matrix);let mesh_extrude2=new THREE.Mesh(geometry_extrude2,material);return mesh_extrude2}function mouseOver(element){element.addEventListener("mouseenter",function(){last_color=Object.assign({},this.object3DMap.mesh.material.color);this.object3DMap.mesh.material.color={r:170/255,g:170/255,b:170/255}});element.addEventListener("mouseleave",function(){this.object3DMap.mesh.material.color=last_color})}function emitEvents(element,event_name){element.addEventListener("click",function(){if(element.classList.contains("babiaxrPlay")){player.removeChild(element);player.appendChild(pause_button)}else if(element.classList.contains("babiaxrPause")){player.removeChild(pause_button);player.appendChild(play_button)}else if(element.classList.contains("babiaxrSkipNext")||element.classList.contains("babiaxrSkipPrev")){if(document.getElementsByClassName("babiaxrPause")[0]){player.removeChild(pause_button);player.appendChild(play_button)}}else if(element.classList.contains("babiaxrForward")){last_color={r:85/255,g:85/255,b:85/255};let button=document.getElementsByClassName("babiaxrRewind")[0];button.object3DMap.mesh.material.color={r:255/255,g:255/255,b:255/255}}else if(element.classList.contains("babiaxrRewind")){last_color={r:85/255,g:85/255,b:85/255};let button=document.getElementsByClassName("babiaxrForward")[0];button.object3DMap.mesh.material.color={r:255/255,g:255/255,b:255/255}}console.log("Emit..... "+event_name);el.emit(event_name)})}},function(module,exports){if(typeof AFRAME==="undefined"){throw new Error("Component attempted to register before AFRAME was available.")}AFRAME.registerComponent("babiaxr-totem",{schema:{charts_id:{type:"string"},data_list:{type:"string"}},multiple:false,init:function(){let data=this.data;let el=this.el;my_id=el.id;if(data){charts_id.push({id:el.id,charts_id:JSON.parse(data.charts_id)});if(data.data_list){dataToPrint_list=JSON.parse(data.data_list);loadFiles(dataToPrint_list)}}},update:function(oldData){let data=this.data;el=this.el;if(data!==oldData){while(this.el.firstChild)this.el.firstChild.remove();console.log("Generating totemchart...");generateTotemChart(el)}},remove:function(){},pause:function(){},play:function(){}});let data_files=[];let charts_id=[];let my_id;let dataToPrint_list;let el;let generateTotemChart=element=>{if(data_files){generateTotemData(element,dataToPrint_list)}};function loadFiles(list){let loader=new THREE.FileLoader;for(let item of list){if(item.from_querier){let querierElement=document.getElementById(item.from_querier);if(querierElement.getAttribute("babiaData")){let dataFromQuerier=JSON.parse(querierElement.getAttribute("babiaData"));data_files.push({file:dataFromQuerier,path:item.from_querier})}else{querierElement.addEventListener("dataReady"+item.from_querier,function(e){data_files.push({file:e.detail,path:item.from_querier})})}}else if(item.path){let file=item.path;loader.load(file,function(data){data_files.push({file:data,path:file})},function(xhr){console.log(file.toString()+": "+xhr.loaded/xhr.total*100+"% loaded")},function(err){console.error("An error happened")})}}}function generateTotemData(element,list){console.log("Generating Totem...");let position_y=7.5;if(list.length%2==1){let increment=Math.trunc(list.length/2);position_y+=increment}let position_x=-3;let position_z=6;let rotation_y=0;let width=getWidthTotem(list);let entity=document.createElement;generateTotemTitle(element,position_x,position_y,position_z,rotation_y,width,"Select Data");position_y-=1;generateTotem(element,position_x,position_y,position_z,rotation_y,width,list)}function generateTotemTitle(element,x,y,z,rotation_y,width,title){let entity=document.createElement("a-plane");entity.setAttribute("class","title");entity.setAttribute("position",{x:x,y:y,z:z});entity.setAttribute("rotation",{x:0,y:rotation_y,z:0});entity.setAttribute("height",1);entity.setAttribute("width",width);entity.setAttribute("color","blue");entity.setAttribute("text",{value:title,align:"center",width:"10",color:"white"});element.appendChild(entity)}function generateTotem(element,x,y,z,rotation,width,list,list_used){for(let item of list){if(item.data){item=item.data}let entity=document.createElement("a-plane");entity.setAttribute("position",{x:x,y:y,z:z});entity.setAttribute("rotation",{x:0,y:rotation,z:0});entity.setAttribute("height",1);entity.setAttribute("width",width);entity.setAttribute("text",{value:item,align:"center",width:"10"});entity.setAttribute("color","white");entity.setAttribute("text",{color:"black"});element.appendChild(entity);y-=1;entity.classList.add("babiaxraycasterclass");entity.addEventListener("click",function(){let id_totem=entity.parentElement.id;let children=entity.parentElement.children;list_used=item;for(let i of list){if((i.path||i.from_querier)&&list_used==i.data){updateEntity(i.path||i.from_querier,id_totem)}}for(let child in children){if(children[child]===entity){entity.setAttribute("color","black");entity.setAttribute("text",{color:"white"})}else if(!children[child].id){if(children[child].className!=="title"){children[child].setAttribute("color","white");children[child].setAttribute("text",{color:"black"})}}}})}}function getWidthTotem(list){let width=5;for(let line of list){if(line.data){line=line.data}if(line.length>10&&width<line.length/4){width=line.length/4}}return width}function updateEntity(data,id_totem){let entity=getEntity(id_totem);for(let totem in charts_id){if(id_totem==charts_id[totem].id){let charts=charts_id[totem].charts_id;for(obj in charts){let type=charts[obj].type;let id=charts[obj].id;let new_data;for(let file in data_files){if(data_files[file].path==data){new_data=data_files[file].file;if(type==="babiaxr-vismapper"){document.getElementById(id).setAttribute(type,"dataToShow",JSON.stringify(new_data))}else{document.getElementById(id).setAttribute(type,"data",new_data)}}}}}}}function getEntity(id){let entity=document.getElementById(id);return entity}},function(module,exports){if(typeof AFRAME==="undefined"){throw new Error("Component attempted to register before AFRAME was available.")}AFRAME.registerComponent("babia-queryes",{schema:{elasticsearch_url:{type:"string"},index:{type:"string"},query:{type:"string"},size:{type:"int",default:10},user:{type:"string"},password:{type:"string"},data:{type:"string"}},multiple:false,init:function(){},update:function(oldData){let data=this.data;let el=this.el;let self=this;if(data.data&&oldData.data!==data.data){parseEmbeddedJSONData(data.data,el,self)}else{if(data.elasticsearch_url!==oldData.elasticsearch_url||data.index!==oldData.index||data.query!==oldData.query||data.size!==oldData.size){if(data.elasticsearch_url&&data.index){requestJSONDataFromES(data,el,self)}else{console.error("elasicsearch_url and index must be defined");return}}}},remove:function(){},pause:function(){},play:function(){},babiaData:undefined,babiaMetadata:{id:0},register:function(interestedElem){let el=this.el;this.interestedElements.push(interestedElem);if(this.babiaData){dispatchEventOnElement(interestedElem,"babiaData")}},unregister:function(interestedElem){const index=this.interestedElements.indexOf(interestedElem);if(index>-1){this.interestedElements.splice(index,1)}},interestedElements:[]});let requestJSONDataFromES=(data,el,self)=>{let request=new XMLHttpRequest;request.open("get",`${data.elasticsearch_url}/${data.index}/_search?size=${data.size}&${data.query}`);request.onload=function(){if(this.status>=200&&this.status<300){if(typeof request.response==="string"||request.response instanceof String){dataRaw=JSON.parse(request.response).hits.hits;let dataRetrieved=[];for(let i=0;i<dataRaw.length;i++){dataRetrieved[i]=dataRaw[i]._source}}else{let dataRetrieved=[];console.error("Unexpected response",request.response)}self.babiaData=dataRetrieved;self.babiaMetadata={id:self.babiaMetadata.id++};dataReadyToSend("babiaData",self)}else{reject({status:this.status,statusText:xhr.statusText});console.error("Error during requesting data",this.status,xhr.statusText)}};request.onerror=function(){reject({status:this.status,statusText:xhr.statusText});console.error("Error during requesting data",this.status,xhr.statusText)};request.send()};let parseEmbeddedJSONData=(embedded,el,self)=>{let dataRetrieved=JSON.parse(embedded);self.babiaData=dataRetrieved;self.babiaMetadata={id:self.babiaMetadata.id++};dataReadyToSend("babiaData",self)};let dataReadyToSend=(propertyName,self)=>{self.interestedElements.forEach(element=>{dispatchEventOnElement(element,propertyName)})};let dispatchEventOnElement=(element,propertyName)=>{element.emit("babiaQuerierDataReady",propertyName)}},function(module,exports){if(typeof AFRAME==="undefined"){throw new Error("Component attempted to register before AFRAME was available.")}AFRAME.registerComponent("babia-querygithub",{schema:{user:{type:"string"},token:{type:"string"},repos:{type:"array"},data:{type:"string"}},multiple:false,init:function(){},update:function(oldData){let data=this.data;let el=this.el;let self=this;if(data.data&&oldData.data!==data.data){parseEmbeddedJSONData(data.data,el,self)}else{if(oldData.user!==data.user||oldData.repos!==data.repos||oldData.token!==data.token){if(data.user&&data.repos.length===0){requestAllReposFromUser(data,el,self)}else if(data.repos.length>0){requestReposFromList(data,el,self)}}}},remove:function(){},pause:function(){},play:function(){},babiaData:undefined,babiaMetadata:{id:0},register:function(interestedElem){let el=this.el;this.interestedElements.push(interestedElem);if(this.babiaData){dispatchEventOnElement(interestedElem,"babiaData")}},unregister:function(interestedElem){const index=this.interestedElements.indexOf(interestedElem);if(index>-1){this.interestedElements.splice(index,1)}},interestedElements:[]});let requestReposFromList=(data,el,self)=>{let dataOfRepos=[];data.repos.forEach((e,i)=>{let request=new XMLHttpRequest;let url="https://api.github.com/repos/"+data.user+"/"+e+"?_="+(new Date).getTime();request.open("get",url,false);request.onload=function(){if(this.status>=200&&this.status<300){console.log("data OK in request.response",el.id);let rawData=JSON.parse(request.response);dataOfRepos.push(rawData)}else{reject({status:this.status,statusText:xhr.statusText});console.error("Error during requesting data",this.status,xhr.statusText)}};request.onerror=function(){reject({status:this.status,statusText:xhr.statusText});console.error("Error during requesting data",this.status,xhr.statusText)};request.send()});self.babiaData=dataOfRepos;self.babiaMetadata={id:self.babiaMetadata.id++};dataReadyToSend("babiaData",self)};let requestAllReposFromUser=(data,el,self)=>{let request=new XMLHttpRequest;let url="https://api.github.com/users/"+data.user+"/repos?_="+(new Date).getTime();request.open("get",url);request.onload=function(){if(this.status>=200&&this.status<300){console.log("data OK in request.response",el.id);self.babiaData=allReposParse(JSON.parse(request.response));self.babiaMetadata={id:self.babiaMetadata.id++};dataReadyToSend("babiaData",self)}else{reject({status:this.status,statusText:xhr.statusText});console.error("Error during requesting data",this.status,xhr.statusText)}};request.onerror=function(){reject({status:this.status,statusText:xhr.statusText});console.error("Error during requesting data",this.status,xhr.statusText)};request.send()};let allReposParse=data=>{let dataParsed=[];data.forEach((e,i)=>{dataParsed.push(e)});return dataParsed};let parseEmbeddedJSONData=(embedded,el,self)=>{let dataRetrieved=JSON.parse(embedded);self.babiaData=dataRetrieved;self.babiaMetadata={id:self.babiaMetadata.id++};dataReadyToSend("babiaData",self)};let dataReadyToSend=(propertyName,self)=>{self.interestedElements.forEach(element=>{dispatchEventOnElement(element,propertyName)})};let dispatchEventOnElement=(element,propertyName)=>{element.emit("babiaQuerierDataReady",propertyName)}},function(module,exports){if(typeof AFRAME==="undefined"){throw new Error("Component attempted to register before AFRAME was available.")}AFRAME.registerComponent("babia-queryjson",{schema:{url:{type:"string"},embedded:{type:"string"},data:{type:"string"}},multiple:false,init:function(){},update:function(oldData){let data=this.data;let el=this.el;let self=this;if(data.data&&oldData.data!==data.data){parseEmbeddedJSONData(data.data,el,self)}else{if(oldData.url!==data.url){requestJSONDataFromURL(data,el,self)}else if(oldData.embedded!==data.embedded){parseEmbeddedJSONData(data.embedded,el,self)}}},remove:function(){},pause:function(){},play:function(){},babiaData:undefined,babiaMetadata:{id:0},register:function(interestedElem){let el=this.el;this.interestedElements.push(interestedElem);if(this.babiaData){dispatchEventOnElement(interestedElem,"babiaData")}},unregister:function(interestedElem){const index=this.interestedElements.indexOf(interestedElem);if(index>-1){this.interestedElements.splice(index,1)}},interestedElements:[]});let requestJSONDataFromURL=(data,el,self)=>{let request=new XMLHttpRequest;request.open("get",data.url);request.onload=function(){if(this.status>=200&&this.status<300){let dataRetrieved;if(typeof request.response==="string"||request.response instanceof String){dataRetrieved=JSON.parse(request.response)}else{dataRetrieved=request.response}if(!Array.isArray(dataRetrieved)){console.error("Data must be an array");return}self.babiaData=dataRetrieved;self.babiaMetadata={id:self.babiaMetadata.id++};dataReadyToSend("babiaData",self)}else{reject({status:this.status,statusText:xhr.statusText});console.error("Error during requesting data",this.status,xhr.statusText)}};request.onerror=function(){reject({status:this.status,statusText:xhr.statusText});console.error("Error during requesting data",this.status,xhr.statusText)};request.send()};let parseEmbeddedJSONData=(embedded,el,self)=>{let dataRetrieved=JSON.parse(embedded);self.babiaData=dataRetrieved;self.babiaMetadata={id:self.babiaMetadata.id++};dataReadyToSend("babiaData",self)};let dataReadyToSend=(propertyName,self)=>{self.interestedElements.forEach(element=>{dispatchEventOnElement(element,propertyName)})};let dispatchEventOnElement=(element,propertyName)=>{element.emit("babiaQuerierDataReady",propertyName)}},function(module,exports){if(typeof AFRAME==="undefined"){throw new Error("Component attempted to register before AFRAME was available.")}AFRAME.registerComponent("babia-bars",{schema:{data:{type:"string"},height:{type:"string",default:"height"},x_axis:{type:"string",default:"x_axis"},from:{type:"string"},legend:{type:"boolean",default:false},axis:{type:"boolean",default:true},animation:{type:"boolean",default:false},palette:{type:"string",default:"ubuntu"},title:{type:"string"},titleFont:{type:"string"},titleColor:{type:"string"},titlePosition:{type:"string",default:"0 0 0"},scale:{type:"number"},heightMax:{type:"number"}},visProperties:["height","x_axis"],multiple:false,init:function(){this.time=Date.now();this.anime_finished=false},update:function(oldData){const self=this;let data=this.data;let el=this.el;this.chart;this.animation=data.animation;this.bar_array=[];if(data.data&&oldData.data!==data.data){self.babiaData=self.data;self.babiaMetadata={id:self.babiaMetadata.id++};while(self.el.firstChild)self.el.firstChild.remove();self.chart=generateBarChart(self,self.data,JSON.parse(data.data),el,self.animation,self.chart,self.bar_array,self.widthBars);dataReadyToSend("babiaData",self)}else{if(data.from!==oldData.from){if(self.dataComponent){self.dataComponent.unregister(el)}let eventName=findDataComponent(data,el,self);if(self.dataComponentEventName&&self.dataComponentEventName!==eventName){el.removeEventListener(self.dataComponentEventName,_listener,true)}self.dataComponentEventName=eventName;el.addEventListener(self.dataComponentEventName,_listener=(e=>{attachNewDataEventCallback(self,e)}));self.dataComponent.register(el);return}if(data!==oldData&&self.babiaData){while(self.el.firstChild)self.el.firstChild.remove();console.log("Generating barchart...");self.chart=generateBarChart(self,self.data,self.babiaData,el,self.animation,self.chart,self.bar_array,self.widthBars);dataReadyToSend("babiaData",self)}}},remove:function(){},tick:function(t,delta){const time_wait=2e3;const self=this;let new_time=Date.now();if(this.animation&&!this.anime_finished&&this.chart){let elements=this.chart.children;let diff_time=new_time-this.time;if(diff_time>=time_wait){for(let bar in this.bar_array){let prev_height=parseFloat(elements[bar].getAttribute("height"));let height_max=this.bar_array[bar].height_max;let pos_x=this.bar_array[bar].position_x;if(prev_height<height_max){let new_height=(diff_time-time_wait)*height_max/self.total_duration;elements[bar].setAttribute("height",new_height);elements[bar].setAttribute("position",{x:pos_x,y:new_height/2,z:0})}else{this.anime_finished=true;elements[bar].setAttribute("height",height_max);elements[bar].setAttribute("position",{x:pos_x,y:height_max/2,z:0});console.log("Total time (wait + animation): "+diff_time+"ms")}}}}},dataComponent:undefined,dataComponentDataPropertyName:"babiaData",dataComponentEventName:undefined,babiaData:undefined,babiaMetadata:{id:0},widthBars:1,total_duration:3e3,proportion:undefined,valueMax:undefined,pause:function(){},play:function(){},register:function(interestedElem){let el=this.el;this.interestedElements.push(interestedElem);if(this.babiaData){dispatchEventOnElement(interestedElem,"babiaData")}},unregister:function(interestedElem){const index=this.interestedElements.indexOf(interestedElem);if(index>-1){this.interestedElements.splice(index,1)}},interestedElements:[]});let findDataComponent=(data,el,self)=>{let eventName="babiaQuerierDataReady";if(data.from){let dataElement=document.getElementById(data.from);if(dataElement.components["babia-filter"]){self.dataComponent=dataElement.components["babia-filter"];eventName="babiaFilterDataReady"}else if(dataElement.components["babia-queryjson"]){self.dataComponent=dataElement.components["babia-queryjson"]}else if(dataElement.components["babia-queryes"]){self.dataComponent=dataElement.components["babia-queryes"]}else if(dataElement.components["babia-querygithub"]){self.dataComponent=dataElement.components["babia-querygithub"]}else{console.error("Problem registering to the querier");return}}else{if(el.components["babia-filter"]){self.dataComponent=el.components["babia-filter"];eventName="babiaFilterDataReady"}else if(el.components["babia-queryjson"]){self.dataComponent=el.components["babia-queryjson"]}else if(el.components["babia-queryes"]){self.dataComponent=el.components["babia-queryes"]}else if(el.components["babia-querygithub"]){self.dataComponent=el.components["babia-querygithub"]}else{if(document.querySelectorAll("[babia-filter]").length>0){self.dataComponent=document.querySelectorAll("[babia-filter]")[0].components["babia-filter"];eventName="babiaFilterDataReady"}else if(document.querySelectorAll("[babia-queryjson]").length>0){self.dataComponent=document.querySelectorAll("[babia-queryjson]")[0].components["babia-queryjson"]}else if(document.querySelectorAll("[babia-queryjson]").length>0){self.dataComponent=document.querySelectorAll("[babia-queryes]")[0].components["babia-queryes"]}else if(document.querySelectorAll("[babia-querygithub]").length>0){self.dataComponent=document.querySelectorAll("[babia-querygithub]")[0].components["babia-querygithub"]}else{console.error("Error, querier not found");return}}}return eventName};let attachNewDataEventCallback=(self,e)=>{self.dataComponentDataPropertyName=e.detail;let rawData=self.dataComponent[self.dataComponentDataPropertyName];self.babiaData=rawData;self.babiaMetadata={id:self.babiaMetadata.id++};while(self.el.firstChild)self.el.firstChild.remove();console.log("Generating barchart...");self.chart=generateBarChart(self,self.data,rawData,self.el,self.animation,self.chart,self.bar_array,self.widthBars);dataReadyToSend("babiaData",self)};let generateBarChart=(self,data,dataRetrieved,element,animation,chart,list,widthBars)=>{if(dataRetrieved){const dataToPrint=dataRetrieved;const palette=data.palette;const title=data.title;const font=data.titleFont;const color=data.titleColor;const title_position=data.titlePosition;const scale=data.scale;const heightMax=data.heightMax;let colorid=0;let stepX=0;let axis_dict=[];let title_3d=showTitle(title,font,color,title_position);element.appendChild(title_3d);let maxY=Math.max.apply(Math,dataToPrint.map(function(o){return o[self.data.height]}));if(scale){maxY=maxY/scale}else if(heightMax){self.valueMax=maxY;self.proportion=heightMax/maxY;maxY=heightMax}let chart_entity=document.createElement("a-entity");chart_entity.classList.add("babiaxrChart");element.appendChild(chart_entity);for(let bar of dataToPrint){let barEntity=generateBar(self,bar[self.data.height],widthBars,colorid,stepX,palette,animation,scale,list);barEntity.classList.add("babiaxraycasterclass");if(data.legend){showLegend(self,barEntity,bar,element,widthBars)}let bar_printed={colorid:colorid,posX:stepX,key:bar[self.data.x_axis]};axis_dict.push(bar_printed);chart_entity.appendChild(barEntity);stepX+=widthBars+widthBars/4;colorid++}if(data.axis){showXAxis(widthBars,element,stepX,axis_dict,palette);showYAxis(self.proportion,self.valueMax,widthBars,element,maxY,scale)}chart=element.children[1];return chart}};function generateBar(self,height,width,colorid,position,palette,animation,scale,bar_array){let color=getColor(colorid,palette);if(scale){height=height/scale}else if(self.proportion){height=self.proportion*height}let entity=document.createElement("a-box");entity.setAttribute("color",color);entity.setAttribute("width",width);entity.setAttribute("depth",width);if(animation){var increment=height/self.total_duration;var height_max=height;bar_array.push({increment:increment,height_max:height_max,position_x:position});entity.setAttribute("height",.001);entity.setAttribute("position",{x:position,y:0,z:0})}else{entity.setAttribute("height",height);entity.setAttribute("position",{x:position,y:height/2,z:0})}return entity}function getColor(colorid,palette){let color;for(let i in colors){if(colors[i][palette]){color=colors[i][palette][colorid%4]}}return color}function generateLegend(self,bar,barEntity,widthBars){let text=bar[self.data.x_axis]+": "+bar[self.data.height];let width=2;if(text.length>16)width=text.length/8;let barPosition=barEntity.getAttribute("position");let entity=document.createElement("a-plane");entity.setAttribute("position",{x:barPosition.x,y:2*barPosition.y+1,z:barPosition.z+widthBars+.1});entity.setAttribute("rotation",{x:0,y:0,z:0});entity.setAttribute("height","1");entity.setAttribute("width",width);entity.setAttribute("color","white");entity.setAttribute("text",{value:bar[self.data.x_axis]+": "+bar[self.data.height],align:"center",width:6,color:"black"});entity.classList.add("babiaxrLegend");return entity}function showXAxis(widthBars,parent,xEnd,bars_printed,palette){let axis=document.createElement("a-entity");let axis_line=document.createElement("a-entity");axis_line.setAttribute("line__xaxis",{start:{x:-widthBars,y:0,z:0},end:{x:xEnd,y:0,z:0},color:"#ffffff"});axis_line.setAttribute("position",{x:0,y:0,z:widthBars/2+widthBars/4});axis.appendChild(axis_line);bars_printed.forEach(e=>{let key=document.createElement("a-entity");let color=getColor(e.colorid,palette);key.setAttribute("text",{value:e.key,align:"right",width:10,color:color});key.setAttribute("position",{x:e.posX,y:0,z:widthBars+5.2});key.setAttribute("rotation",{x:-90,y:90,z:0});axis.appendChild(key)});parent.appendChild(axis)}function showYAxis(proportion,valueMax,widthBars,parent,yEnd,scale){let axis=document.createElement("a-entity");let yLimit=yEnd;const minSteps=6;let axis_line=document.createElement("a-entity");axis_line.setAttribute("line__yaxis",{start:{x:-widthBars,y:0,z:0},end:{x:-widthBars,y:yEnd,z:0},color:"#ffffff"});axis_line.setAttribute("position",{x:0,y:0,z:widthBars/2+widthBars/4});axis.appendChild(axis_line);if(proportion){yLimit=yLimit/proportion;var mod=Math.floor(Math.log10(valueMax))}let yScale=yLimit/valueMax;let step=Math.pow(10,mod);steps=valueMax/step;while(steps<=minSteps){step=step/2;steps=valueMax/step}for(let i=1;step*i<valueMax;i++){let label=document.createElement("a-entity");let value=step*i;label.setAttribute("text",{value:value,align:"right",width:10,color:"white "});position=value*yScale;if(scale){label.setAttribute("position",{x:-widthBars-5.2,y:position*scale,z:widthBars/2+widthBars/4})}else if(proportion){label.setAttribute("position",{x:-widthBars-5.2,y:position*proportion,z:widthBars/2+widthBars/4})}else{label.setAttribute("position",{x:-widthBars-5.2,y:position,z:widthBars/2+widthBars/4})}axis.appendChild(label)}parent.appendChild(axis)}function showLegend(self,barEntity,bar,element,widthBars){barEntity.addEventListener("mouseenter",function(){this.setAttribute("scale",{x:1.1,y:1.1,z:1.1});legend=generateLegend(self,bar,barEntity,widthBars);element.appendChild(legend)});barEntity.addEventListener("mouseleave",function(){this.setAttribute("scale",{x:1,y:1,z:1});element.removeChild(legend)})}function showTitle(title,font,color,position){let entity=document.createElement("a-entity");entity.setAttribute("text-geometry",{value:title});if(font){entity.setAttribute("text-geometry",{font:font})}if(color){entity.setAttribute("material",{color:color})}var position=position.split(" ");entity.setAttribute("position",{x:position[0],y:position[1],z:position[2]});entity.setAttribute("rotation",{x:0,y:0,z:0});entity.classList.add("babiaxrTitle");return entity}let colors=[{blues:["#142850","#27496d","#00909e","#dae1e7"]},{foxy:["#f79071","#fa744f","#16817a","#024249"]},{flat:["#120136","#035aa6","#40bad5","#fcbf1e"]},{sunset:["#202040","#543864","#ff6363","#ffbd69"]},{bussiness:["#de7119","#dee3e2","#116979","#18b0b0"]},{icecream:["#f76a8c","#f8dc88","#f8fab8","#ccf0e1"]},{ubuntu:["#511845","#900c3f","#c70039","#ff5733"]},{pearl:["#efa8e4","#f8e1f4","#fff0f5","#97e5ef"]},{commerce:["#222831","#30475e","#f2a365","#ececec"]}];let dataReadyToSend=(propertyName,self)=>{self.interestedElements.forEach(element=>{dispatchEventOnElement(element,propertyName)})};let dispatchEventOnElement=(element,propertyName)=>{element.emit("babiaVisualizerUpdated",propertyName)}},function(module,exports){if(typeof AFRAME==="undefined"){throw new Error("Component attempted to register before AFRAME was available.")}AFRAME.registerComponent("babia-barsmap",{schema:{data:{type:"string"},height:{type:"string",default:"height"},x_axis:{type:"string",default:"x_axis"},z_axis:{type:"string",default:"z_axis"},from:{type:"string"},legend:{type:"boolean"},axis:{type:"boolean",default:true},animation:{type:"boolean",default:false},palette:{type:"string",default:"ubuntu"},title:{type:"string"},titleFont:{type:"string"},titleColor:{type:"string"},titlePosition:{type:"string",default:"0 0 0"},scale:{type:"number"},heightMax:{type:"number"}},visProperties:["height","x_axis","z_axis"],multiple:false,init:function(){},update:function(oldData){const self=this;let data=this.data;let el=this.el;if(data.data&&oldData.data!==data.data){self.babiaData=self.data;self.babiaMetadata={id:self.babiaMetadata.id++};while(self.el.firstChild)self.el.firstChild.remove();console.log("Generating barchart from data...");self.chart=generateBarChart(self.data,JSON.parse(self.data.data),self.el,self.widthBars,self.proportion,self.valueMax);dataReadyToSend("babiaData",self)}else{if(data.from!==oldData.from){if(self.dataComponent){self.dataComponent.unregister(el)}let eventName=findDataComponent(data,el,self);if(self.dataComponentEventName&&self.dataComponentEventName!==eventName){el.removeEventListener(self.dataComponentEventName,_listener,true)}self.dataComponentEventName=eventName;el.addEventListener(self.dataComponentEventName,_listener=(e=>{attachNewDataEventCallback(self,e)}));self.dataComponent.register(el);return}if(data!==oldData&&self.babiaData){while(self.el.firstChild)self.el.firstChild.remove();console.log("Generating barchart...");self.chart=generateBarChart(self.data,self.babiaData,self.el,self.widthBars,self.proportion,self.valueMax);dataReadyToSend("babiaData",self)}}},remove:function(){},pause:function(){},play:function(){},register:function(interestedElem){let el=this.el;this.interestedElements.push(interestedElem);if(this.babiaData){dispatchEventOnElement(interestedElem,"babiaData")}},unregister:function(interestedElem){const index=this.interestedElements.indexOf(interestedElem);if(index>-1){this.interestedElements.splice(index,1)}},interestedElements:[],dataComponent:undefined,dataComponentDataPropertyName:"babiaData",dataComponentEventName:undefined,babiaData:undefined,babiaMetadata:{id:0},widthBars:1,proportion:undefined,valueMax:undefined});let findDataComponent=(data,el,self)=>{let eventName="babiaQuerierDataReady";if(data.from){let dataElement=document.getElementById(data.from);if(dataElement.components["babia-filter"]){self.dataComponent=dataElement.components["babia-filter"];eventName="babiaFilterDataReady"}else if(dataElement.components["babia-queryjson"]){self.dataComponent=dataElement.components["babia-queryjson"]}else if(dataElement.components["babia-queryes"]){self.dataComponent=dataElement.components["babia-queryes"]}else if(dataElement.components["babia-querygithub"]){self.dataComponent=dataElement.components["babia-querygithub"]}else{console.error("Problem registering to the querier");return}}else{if(el.components["babia-filter"]){self.dataComponent=el.components["babia-filter"];eventName="babiaFilterDataReady"}else if(el.components["babia-queryjson"]){self.dataComponent=el.components["babia-queryjson"]}else if(el.components["babia-queryes"]){self.dataComponent=el.components["babia-queryes"]}else if(el.components["babia-querygithub"]){self.dataComponent=el.components["babia-querygithub"]}else{if(document.querySelectorAll("[babia-filter]").length>0){self.dataComponent=document.querySelectorAll("[babia-filter]")[0].components["babia-filter"];eventName="babiaFilterDataReady"}else if(document.querySelectorAll("[babia-queryjson]").length>0){self.dataComponent=document.querySelectorAll("[babia-queryjson]")[0].components["babia-queryjson"]}else if(document.querySelectorAll("[babia-queryjson]").length>0){self.dataComponent=document.querySelectorAll("[babia-queryes]")[0].components["babia-queryes"]}else if(document.querySelectorAll("[babia-querygithub]").length>0){self.dataComponent=document.querySelectorAll("[babia-querygithub]")[0].components["babia-querygithub"]}else{console.error("Error, querier not found");return}}}return eventName};let attachNewDataEventCallback=(self,e)=>{self.dataComponentDataPropertyName=e.detail;let rawData=self.dataComponent[self.dataComponentDataPropertyName];self.babiaData=rawData;self.babiaMetadata={id:self.babiaMetadata.id++};while(self.el.firstChild)self.el.firstChild.remove();console.log("Generating barchart...");self.chart=generateBarChart(self.data,rawData,self.el,self.widthBars,self.proportion,self.valueMax);dataReadyToSend("babiaData",self)};let generateBarChart=(data,dataRetrieved,element,widthBars,proportion,valueMax)=>{if(dataRetrieved){const dataToPrint=dataRetrieved;const palette=data.palette;const title=data.title;const font=data.titleFont;const color=data.titleColor;const title_position=data.titlePosition;const scale=data.scale;const heightMax=data.heightMax;let colorid=0;let maxColorId=0;let stepX=0;let maxX=0;let keys_used={};let stepZ=0;let maxZ=0;let z_axis={};let xaxis_dict=[];let zaxis_dict=[];let animation=data.animation;let maxY=Math.max.apply(Math,dataToPrint.map(function(o){return o.height}));if(scale){maxY=maxY/scale}else if(heightMax){valueMax=maxY;proportion=heightMax/maxY;maxY=heightMax}let chart_entity=document.createElement("a-entity");chart_entity.classList.add("babiaxrChart");element.appendChild(chart_entity);for(let bar of dataToPrint){if(keys_used[bar[data.x_axis]]){stepX=keys_used[bar[data.x_axis]].posX;colorid=keys_used[bar[data.x_axis]].colorid}else{stepX=maxX;colorid=maxColorId;keys_used[bar[data.x_axis]]={posX:maxX,colorid:maxColorId};let bar_printed={colorid:colorid,posX:stepX,key:bar[data.x_axis]};xaxis_dict.push(bar_printed);maxX+=widthBars+widthBars/4;maxColorId++}if(z_axis[bar[data.z_axis]]){stepZ=z_axis[bar[data.z_axis]].posZ}else{stepZ=maxZ;z_axis[bar[data.z_axis]]={posZ:maxZ};let bar_printed={colorid:colorid,posZ:stepZ,key:bar[data.z_axis]};zaxis_dict.push(bar_printed);maxZ+=widthBars+widthBars/4}let barEntity=generateBar(bar[data.height],widthBars,colorid,stepX,stepZ,palette,animation,scale,proportion);barEntity.classList.add("babiaxraycasterclass");if(data.legend){showLegend(data,barEntity,bar,element,widthBars)}chart_entity.appendChild(barEntity);let title_3d=showTitle(title,font,color,title_position);element.appendChild(title_3d)}if(data.axis){showXAxis(element,maxX,xaxis_dict,palette,widthBars);showZAxis(element,maxZ,zaxis_dict,palette,widthBars);showYAxis(element,maxY,scale,widthBars,proportion,valueMax)}}};function generateBar(size,width,colorid,positionX,positionZ,palette,animation,scale,proportion){let color=getColor(colorid,palette);console.log("Generating bar...");if(scale){size=size/scale}else if(proportion){size=proportion*size}let entity=document.createElement("a-box");entity.setAttribute("color",color);entity.setAttribute("width",width);entity.setAttribute("depth",width);if(animation){var duration=4e3;var increment=10*size/duration;var height=0;var id=setInterval(animation,10);function animation(){if(height>=size){clearInterval(id)}else{height+=increment;entity.setAttribute("height",height);entity.setAttribute("position",{x:positionX,y:height/2,z:positionZ})}}}else{entity.setAttribute("height",size);entity.setAttribute("position",{x:positionX,y:size/2,z:positionZ})}return entity}function getColor(colorid,palette){let color;for(let i in colors){if(colors[i][palette]){color=colors[i][palette][colorid%4]}}return color}function generateLegend(data,bar,barEntity,widthBars){let text=bar[data.x_axis]+": "+bar[data.height];let width=2;if(text.length>16)width=text.length/8;let barPosition=barEntity.getAttribute("position");let entity=document.createElement("a-plane");entity.setAttribute("position",{x:barPosition.x,y:2*barPosition.y+1,z:barPosition.z+widthBars+.1});entity.setAttribute("rotation",{x:0,y:0,z:0});entity.setAttribute("height","1");entity.setAttribute("width",width);entity.setAttribute("color","white");entity.setAttribute("text",{value:text,align:"center",width:6,color:"black"});entity.classList.add("babiaxrLegend");return entity}function showLegend(data,barEntity,bar,element,widthBars){barEntity.addEventListener("mouseenter",function(){this.setAttribute("scale",{x:1.1,y:1.1,z:1.1});legend=generateLegend(data,bar,barEntity,widthBars);element.appendChild(legend)});barEntity.addEventListener("mouseleave",function(){this.setAttribute("scale",{x:1,y:1,z:1});element.removeChild(legend)})}function showXAxis(parent,xEnd,bars_printed,palette,widthBars){let axis=document.createElement("a-entity");let axis_line=document.createElement("a-entity");axis_line.setAttribute("line__xaxis",{start:{x:-widthBars,y:0,z:0},end:{x:xEnd,y:0,z:0},color:"#ffffff"});axis_line.setAttribute("position",{x:0,y:0,z:-(widthBars/2+widthBars/4)});axis.appendChild(axis_line);bars_printed.forEach(e=>{let color=getColor(e.colorid,palette);let key=document.createElement("a-entity");key.setAttribute("text",{value:e.key,align:"left",width:10,color:color});key.setAttribute("position",{x:e.posX,y:0,z:-widthBars-5});key.setAttribute("rotation",{x:-90,y:90,z:0});axis.appendChild(key)});parent.appendChild(axis)}function showZAxis(parent,zEnd,bars_printed,palette,widthBars){let axis=document.createElement("a-entity");let axis_line=document.createElement("a-entity");axis_line.setAttribute("line__xaxis",{start:{x:0,y:0,z:-(widthBars/2+widthBars/4)},end:{x:0,y:0,z:zEnd},color:"#ffffff"});axis_line.setAttribute("position",{x:-widthBars,y:0,z:0});axis.appendChild(axis_line);bars_printed.forEach(e=>{let key=document.createElement("a-entity");let color=getColor(e.colorid,palette);key.setAttribute("text",{value:e.key,align:"right",width:10,color:color});key.setAttribute("position",{x:-widthBars-5.2,y:0,z:e.posZ});key.setAttribute("rotation",{x:-90,y:0,z:0});axis.appendChild(key)});parent.appendChild(axis)}function showYAxis(parent,yEnd,scale,widthBars,proportion,valueMax){let axis=document.createElement("a-entity");let yLimit=yEnd;let axis_line=document.createElement("a-entity");axis_line.setAttribute("line__yaxis",{start:{x:-widthBars,y:0,z:0},end:{x:-widthBars,y:yEnd,z:0},color:"#ffffff"});axis_line.setAttribute("position",{x:0,y:0,z:-(widthBars/2+widthBars/4)});axis.appendChild(axis_line);if(proportion){yLimit=yLimit/proportion;var mod=Math.floor(Math.log10(valueMax))}for(let i=0;i<=yLimit;i++){let key=document.createElement("a-entity");let value=i;let pow=Math.pow(10,mod-1);if(!proportion||proportion&&i%pow===0){key.setAttribute("text",{value:value,align:"right",width:10,color:"white "});if(scale){key.setAttribute("text",{value:value*scale});key.setAttribute("position",{x:-widthBars-5.2,y:value,z:-(widthBars/2+widthBars/4)})}else{key.setAttribute("position",{x:-widthBars-5.2,y:i*proportion,z:-(widthBars/2+widthBars/4)})}}axis.appendChild(key)}parent.appendChild(axis)}function showTitle(title,font,color,position){let entity=document.createElement("a-entity");entity.setAttribute("text-geometry",{value:title});if(font){entity.setAttribute("text-geometry",{font:font})}if(color){entity.setAttribute("material",{color:color})}var position=position.split(" ");entity.setAttribute("position",{x:position[0],y:position[1],z:position[2]});entity.setAttribute("rotation",{x:0,y:0,z:0});entity.classList.add("babiaxrTitle");return entity}let colors=[{blues:["#142850","#27496d","#00909e","#dae1e7"]},{foxy:["#f79071","#fa744f","#16817a","#024249"]},{flat:["#120136","#035aa6","#40bad5","#fcbf1e"]},{sunset:["#202040","#543864","#ff6363","#ffbd69"]},{bussiness:["#de7119","#dee3e2","#116979","#18b0b0"]},{icecream:["#f76a8c","#f8dc88","#f8fab8","#ccf0e1"]},{ubuntu:["#511845","#900c3f","#c70039","#ff5733"]},{pearl:["#efa8e4","#f8e1f4","#fff0f5","#97e5ef"]},{commerce:["#222831","#30475e","#f2a365","#ececec"]}];let dataReadyToSend=(propertyName,self)=>{self.interestedElements.forEach(element=>{dispatchEventOnElement(element,propertyName)})};let dispatchEventOnElement=(element,propertyName)=>{element.emit("babiaVisualizerUpdated",propertyName)}},function(module,exports){if(typeof AFRAME==="undefined"){throw new Error("Component attempted to register before AFRAME was available.")}AFRAME.registerComponent("babia-boats",{schema:{data:{type:"asset"},from:{type:"string"},border:{type:"number",default:.5},width:{type:"string",default:"width"},depth:{type:"string",default:"depth"},area:{type:"string"},color:{type:"string"},height:{type:"string",default:"height"},zone_elevation:{type:"number",default:.3},building_separation:{type:"number",default:.25},extra:{type:"number",default:1},levels:{type:"number"},building_color:{type:"string",default:"#E6B9A1"},base_color:{type:"color",default:"#98e690"},min_building_height:{type:"number",default:1},height_quarter_legend_box:{type:"number",default:11},height_quarter_legend_title:{type:"number",default:12}},register:function(interestedElem){let el=this.el;this.interestedElements.push(interestedElem);if(this.babiaData){dispatchEventOnElement(interestedElem,"babiaData")}},unregister:function(interestedElem){const index=this.interestedElements.indexOf(interestedElem);if(index>-1){this.interestedElements.splice(index,1)}},interestedElements:[],dataComponent:undefined,dataComponentDataPropertyName:"babiaData",dataComponentEventName:undefined,babiaData:undefined,babiaMetadata:{id:0},visProperties:["height","area","width","depth"],multiple:false,init:function(){},duration:2e3,update:function(oldData){let data=this.data;let el=this.el;let self=this;this.figures=[];if(data.data&&oldData.data!==data.data){let rawData;if(typeof data.data=="string"){if(data.data.endsWith("json")){rawData=requestJSONDataFromURL(data)}else{rawData=parseEmbeddedJSONData(data.data)}}else{rawData=data.data}self.babiaData=rawData;self.babiaMetadata={id:self.babiaMetadata.id++};if(data.color){let[color_max,color_min]=getMaxMinColorValues(rawData,data.color);self.babiaMetadata["color_max"]=color_max;self.babiaMetadata["color_min"]=color_min}self.chart=self.onDataLoaded(rawData)}else{if(data.from!==oldData.from){if(self.dataComponent){self.dataComponent.unregister(el)}findTreeGenerator(data,el,self);el.addEventListener("babiaTreeDataReady",function(e){self.querierDataPropertyName=e.detail;let rawData=self.dataComponent[self.querierDataPropertyName];self.babiaData=rawData;self.babiaMetadata={id:self.babiaMetadata.id++};if(self.data.color){let[color_max,color_min]=getMaxMinColorValues(rawData,self.data.color);self.babiaMetadata["color_max"]=color_max;self.babiaMetadata["color_min"]=color_min}self.chart=self.onDataLoaded(self.babiaData);dataReadyToSend("babiaData",self)});self.dataComponent.register(el)}if(data!==oldData&&self.babiaData){while(self.el.firstChild)self.el.firstChild.remove();console.log("Generating city...");self.chart=self.onDataLoaded(self.babiaData);dataReadyToSend("babiaData",self)}}return},remove:function(){},tick:function(t,delta){if(this.animation){let t={x:0,y:0,z:0};this.Animation(this.el,this.figures,this.figures_old,delta,t,t)}},pause:function(){},play:function(){},onDataLoaded:function(items){console.log("Data Loaded.");let el=this.el;let elements=items;let increment;if(this.data.levels){increment=this.data.border*this.data.extra*this.data.levels}else{let levels=getLevels(elements,0);console.log("Levels:"+levels);increment=this.data.border*this.data.extra*(levels+1)}let t={x:0,y:0,z:0};[x,y,t,this.figures]=this.generateElements(elements,this.figures,t,increment);t.x=0;t.z=0;if(!this.figures_old){this.drawElements(el,this.figures,t);this.figures_old=this.figures}else{console.log("Updating elements...");this.animation=true;this.start_time=Date.now()}},generateElements:function(elements,figures,translate,inc){var increment=inc;var limit_up=0;var limit_down=0;var limit_right=0;var limit_left=0;var posX=0;var posY=0;var max_right=0;var max_left=0;var max_down=0;var max_up=0;var current_vertical=0;var current_horizontal=0;var up=false;var down=false;var left=false;var right=true;for(let i=0;i<elements.length;i++){let element={};if(this.data.width){element.width=elements[i][this.data.width]||.5}if(this.data.height){element.height=elements[i][this.data.height]||this.data.min_building_height}if(this.data.depth){element.depth=elements[i][this.data.depth]||.5}if(this.data.area){element.area=elements[i][this.data.area]||.5}if(elements[i].children){element.children=elements[i].children;this.quarter=true;var children=[];var translate_matrix;element.height=this.data.zone_elevation;increment-=this.data.border*this.data.extra;[element.width,element.depth,translate_matrix,children]=this.generateElements(element.children,children,translate_matrix,increment);translate_matrix.y=element.height;increment=inc}if(i==0){if(this.data.area&&!elements[i].children){limit_up+=Math.sqrt(element.area)/2;limit_down-=Math.sqrt(element.area)/2;limit_right+=Math.sqrt(element.area)/2;limit_left-=Math.sqrt(element.area)/2}else{limit_up+=element.depth/2;limit_down-=element.depth/2;limit_right+=element.width/2;limit_left-=element.width/2}current_horizontal=limit_up+this.data.building_separation/2}else if(element.height>0){if(up){[current_vertical,posX,posY,max_up]=this.UpSide(element,limit_up,current_vertical,max_up);if(current_vertical>limit_right){current_vertical+=this.data.building_separation/2;max_right=current_vertical;up=false;right=true;if(max_left<limit_left){limit_left=max_left}current_horizontal=limit_up+this.data.building_separation/2}}else if(right){[current_horizontal,posX,posY,max_right]=this.RightSide(element,limit_right,current_horizontal,max_right);if(current_horizontal<limit_down){current_horizontal+=this.data.building_separation/2;max_down=current_horizontal;right=false;down=true;if(max_up>limit_up){limit_up=max_up}current_vertical=limit_right+this.data.building_separation/2}}else if(down){[current_vertical,posX,posY,max_down]=this.DownSide(element,limit_down,current_vertical,max_down);if(current_vertical<limit_left){current_vertical-=this.data.building_separation/2;max_left=current_vertical;down=false;left=true;if(max_right>limit_right){limit_right=max_right}current_horizontal=limit_down-this.data.building_separation/2}}else if(left){[current_horizontal,posX,posY,max_left]=this.LeftSide(element,limit_left,current_horizontal,max_left);if(current_horizontal>limit_up){current_horizontal-=this.data.building_separation/2;max_up=current_horizontal;left=false;up=true;if(max_down<limit_down){limit_down=max_down}current_vertical=limit_left-this.data.building_separation/2}}}let figure;if(elements[i].children){figure={id:"boat-"+elements[i].id,name:elements[i].id,posX:posX,posY:posY,width:element.width,height:element.height,depth:element.depth,children:children,translate_matrix:translate_matrix}}else{if(this.data.area){figure={id:"boat-"+elements[i].id,name:elements[i].id,posX:posX,posY:posY,width:Math.sqrt(element.area),height:element.height,depth:Math.sqrt(element.area)}}else{figure={id:"boat-"+elements[i].id,name:elements[i].id,posX:posX,posY:posY,width:element.width,height:element.height,depth:element.depth}}}figure.rawData=elements[i];figures.push(figure)}if(max_down<limit_down){limit_down=max_down}if(max_left<limit_left){limit_left=max_left}if(max_up>limit_up){limit_up=max_up}if(max_right>limit_right){limit_right=max_right}if(current_vertical<limit_left){limit_left=current_vertical+this.data.building_separation/2}if(current_vertical>limit_right){limit_right=current_vertical-this.data.building_separation/2}if(current_horizontal>limit_up){limit_up=current_horizontal-this.data.building_separation/2}if(current_horizontal<limit_down){limit_down=current_horizontal+this.data.building_separation/2}var width=Math.abs(limit_left)+Math.abs(limit_right);var depth=Math.abs(limit_down)+Math.abs(limit_up);width+=2*increment;depth+=2*increment;var translate_x=limit_left+width/2-increment;var translate_z=limit_down+depth/2-increment;translate={x:translate_x,y:0,z:translate_z};return[width,depth,translate,figures]},drawElements:function(element,figures,translate){let self=this;for(let i in figures){let height=figures[i].height;let x=figures[i].posX;let y=figures[i].posY;let position={x:x-translate.x,y:height/2+translate.y/2,z:-y+translate.z};let entity=this.createElement(figures[i],position);if(figures[i].children){let legend;let transparentBox;entity.addEventListener("click",function(e){if(e.target!==this)return;if(legend){entity.removeChild(transparentBox);self.el.parentElement.removeChild(legend);legend=undefined;transparentBox=undefined}else{transparentBox=document.createElement("a-entity");let oldGeometry=entity.getAttribute("geometry");let scale=self.el.getAttribute("scale");let tsBoxHeight=oldGeometry.height+self.data.height_quarter_legend_box;if(scale){tsBoxHeight=(oldGeometry.height+self.data.height_quarter_legend_box)/scale.y}transparentBox.setAttribute("geometry",{height:tsBoxHeight,depth:oldGeometry.depth,width:oldGeometry.width});transparentBox.setAttribute("material",{visible:true,opacity:.4});entity.appendChild(transparentBox);legend=generateLegend(figures[i].name,"black","white");let worldPos=new THREE.Vector3;let coordinates=worldPos.setFromMatrixPosition(entity.object3D.matrixWorld);let coordinatesFinal={x:coordinates.x,y:self.data.height_quarter_legend_title,z:coordinates.z};legend.setAttribute("position",coordinatesFinal);legend.setAttribute("visible",true);self.el.parentElement.appendChild(legend)}});this.drawElements(entity,figures[i].children,figures[i].translate_matrix)}else{let legend;let entityGeometry;let alreadyActive=false;entity.addEventListener("click",function(){if(alreadyActive){legend.setAttribute("visible",false);entity.setAttribute("geometry",{height:entityGeometry.height-.1,depth:entityGeometry.depth-.1,width:entityGeometry.width-.1});entity.setAttribute("material",{color:entity.getAttribute("babiaxrFirstColor")});self.el.parentElement.removeChild(legend);legend=undefined;alreadyActive=false}else{alreadyActive=true}});entity.addEventListener("mouseenter",function(){if(!alreadyActive){entityGeometry=entity.getAttribute("geometry");let boxPosition=entity.getAttribute("position");entity.setAttribute("position",boxPosition);entity.setAttribute("babiaxrFirstColor",entity.getAttribute("material")["color"]);entity.setAttribute("material",{color:"white"});entity.setAttribute("geometry",{height:entityGeometry.height+.1,depth:entityGeometry.depth+.1,width:entityGeometry.width+.1});legend=generateLegend(figures[i].name,"white","black",figures[i].rawData,self.data.height,self.data.area,self.data.depth,self.data.width,self.data.color);let worldPos=new THREE.Vector3;let coordinates=worldPos.setFromMatrixPosition(entity.object3D.matrixWorld);let height_real=(new THREE.Box3).setFromObject(entity.object3D);let coordinatesFinal={x:coordinates.x,y:height_real.max.y+1,z:coordinates.z};legend.setAttribute("position",coordinatesFinal);legend.setAttribute("visible",true);self.el.parentElement.appendChild(legend)}});entity.addEventListener("mouseleave",function(){if(!alreadyActive&&legend){legend.setAttribute("visible",false);entity.setAttribute("geometry",{height:entityGeometry.height-.1,depth:entityGeometry.depth-.1,width:entityGeometry.width-.1});entity.setAttribute("material",{color:entity.getAttribute("babiaxrFirstColor")});self.el.parentElement.removeChild(legend);legend=undefined}})}element.appendChild(entity)}},RightSide:function(element,limit_right,current_horizontal,max_right){let separation=parseFloat(this.data.building_separation);let width,depth;if(this.data.area&&!element.children){width=Math.sqrt(element.area);depth=Math.sqrt(element.area)+separation}else{width=parseFloat(element.width);depth=parseFloat(element.depth)+separation}let posX=limit_right+width/2+separation;let posY=current_horizontal-depth/2;current_horizontal-=depth;let total_x=limit_right+width+separation;if(total_x>max_right){max_right=total_x}return[current_horizontal,posX,posY,max_right]},DownSide:function(element,limit_down,current_vertical,max_down){let separation=parseFloat(this.data.building_separation);let width,depth;if(this.data.area&&!element.children){width=Math.sqrt(element.area)+separation;depth=Math.sqrt(element.area)}else{width=parseFloat(element.width)+separation;depth=parseFloat(element.depth)}let posX=current_vertical-width/2;let posY=limit_down-depth/2-separation;current_vertical-=depth+separation;let total_y=limit_down-depth-separation;if(total_y<max_down){max_down=total_y}return[current_vertical,posX,posY,max_down]},LeftSide:function(element,limit_left,current_horizontal,max_left){let separation=parseFloat(this.data.building_separation);let width,depth;if(this.data.area&&!element.children){width=Math.sqrt(element.area);depth=Math.sqrt(element.area)+separation}else{width=parseFloat(element.width);depth=parseFloat(element.depth)+separation}let posX=limit_left-width/2-separation;let posY=current_horizontal+depth/2;current_horizontal+=depth;let total_x=limit_left-width-separation;if(total_x<max_left){max_left=total_x}return[current_horizontal,posX,posY,max_left]},UpSide:function(element,limit_up,current_vertical,max_up){let separation=parseFloat(this.data.building_separation);let width,depth;if(this.data.area&&!element.children){width=Math.sqrt(element.area)+separation;depth=Math.sqrt(element.area)}else{width=parseFloat(element.width)+separation;depth=parseFloat(element.depth)}let posX=current_vertical+width/2;let posY=limit_up+depth/2+separation;current_vertical+=depth+separation;let total_y=limit_up+depth+separation;if(total_y>max_up){max_up=total_y}return[current_vertical,posX,posY,max_up]},Animation:function(element,figures,figures_old,delta,translate,translate_old){let self=this;let new_time=Date.now();let entity;for(let i in figures){if(document.getElementById(figures[i].id)){entity=document.getElementById(figures[i].id);if(figures[i].inserted){let opa_inc=delta/this.duration;let opacity=parseFloat(entity.getAttribute("material").opacity);if(opacity+opa_inc<1){opacity+=opa_inc}else{opacity=1}setOpacity(entity,opacity)}else{this.resize(entity,new_time,delta,figures[i],figures_old[i]);this.traslate(entity,new_time,delta,figures[i],figures_old[i],translate,translate_old);if(figures[i].children){this.Animation(entity,figures[i].children,figures_old[i].children,delta,figures[i].translate_matrix,figures_old[i].translate_matrix)}}}else{position={x:figures[i].posX-translate.x,y:figures[i].height/2+translate.y/2,z:-figures[i].posY+translate.z};let new_entity=this.createElement(figures[i],position);if(figures[i].children){this.drawElements(new_entity,figures[i].children,figures[i].translate_matrix)}setOpacity(new_entity,0);element.appendChild(new_entity);figures[i].inserted=true}}if(new_time-this.start_time>this.duration){this.animation=false;this.figures_old=this.figures}},resize:function(entity,new_time,delta,figure,figure_old){if(new_time-this.start_time<this.duration&&(figure.width!=figure_old.width||figure.height!=figure_old.height||figure.depth!=figure_old.depth)){let diff_width=Math.abs(figure.width-figure_old.width);let diff_height=Math.abs(figure.height-figure_old.height);let diff_depth=Math.abs(figure.depth-figure_old.depth);let inc_width=delta*diff_width/this.duration;let inc_height=delta*diff_height/this.duration;let inc_depth=delta*diff_depth/this.duration;let last_width=parseFloat(entity.getAttribute("width"));let last_height=parseFloat(entity.getAttribute("height"));let last_depth=parseFloat(entity.getAttribute("depth"));let new_width;if(figure.width-figure_old.width<0){new_width=last_width-inc_width}else{new_width=last_width+inc_width}let new_height;if(figure.height-figure_old.height<0){new_height=last_height-inc_height}else{new_height=last_height+inc_height}let new_depth;if(figure.depth-figure_old.depth<0){new_depth=last_depth-inc_depth}else{new_depth=last_depth+inc_depth}entity.setAttribute("width",new_width);entity.setAttribute("height",new_height);entity.setAttribute("depth",new_depth)}else if(new_time-this.start_time>this.duration&&(figure.width!=figure_old.width||figure.height!=figure_old.height||figure.depth!=figure_old.depth)){entity.setAttribute("width",figure.width);entity.setAttribute("height",figure.height);entity.setAttribute("depth",figure.depth)}},traslate:function(entity,new_time,delta,figure,figure_old,translate,translate_old){let dist_x=figure_old.posX-translate_old.x-(figure.posX-translate.x);let dist_y=figure_old.posY-translate_old.z-(figure.posY-translate.z);if(dist_x!=0||dist_y!=0){if(new_time-this.start_time<this.duration){let inc_x=delta*dist_x/this.duration;let inc_z=delta*dist_y/this.duration;let last_x=entity.getAttribute("position").x;let last_z=entity.getAttribute("position").z;let new_x=last_x-inc_x;let new_z=last_z+inc_z;let new_height=entity.getAttribute("height");entity.setAttribute("position",{x:new_x,y:new_height/2,z:new_z})}else if(new_time-this.start_time>this.duration){entity.setAttribute("position",{x:figure.posX-translate.x,y:figure.height/2,z:-figure.posY+translate.z})}}},createElement:function(figure,position){let self=this;let entity=document.createElement("a-box");entity.id=figure.id;entity.setAttribute("class","babiaxraycasterclass");let width=figure.width;let height=figure.height;let depth=figure.depth;if(figure.children){color=self.data.base_color}else{if(self.data.color){color=heatMapColorforValue(figure.rawData[self.data.color],self.babiaMetadata["color_max"],self.babiaMetadata["color_min"])}else{color=self.data.building_color}}entity.setAttribute("color",color);entity.setAttribute("width",width);entity.setAttribute("height",height);entity.setAttribute("depth",depth);entity.setAttribute("position",{x:position.x,y:position.y,z:position.z});return entity}});let countDecimals=function(value){if(Math.floor(value)===value)return 0;return value.toString().split(".")[1].length||0};let generateLegend=(name,colorPlane,colorText,data,fheight,farea,fdepth,fwidth,fcolor)=>{let width=2;let height=1;if(name.length>16)width=name.length/6;if(data){let heightText="\n "+fheight+" (height): "+Math.round(data[fheight]*100)/100;if(heightText.length>16)width=heightText.length/6;name+=heightText;if(farea){let areaText="\n "+farea+" (area): "+Math.round(data[farea]*100)/100;if(areaText.length>16&&areaText>heightText)width=areaText.length/6;name+=areaText}else{let depthText="\n "+fdepth+" (depth): "+Math.round(data[fdepth]*100)/100;if(depthText.length>16&&depthText>heightText)width=depthText.length/6;name+=depthText;let widthText="\n "+fwidth+" (width): "+Math.round(data[fwidth]*100)/100;if(widthText.length>16&&widthText>heightText&&widthText>depthText)width=widthText.length/6;name+=widthText;height=1.5}if(fcolor){let colorText="\n "+fcolor+" (color): "+Math.round(data[fcolor]*100)/100;if(colorText.length>16&&colorText>heightText)width=colorText.length/6;name+=colorText;height+=.2}}let entity=document.createElement("a-plane");entity.setAttribute("babia-lookat","[camera]");entity.setAttribute("rotation",{x:0,y:0,z:0});entity.setAttribute("height",height);entity.setAttribute("width",width);entity.setAttribute("color",colorPlane);entity.setAttribute("material",{side:"double"});entity.setAttribute("text",{value:name,align:"center",width:6,color:colorText});entity.setAttribute("visible",false);return entity};function setOpacity(entity,opacity){entity.setAttribute("material","opacity",opacity);if(entity.childNodes){for(let i=0;i<entity.childNodes.length;i++){setOpacity(entity.childNodes[i],opacity)}}}let getLevels=(elements,levels)=>{let level=levels;let max_level=levels;for(let i in elements){if(elements[i].children){level++;levels=getLevels(elements[i].children,level);if(max_level<levels){max_level=levels}level--}}return max_level};let requestJSONDataFromURL=data=>{let items=data.data;let raw_items;let request=new XMLHttpRequest;request.open("get",items,false);request.onload=function(){if(this.status>=200&&this.status<300){if(typeof request.response==="string"||request.response instanceof String){raw_items=JSON.parse(request.response)}else{raw_items=request.response}}else{reject({status:this.status,statusText:xhr.statusText})}};request.onerror=function(){reject({status:this.status,statusText:xhr.statusText})};request.send();return raw_items};let findTreeGenerator=(data,el,self)=>{if(data.from){let querierElement=document.getElementById(data.from);if(querierElement.components["babia-treebuilder"]){self.dataComponent=querierElement.components["babia-treebuilder"]}else{console.error("Problem registering to the treegenerator");return}}else{if(el.components["babia-treebuilder"]){self.dataComponent=el.components["babia-treebuilder"]}else{if(document.querySelectorAll("[babia-treebuilder]").length>0){self.dataComponent=document.querySelectorAll("[babia-treebuilder]")[0].components["babia-treebuilder"]}else{console.error("Error, treegenerator not found");return}}}};let parseEmbeddedJSONData=embedded=>{let dataRetrieved=JSON.parse(embedded);return dataRetrieved};let dataReadyToSend=(propertyName,self)=>{self.interestedElements.forEach(element=>{dispatchEventOnElement(element,propertyName)})};let dispatchEventOnElement=(element,propertyName)=>{element.emit("babiaVisualizerUpdated",propertyName)};let getMaxMinColorValues=(data,colorfield,max,min)=>{for(let i=0;i<data.length;i++){if(data[i].children){[max,min]=getMaxMinColorValues(data[i].children,colorfield,max,min)}else{if(data[i][colorfield]!=="null"&&!max||data[i][colorfield]>max){max=data[i][colorfield]}if(data[i][colorfield]!=="null"&&!min||data[i][colorfield]<min){min=data[i][colorfield]}}}return[max,min]};function heatMapColorforValue(val,max,min){let value=((val||0)-min)/(max-min);let h=(1-value)*240;return"hsl("+h+", 100%, 50%)"}},function(module,exports){if(typeof AFRAME==="undefined"){throw new Error("Component attempted to register before AFRAME was available.")}AFRAME.registerComponent("babia-bubbles",{schema:{data:{type:"string"},height:{type:"string",default:"height"},radius:{type:"string",default:"radius"},x_axis:{type:"string",default:"x_axis"},z_axis:{type:"string",default:"z_axis"},from:{type:"string"},legend:{type:"boolean"},axis:{type:"boolean",default:true},animation:{type:"boolean",default:false},palette:{type:"string",default:"ubuntu"},title:{type:"string"},titleFont:{type:"string"},titleColor:{type:"string"},titlePosition:{type:"string",default:"0 0 0"},scale:{type:"number"},heightMax:{type:"number"},radiusMax:{type:"number"}},visProperties:["height","radius","x_axis","z_axis"],multiple:false,init:function(){},update:function(oldData){const self=this;let data=this.data;let el=this.el;if(data.data&&oldData.data!==data.data){self.babiaData=self.data;self.babiaMetadata={id:self.babiaMetadata.id++};while(self.el.firstChild)self.el.firstChild.remove();console.log("Generating 3Dcylynderchart from data...");self.chart=generateBubblesChart(self.data,JSON.parse(self.data.data),self.el,self.proportion,self.valueMax,self.widthBubbles,self.radius_scale);dataReadyToSend("babiaData",self)}else{if(data.from!==oldData.from){if(self.dataComponent){self.dataComponent.unregister(el)}let eventName=findDataComponent(data,el,self);if(self.dataComponentEventName&&self.dataComponentEventName!==eventName){el.removeEventListener(self.dataComponentEventName,_listener,true)}self.dataComponentEventName=eventName;el.addEventListener(self.dataComponentEventName,_listener=(e=>{attachNewDataEventCallback(self,e)}));self.dataComponent.register(el);return}if(data!==oldData&&self.babiaData){while(self.el.firstChild)self.el.firstChild.remove();console.log("Generating Cylinder...");self.chart=generateBubblesChart(self.data,self.babiaData,self.el,self.proportion,self.valueMax,self.widthBubbles,self.radius_scale);dataReadyToSend("babiaData",self)}}},remove:function(){},pause:function(){},play:function(){},register:function(interestedElem){let el=this.el;this.interestedElements.push(interestedElem);if(this.babiaData){dispatchEventOnElement(interestedElem,"babiaData")}},unregister:function(interestedElem){const index=this.interestedElements.indexOf(interestedElem);if(index>-1){this.interestedElements.splice(index,1)}},interestedElements:[],proportion:undefined,valueMax:undefined,widthBubbles:0,radius_scale:undefined,dataComponent:undefined,dataComponentDataPropertyName:"babiaData",dataComponentEventName:undefined,babiaData:undefined,babiaMetadata:{id:0}});let findDataComponent=(data,el,self)=>{let eventName="babiaQuerierDataReady";if(data.from){let dataElement=document.getElementById(data.from);if(dataElement.components["babia-filter"]){self.dataComponent=dataElement.components["babia-filter"];eventName="babiaFilterDataReady"}else if(dataElement.components["babia-queryjson"]){self.dataComponent=dataElement.components["babia-queryjson"]}else if(dataElement.components["babia-queryes"]){self.dataComponent=dataElement.components["babia-queryes"]}else if(dataElement.components["babia-querygithub"]){self.dataComponent=dataElement.components["babia-querygithub"]}else{console.error("Problem registering to the querier");return}}else{if(el.components["babia-filter"]){self.dataComponent=el.components["babia-filter"];eventName="babiaFilterDataReady"}else if(el.components["babia-queryjson"]){self.dataComponent=el.components["babia-queryjson"]}else if(el.components["babia-queryes"]){self.dataComponent=el.components["babia-queryes"]}else if(el.components["babia-querygithub"]){self.dataComponent=el.components["babia-querygithub"]}else{if(document.querySelectorAll("[babia-filter]").length>0){self.dataComponent=document.querySelectorAll("[babia-filter]")[0].components["babia-filter"];eventName="babiaFilterDataReady"}else if(document.querySelectorAll("[babia-queryjson]").length>0){self.dataComponent=document.querySelectorAll("[babia-queryjson]")[0].components["babia-queryjson"]}else if(document.querySelectorAll("[babia-queryjson]").length>0){self.dataComponent=document.querySelectorAll("[babia-queryes]")[0].components["babia-queryes"]}else if(document.querySelectorAll("[babia-querygithub]").length>0){self.dataComponent=document.querySelectorAll("[babia-querygithub]")[0].components["babia-querygithub"]}else{console.error("Error, querier not found");return}}}return eventName};let attachNewDataEventCallback=(self,e)=>{self.dataComponentDataPropertyName=e.detail;let rawData=self.dataComponent[self.dataComponentDataPropertyName];self.babiaData=rawData;self.babiaMetadata={id:self.babiaMetadata.id++};while(self.el.firstChild)self.el.firstChild.remove();console.log("Generating Bubbles...");self.chart=generateBubblesChart(self.data,rawData,self.el,self.proportion,self.valueMax,self.widthBubbles,self.radius_scale);dataReadyToSend("babiaData",self)};let generateBubblesChart=(data,dataRetrieved,element,proportion,valueMax,widthBubbles,radius_scale)=>{if(dataRetrieved){const dataToPrint=dataRetrieved;const palette=data.palette;const title=data.title;const font=data.titleFont;const color=data.titleColor;const title_position=data.titlePosition;const scale=data.scale;const heightMax=data.heightMax;const radiusMax=data.radiusMax;let stepMax;let colorid=0;let maxColorId=0;let stepX=0;let maxX=0;let keys_used={};let stepZ=0;let maxZ=0;let z_axis={};let xaxis_dict=[];let zaxis_dict=[];let animation=data.animation;let maxY=Math.max.apply(Math,dataToPrint.map(function(o){return o[data.height]}));widthBubbles=Math.max.apply(Math,Object.keys(dataToPrint).map(function(o){return dataToPrint[o][data.radius]}));if(scale){maxY=maxY/scale;widthBubbles=widthBubbles/scale}else if(heightMax||radiusMax){if(heightMax){valueMax=maxY;proportion=heightMax/maxY;maxY=heightMax}if(radiusMax){stepMax=widthBubbles;radius_scale=radiusMax/widthBubbles;widthBubbles=radiusMax}}let chart_entity=document.createElement("a-entity");chart_entity.classList.add("babiaxrChart");element.appendChild(chart_entity);for(let bubble of dataToPrint){if(keys_used[bubble[data.x_axis]]){stepX=keys_used[bubble[data.x_axis]].posX;colorid=keys_used[bubble[data.x_axis]].colorid}else{stepX=maxX;colorid=maxColorId;keys_used[bubble[data.x_axis]]={posX:maxX,colorid:maxColorId};let bubble_printed={colorid:colorid,posX:stepX,key:bubble[data.x_axis]};xaxis_dict.push(bubble_printed);maxX+=2*widthBubbles;maxColorId++}if(z_axis[bubble[data.z_axis]]){stepZ=z_axis[bubble[data.z_axis]].posZ}else{stepZ=maxZ;z_axis[bubble[data.z_axis]]={posZ:maxZ};let bubble_printed={colorid:colorid,posZ:stepZ,key:bubble[data.z_axis]};zaxis_dict.push(bubble_printed);maxZ+=2*widthBubbles}let bubbleEntity=generateBubble(bubble[data.radius],bubble[data.height],widthBubbles,colorid,palette,stepX,stepZ,animation,scale,proportion,radius_scale);bubbleEntity.classList.add("babiaxraycasterclass");if(data.legend){showLegend(data,bubbleEntity,bubble,element)}chart_entity.appendChild(bubbleEntity)}if(data.axis){showXAxis(element,maxX,xaxis_dict,palette,widthBubbles);showZAxis(element,maxZ,zaxis_dict,palette,widthBubbles);showYAxis(element,maxY,scale,proportion,valueMax,widthBubbles)}let title_3d=showTitle(title,font,color,title_position);element.appendChild(title_3d)}};function generateBubble(radius,height,width,colorid,palette,positionX,positionZ,animation,scale,proportion,radius_scale){let color=getColor(colorid,palette);console.log("Generating bubble...");if(scale){height=height/scale;radius=radius/scale}else if(proportion||radius_scale){if(proportion){height=proportion*height}if(radius_scale){radius=radius_scale*radius}}let entity=document.createElement("a-sphere");entity.setAttribute("color",color);entity.setAttribute("radius",radius);if(animation){let from=positionX.toString()+" "+radius.toString()+" "+positionZ.toString();let to=positionX.toString()+" "+(radius+height).toString()+" "+positionZ.toString();entity.setAttribute("animation__position",{property:"position",from:from,to:to,dur:"3000",easing:"linear"})}else{entity.setAttribute("position",{x:positionX,y:radius+height,z:positionZ})}return entity}function getColor(colorid,palette){let color;for(let i in colors){if(colors[i][palette]){color=colors[i][palette][colorid%4]}}return color}function generateLegend(data,bubble,bubbleEntity){let text=bubble[data.x_axis]+": \n Radius:"+bubble[data.radius]+"\nHeight:"+bubble[data.height];let width=2;if(text.length>16)width=text.length/8;let bubblePosition=bubbleEntity.getAttribute("position");let bubbleRadius=parseFloat(bubbleEntity.getAttribute("radius"));let entity=document.createElement("a-plane");entity.setAttribute("position",{x:bubblePosition.x,y:bubblePosition.y+bubbleRadius+1,z:bubblePosition.z+.1});entity.setAttribute("rotation",{x:0,y:0,z:0});entity.setAttribute("height","1");entity.setAttribute("width",width);entity.setAttribute("color","white");entity.setAttribute("text",{value:text,align:"center",width:6,color:"black"});entity.classList.add("babiaxrLegend");return entity}function showLegend(data,bubbleEntity,bubble,element){bubbleEntity.addEventListener("mouseenter",function(){this.setAttribute("scale",{x:1.1,y:1.1,z:1.1});legend=generateLegend(data,bubble,bubbleEntity);element.appendChild(legend)});bubbleEntity.addEventListener("mouseleave",function(){this.setAttribute("scale",{x:1,y:1,z:1});element.removeChild(legend)})}function showXAxis(parent,xEnd,bubbles_printed,palette,widthBubbles){let axis=document.createElement("a-entity");let axis_line=document.createElement("a-entity");axis_line.setAttribute("line__xaxis",{start:{x:-widthBubbles,y:0,z:0},end:{x:xEnd,y:0,z:0},color:"#ffffff"});axis_line.setAttribute("position",{x:0,y:0,z:-(widthBubbles/2+widthBubbles/4)});axis.appendChild(axis_line);bubbles_printed.forEach(e=>{let key=document.createElement("a-entity");let color=getColor(e.colorid,palette);key.setAttribute("text",{value:e.key,align:"left",width:10,color:color});key.setAttribute("position",{x:e.posX,y:0,z:-widthBubbles-3.2});key.setAttribute("rotation",{x:-90,y:90,z:0});axis.appendChild(key)});parent.appendChild(axis)}function showZAxis(parent,zEnd,bubbles_printed,palette,widthBubbles){let axis=document.createElement("a-entity");let axis_line=document.createElement("a-entity");axis_line.setAttribute("line__xaxis",{start:{x:0,y:0,z:-(widthBubbles/2+widthBubbles/4)},end:{x:0,y:0,z:zEnd},color:"#ffffff"});axis_line.setAttribute("position",{x:-widthBubbles,y:0,z:0});axis.appendChild(axis_line);bubbles_printed.forEach(e=>{let key=document.createElement("a-entity");let color=getColor(e.colorid,palette);key.setAttribute("text",{value:e.key,align:"right",width:10,color:color});key.setAttribute("position",{x:-widthBubbles-5.2,y:0,z:e.posZ});key.setAttribute("rotation",{x:-90,y:0,z:0});axis.appendChild(key)});parent.appendChild(axis)}function showYAxis(parent,yEnd,scale,proportion,valueMax,widthBubbles){let axis=document.createElement("a-entity");let yLimit=yEnd;let axis_line=document.createElement("a-entity");axis_line.setAttribute("line__yaxis",{start:{x:-widthBubbles,y:0,z:0},end:{x:-widthBubbles,y:yLimit,z:0},color:"#ffffff"});axis_line.setAttribute("position",{x:0,y:0,z:-(widthBubbles/2+widthBubbles/4)});axis.appendChild(axis_line);if(proportion){yLimit=yLimit/proportion;var mod=Math.floor(Math.log10(valueMax))}for(let i=0;i<=yLimit;i++){let key=document.createElement("a-entity");let value=i;let pow=Math.pow(10,mod-1);if(!proportion||proportion&&i%pow===0){key.setAttribute("text",{value:value,align:"right",width:10,color:"white "});if(scale){key.setAttribute("text",{value:value*scale});key.setAttribute("position",{x:-widthBubbles-5.2,y:value,z:-(widthBubbles/2+widthBubbles/4)})}else if(proportion){key.setAttribute("position",{x:-widthBubbles-5.2,y:i*proportion,z:-(widthBubbles/2+widthBubbles/4)})}else{key.setAttribute("position",{x:-widthBubbles-5.2,y:i,z:-(widthBubbles/2+widthBubbles/4)})}}axis.appendChild(key)}parent.appendChild(axis)}function showTitle(title,font,color,position){let entity=document.createElement("a-entity");entity.setAttribute("text-geometry",{value:title});if(font){entity.setAttribute("text-geometry",{font:font})}if(color){entity.setAttribute("material",{color:color})}var position=position.split(" ");entity.setAttribute("position",{x:position[0],y:position[1],z:position[2]});entity.setAttribute("rotation",{x:0,y:0,z:0});entity.classList.add("babiaxrTitle");return entity}let colors=[{blues:["#142850","#27496d","#00909e","#dae1e7"]},{foxy:["#f79071","#fa744f","#16817a","#024249"]},{flat:["#120136","#035aa6","#40bad5","#fcbf1e"]},{sunset:["#202040","#543864","#ff6363","#ffbd69"]},{bussiness:["#de7119","#dee3e2","#116979","#18b0b0"]},{icecream:["#f76a8c","#f8dc88","#f8fab8","#ccf0e1"]},{ubuntu:["#511845","#900c3f","#c70039","#ff5733"]},{pearl:["#efa8e4","#f8e1f4","#fff0f5","#97e5ef"]},{commerce:["#222831","#30475e","#f2a365","#ececec"]}];let dataReadyToSend=(propertyName,self)=>{self.interestedElements.forEach(element=>{dispatchEventOnElement(element,propertyName)})};let dispatchEventOnElement=(element,propertyName)=>{element.emit("babiaVisualizerUpdated",propertyName)}},function(module,exports,__webpack_require__){if(typeof AFRAME==="undefined"){throw new Error("Component attempted to register before AFRAME was available.")}AFRAME.registerComponent("babia-city",{schema:{from:{type:"string"},absolute:{type:"boolean",default:false},width:{type:"number",default:20},depth:{type:"number",default:20},split:{type:"string",default:"naive"},data:{type:"string"},farea:{type:"string",default:"area"},fmaxarea:{type:"string",default:"max_area"},fheight:{type:"string",default:"height"},titles:{type:"boolean",default:true},building_color:{type:"color",default:"#E6B9A1"},building_model:{type:"string",default:null},base:{type:"boolean",default:true},base_thick:{type:"number",default:.2},base_color:{type:"color",default:"#98e690"},border:{type:"number",default:1},extra:{type:"number",default:1.4},zone_elevation:{type:"number",default:1},unicolor:{type:"color",default:false},wireframe:{type:"boolean",default:false},colormap:{type:"array",default:["blue","green","yellow","brown","orange","magenta","grey","cyan","azure","beige","blueviolet","coral","crimson","darkblue","darkgrey","orchid","olive","navy","palegreen"]},time_evolution_delta:{type:"number",default:8e3},time_evolution_init:{type:"string",default:"data_0"},time_evolution_past_present:{type:"boolean",default:false},time_evolution_animation:{type:"boolean",default:true},time_evolution_color:{type:"boolean",default:false},ui_navbar:{type:"string",default:""}},multiple:false,init:function(){},update:function(oldData){let data=this.data;let el=this.el;let self=this;if(data.data&&oldData.data!==data.data){let rawData;if(typeof data.data=="string"){if(data.data.endsWith("json")){rawData=requestJSONDataFromURL(data)}else{rawData=parseEmbeddedJSONData(data.data)}}else{rawData=data.data}self.babiaData=rawData;self.babiaMetadata={id:self.babiaMetadata.id++};self.chart=generateCity(self,rawData)}else{if(data.from!==oldData.from){if(self.dataComponent){self.dataComponent.unregister(el)}findTreeGenerator(data,el,self);el.addEventListener("babiaTreeDataReady",function(e){self.querierDataPropertyName=e.detail;let rawData=self.dataComponent[self.querierDataPropertyName];let toSave;if(rawData.length>0){toSave={id:"init",children:rawData}}else{toSave=rawData[0]}self.babiaData=toSave;self.babiaMetadata={id:self.babiaMetadata.id++};self.chart=generateCity(self,toSave);dataReadyToSend("babiaData",self)});self.dataComponent.register(el)}if(data!==oldData&&self.babiaData){while(self.el.firstChild)self.el.firstChild.remove();console.log("Generating city...");self.chart=generateCity(self,self.babiaData);dataReadyToSend("babiaData",self)}}return},remove:function(){},play:function(){},register:function(interestedElem){let el=this.el;this.interestedElements.push(interestedElem);if(this.babiaData){dispatchEventOnElement(interestedElem,"babiaData")}},unregister:function(interestedElem){const index=this.interestedElements.indexOf(interestedElem);if(index>-1){this.interestedElements.splice(index,1)}},interestedElements:[],dataComponent:undefined,dataComponentDataPropertyName:"babiaData",dataComponentEventName:undefined,babiaData:undefined,babiaMetadata:{id:0},visProperties:["fheight","farea"]});let generateCity=(self,raw_items)=>{self.loader=new THREE.FileLoader;let data=self.data;let el=self.el;currentColor=data.building_color;let rootCodecityEntity=el;el.emit("babiaxr-dataLoaded",{data:raw_items,codecity:true});deltaTimeEvolution=data.time_evolution_delta;self.zone_data=raw_items;let zone=new Zone({data:self.zone_data,extra:function(area){return area*data.extra},farea:data.farea,fheight:data.fheight,fmaxarea:data.fmaxarea});let width,depth;if(data.absolute==true){width=Math.sqrt(zone.areas.canvas)*data.width/data.depth;depth=zone.areas.canvas/width}else{width=data.width;depth=data.depth}let relative=false;let canvas=new Rectangle({width:width,depth:depth,x:0,z:0});zone.add_rects({rect:canvas,split:data.split,relative:relative});let base=document.createElement("a-entity");self.base=base;let visible=true;zone.draw_rects({ground:canvas,el:base,base:data.base,level:0,elevation:0,relative:relative,base_thick:data.base_thick,wireframe:data.wireframe,building_color:data.building_color,base_color:data.base_color,model:data.building_model,visible:visible,titles:data.titles,rootCodecityEntity:rootCodecityEntity});el.appendChild(base)};let Zone=class{constructor({data:data,extra:extra=function(area){return area},farea:farea="area",fmaxarea:fmaxarea="max_area",fheight:fheight="height"}){this.data=data;this.id=this.data.id;this.extra=extra;this.farea=farea;this.fmaxarea=fmaxarea;this.fheight=fheight;this.areas=this.areas_tree();this.el=null;this.pending_rects=0}areas_tree({data:data=this.data,level:level=0}={}){let data_node=data;let node={data:data_node};if("children"in data_node){node.inner=0;node.area=0;node.children=[];for(const data_child of data_node.children){let child=this.areas_tree({data:data_child,level:level+1});node.inner+=child.canvas;node.area+=child.area;node.children.push(child)}}else{node.area=data_node[this.farea]||.5;node.max_area=data_node[this.fmaxarea]||.5;node.inner=node.max_area;node.inner_real=node.area}node.canvas=this.extra(node.inner,level);return node}add_rects({rect:rect,area:area=this.areas,relative:relative=true,split:split="naive"}={}){area.rect=rect;area.rect.inner(area.canvas,area.inner,area.inner_real);if("children"in area){let child_areas=new Values(area.children.map(child=>child.canvas),area.inner);let child_rect;if(split==="naive"){child_rect=area.rect.split(child_areas,relative)}else if(split==="pivot"){child_rect=area.rect.split_pivot(child_areas,relative)}else{throw new Error("CodeCity: Unknwon split method")}for(const i in area.children){this.add_rects({rect:child_rect[i],area:area.children[i],relative:relative,split:split})}}}draw_rects({ground:ground,el:el,area:area=this.areas,level:level=0,elevation:elevation=0,relative:relative=true,base_thick:base_thick=.2,wireframe:wireframe=false,building_color:building_color="red",base_color:base_color="green",model:model=null,visible:visible=true,titles:titles=true,rootCodecityEntity:rootCodecityEntity}){let self=this;if(level===0){this.el=el}let pending_rects=this.pending_rects;if("children"in area){let base=area.rect.box({elevation:elevation,height:base_thick,color:base_color,inner:false,wireframe:wireframe,visible:visible,id:area.data["id"],rawarea:0});if(titles){let legend;let transparentBox;base.addEventListener("click",function(){if(legend){rootCodecityEntity.removeChild(transparentBox);rootCodecityEntity.parentElement.removeChild(legend);legend=undefined;transparentBox=undefined}else{transparentBox=document.createElement("a-entity");let oldGeometry=base.getAttribute("geometry");let boxPosition=base.getAttribute("position");let scale=rootCodecityEntity.getAttribute("scale");let tsBoxHeight=oldGeometry.height+11;if(scale){tsBoxHeight=(oldGeometry.height+11)/scale.y}transparentBox.setAttribute("geometry",{height:tsBoxHeight,depth:oldGeometry.depth,width:oldGeometry.width});transparentBox.setAttribute("position",boxPosition);transparentBox.setAttribute("material",{visible:true,opacity:.4});rootCodecityEntity.appendChild(transparentBox);legend=generateLegend(this.getAttribute("id"),"black","white");let worldPos=new THREE.Vector3;let coordinates=worldPos.setFromMatrixPosition(base.object3D.matrixWorld);let coordinatesFinal={x:coordinates.x,y:12,z:coordinates.z};legend.setAttribute("position",coordinatesFinal);legend.setAttribute("visible",true);rootCodecityEntity.parentElement.appendChild(legend)}})}base.setAttribute("class","babiaxraycasterclass");el.appendChild(base);let root_el=base;if(!relative){root_el=el}for(const child of area.children){let next_elevation=base_thick/2;if(!relative){next_elevation=elevation+base_thick}this.draw_rects({ground:area.rect,el:root_el,area:child,level:level+1,elevation:next_elevation,relative:relative,building_color:building_color,base_color:base_color,model:model,base_thick:base_thick,wireframe:wireframe,visible:visible,titles:titles,rootCodecityEntity:rootCodecityEntity})}}else{let box=area.rect.box({height:area.data[this.fheight],elevation:elevation,wireframe:wireframe,color:building_color,model:model,visible:visible,id:area.data["id"],rawarea:area.data[this.farea],inner_real:true});box.setAttribute("class","babiaxraycasterclass");el.appendChild(box);if(titles){let legend;let legendBox;let alreadyActive=false;box.addEventListener("click",function(){if(alreadyActive){legend.setAttribute("visible",false);legendBox.setAttribute("visible",false);rootCodecityEntity.parentElement.removeChild(legend);rootCodecityEntity.removeChild(legendBox);legend=undefined;legendBox=undefined;alreadyActive=false}else{alreadyActive=true}});box.addEventListener("mouseenter",function(){if(!alreadyActive){legendBox=document.createElement("a-entity");let oldGeometry=box.getAttribute("geometry");let boxPosition=box.getAttribute("position");legendBox.setAttribute("position",boxPosition);legendBox.setAttribute("material",{visible:true});legendBox.setAttribute("geometry",{height:oldGeometry.height+.1,depth:oldGeometry.depth+.1,width:oldGeometry.width+.1});legend=generateLegend(this.getAttribute("id"),"white","black",area.data,self.fheight,self.farea);let worldPos=new THREE.Vector3;let coordinates=worldPos.setFromMatrixPosition(box.object3D.matrixWorld);let height_real=(new THREE.Box3).setFromObject(box.object3D);let coordinatesFinal={x:coordinates.x,y:height_real.max.y+1,z:coordinates.z};legend.setAttribute("position",coordinatesFinal);legend.setAttribute("visible",true);rootCodecityEntity.parentElement.appendChild(legend);rootCodecityEntity.appendChild(legendBox)}});box.addEventListener("mouseleave",function(){if(!alreadyActive&&legend){legend.setAttribute("visible",false);legendBox.setAttribute("visible",false);rootCodecityEntity.parentElement.removeChild(legend);rootCodecityEntity.removeChild(legendBox);legend=undefined;legendBox=undefined}})}}}};let Values=class{constructor(values,total){this.items=values;if(typeof total!=="undefined"){this.total=total}else{this.total=values.reduce((acc,a)=>acc+a,0)}}imax(){let largest=this.items[0];let largest_i=0;for(let i=0;i<this.items.length;i++){if(largest<this.items[i]){largest=this.items[i];largest_i=i}}return largest_i}static range(start,length){var indexes=[];for(let i=start;i<start+length;i++){indexes.push(i)}return indexes}scaled_area(area,item){return this.items[item]*area/this.total}values_i(positions){let values=[];for(const position of positions){values.push(this.items[position])}return new Values(values)}pivot_regions(width,depth){if(this.items.length<3){throw new Error("CodeCity - Values.pivot_regions: less than three items")}if(width<depth){throw new Error("Codecity - Values.pivot_regions: rectangle should be laying")}let a1_len,a2_len,a3_len;let pivot_i=this.imax();if(this.items.lenght==pivot_i+1){return{pivot:pivot_i,a1:Values.range(0,pivot_i),a2:[],a3:[]}}if(this.items.length==pivot_i+2){return{pivot:pivot_i,a1:Values.range(0,pivot_i),a2:[pivot_i+1],a3:[]}}let area=width*depth;let pivot_area=this.scaled_area(area,pivot_i);let a2_width_ideal=Math.sqrt(pivot_area);let a2_area_ideal=a2_width_ideal*depth-pivot_area;let a2_area=0;let a2_area_last=a2_area;let i=pivot_i+1;while(a2_area<a2_area_ideal&&i<this.items.length){a2_area_last=a2_area;a2_area+=this.scaled_area(area,i);i++}let a3_first=i;if(i-1>pivot_i&&Math.abs(a2_area-a2_area_ideal)>Math.abs(a2_area_last-a2_area_ideal)){a3_first=i-1}a2_len=a3_first-pivot_i-1;a3_len=this.items.length-a3_first;return{pivot:pivot_i,a1:Values.range(0,pivot_i),a2:Values.range(pivot_i+1,a2_len),a3:Values.range(pivot_i+1+a2_len,a3_len)}}pivot_region_width(values,width){let region_total=0;for(const i of values){region_total+=this.items[i]}return region_total/this.total*width}};let Rectangle=class{constructor({width:width,depth:depth,x:x=0,z:z=0}){this.width=width;this.depth=depth;this.x=x;this.z=z}is_ilaying(){let longest=Math.max(this.width,this.depth);return longest==this.width}inner(acanvas,ainner,ainner_real){if(acanvas<ainner){throw"Rectangle.inner: Area for inner rectangle larger than my area"}if(typeof acanvas!=="undefined"){let ratio=Math.sqrt(ainner/acanvas);this.iwidth=ratio*this.width;this.idepth=ratio*this.depth;if(ainner_real){let ratio_real=Math.sqrt(ainner_real/acanvas);this.iwidth_real=ratio_real*this.width;this.idepth_real=ratio_real*this.depth}}else{this.iwidth=this.width;this.idepth=this.depth}}reflect(){[this.width,this.depth]=[this.depth,this.width];[this.x,this.z]=[this.z,this.x]}idims_as_laying(){if(this.is_ilaying()){return[this.iwidth,this.idepth,this.x,this.z,false]}else{return[this.idepth,this.iwidth,this.z,this.x,true]}}split(values,relative=true){let[width,depth,x,z,reflected]=this.idims_as_laying();let ratio=width/values.total;let current_x=-width/2;let current_z=0;if(!relative){current_x+=x;current_z=z}let rects=[];for(const value of values.items){let sub_width=value*ratio;let rect=new Rectangle({width:sub_width,depth:depth,x:current_x+sub_width/2,z:current_z});if(reflected){rect.reflect()}rects.push(rect);current_x+=sub_width}return rects}split_pivot(values,relative=true){if(values.items.length<=2){return this.split(values,relative)}let[width,depth,x,z,reflected]=this.idims_as_laying();if(relative){x=0;z=0}let{pivot:pivot,a1:a1,a2:a2,a3:a3}=values.pivot_regions(width,depth);let width_a1=values.pivot_region_width(a1,width);let width_a2=values.pivot_region_width(a2.concat(pivot),width);let width_a3=values.pivot_region_width(a3,width);let x_a1=x-width/2+width_a1/2;let x_a2=x-width/2+width_a1+width_a2/2;let x_a3=x-width/2+width_a1+width_a2+width_a3/2;let rects=[];let depth_pivot=values.scaled_area(width*depth,pivot)/width_a2;rects[pivot]=new Rectangle({width:width_a2,depth:depth_pivot,x:x_a2,z:z+depth/2-depth_pivot/2});let dim_areas=[[a1,width_a1,depth,x_a1,z],[a2,width_a2,depth-depth_pivot,x_a2,z-depth_pivot/2],[a3,width_a3,depth,x_a3,z]];for(const[values_i,width_i,depth_i,x_i,z_i]of dim_areas){if(values_i.length>0){let subrect=new Rectangle({width:width_i,depth:depth_i,x:x_i,z:z_i});subrect.inner();let subvalues=values.values_i(values_i);let rects_i=subrect.split_pivot(subvalues,false);let counter=0;for(const i of values_i){rects[i]=rects_i[counter];counter++}}}if(reflected){for(const rect of rects){rect.reflect()}}return rects}box({height:height,elevation:elevation=0,color:color="red",model:model=null,inner:inner=true,wireframe:wireframe=false,visible:visible=true,id:id="",rawarea:rawarea=0,inner_real:inner_real=false}){let depth,width;if(inner_real){[depth,width]=[this.idepth_real,this.iwidth_real]}else if(inner){[depth,width]=[this.idepth,this.iwidth]}else{[depth,width]=[this.depth,this.width]}let box=document.createElement("a-entity");box.setAttribute("geometry",{primitive:"box",skipCache:true,depth:depth,width:width,height:height});box.setAttribute("material",{color:color});box.setAttribute("position",{x:this.x,y:elevation+height/2,z:this.z});box.setAttribute("id",id);box.setAttribute("babiaxr-rawarea",rawarea);return box}};let rnd_producer=function(levels=2,number=3,area=20,height=30){if(levels==1){return{id:"A",area:Math.random()*area,height:Math.random()*height}}else if(levels>1){let children=Array.from({length:number},function(){return rnd_producer(levels-1,number,area,height)});return{id:"BlockAA",children:children}}};if(true){module.exports={Values:Values,Rectangle:Rectangle,Zone:Zone}}let requestJSONDataFromURL=data=>{let items=data.data;let raw_items;let request=new XMLHttpRequest;request.open("get",items,false);request.onload=function(){if(this.status>=200&&this.status<300){if(typeof request.response==="string"||request.response instanceof String){raw_items=JSON.parse(request.response)}else{raw_items=request.response}}else{reject({status:this.status,statusText:xhr.statusText})}};request.onerror=function(){reject({status:this.status,statusText:xhr.statusText})};request.send();if(raw_items.time_evolution){main_json=raw_items;time_evolution=true;time_evolution_commit_by_commit=raw_items.time_evolution_commit_by_commit;let first_tree=raw_items.data_files.find(o=>o.key_tree==="data_0_tree");raw_items=first_tree["data_0_tree"];initItems=first_tree["data_0"];let navbarData=[];for(let i=0;i<main_json.data_files.length;i++){let array_of_tree_to_retrieve="data_"+i;timeEvolutionItems[array_of_tree_to_retrieve]=main_json.data_files[i];navbarData.push({date:new Date(main_json.data_files[i].date*1e3).toLocaleDateString(),commit:main_json.data_files[i].commit_sha,data:i})}if(data.ui_navbar){if(data.time_evolution_past_present){last_uinavbar=parseInt(data.time_evolution_init.split("_")[1])}else{last_uinavbar=main_json.data_files.length-1}ui_navbar=data.ui_navbar;document.getElementById(ui_navbar).setAttribute("babiaxr-navigation-bar","commits",JSON.stringify(navbarData.reverse()))}if(data.time_evolution_init!=="data_0"){let key;if(timeEvolutionItems[data.time_evolution_init][data.time_evolution_init+"_allfiles"]){key=data.time_evolution_init+"_allfiles"}else{key=data.time_evolution_init}let leafEntities=findLeafs(raw_items["children"],{});timeEvolutionItems[data.time_evolution_init][key].forEach(item=>{if(leafEntities[item.id]){leafEntities[item.id].height=item.height;leafEntities[item.id].area=item.area;leafEntities[item.id].max_area=item.max_area}});index=parseInt(data.time_evolution_init.split("_")[1])}}return raw_items};let time_evolution=false;let time_evolution_animation=true;let time_evolution_color=false;let time_evolution_commit_by_commit=false;let ui_navbar=undefined;let last_uinavbar=undefined;let timeEvolutionItems={};let dateBarEntity;let deltaTimeEvolution=8e3;let main_json={};let initItems=undefined;let changedItems=[];let index=0;let timeEvolTimeout=undefined;let dateBar=data=>{let component;if(document.getElementById("scene")){component=document.getElementById("scene")}else{component=document.getElementsByTagName("a-scene");let entities=document.getElementsByTagName("a-entity")}let entity=document.createElement("a-entity");entity.classList.add("babiaxrDateBar");entity.setAttribute("position",{x:-13,y:10,z:-3});entity.setAttribute("rotation",{x:0,y:0,z:0});entity.setAttribute("material",{color:"black"});entity.setAttribute("height",.5);entity.setAttribute("width",2);entity.setAttribute("scale",{x:1,y:1,z:1});let text="Date: "+new Date(timeEvolutionItems[data.time_evolution_init].date*1e3).toLocaleDateString();if(timeEvolutionItems[data.time_evolution_init].commit_sha){text+="\n\nCommit: "+timeEvolutionItems[data.time_evolution_init].commit_sha}entity.setAttribute("text-geometry",{value:text});dateBarEntity=entity;component.appendChild(entity)};let countDecimals=function(value){if(Math.floor(value)===value)return 0;return value.toString().split(".")[1].length||0};let generateLegend=(name,colorPlane,colorText,data,fheight,farea)=>{let width=2;if(name.length>16)width=name.length/8;if(data){let heightText="\n "+fheight+" (height): "+data[fheight];if(heightText.length>16)width=heightText.length/8;name+=heightText;let areaText="\n "+farea+" (area): "+data[farea];if(areaText.length>16&&areaText>heightText)width=areaText.length/8;name+=areaText}let entity=document.createElement("a-plane");entity.setAttribute("babia-lookat","[camera]");entity.setAttribute("rotation",{x:0,y:0,z:0});entity.setAttribute("height","1");entity.setAttribute("width",width);entity.setAttribute("color",colorPlane);entity.setAttribute("material",{side:"double"});entity.setAttribute("text",{value:name,align:"center",width:6,color:colorText});entity.setAttribute("visible",false);return entity};function time_evol(){const maxFiles=Object.keys(timeEvolutionItems).length;let i=0;if(ui_navbar){document.addEventListener("babiaxrToPast",function(){time_evolution_past_present=false});document.addEventListener("babiaxrToPresent",function(){time_evolution_past_present=true});document.addEventListener("babiaxrStop",function(){clearInterval(timeEvolTimeout)});document.addEventListener("babiaxrContinue",function(){timeEvolTimeout=setTimeout(function(){loopLogic(maxFiles,i);if(i<maxFiles-1){loop()}},deltaTimeEvolution)});document.addEventListener("babiaxrSkipNext",function(){time_evolution_past_present=false;clearInterval(timeEvolTimeout);showLegendUiNavBar(maxFiles-index-1);last_uinavbar=maxFiles-index-1;i--;index--;changeCity()});document.addEventListener("babiaxrSkipPrev",function(){time_evolution_past_present=true;clearInterval(timeEvolTimeout);showLegendUiNavBar(maxFiles-index-3);last_uinavbar=maxFiles-index-3;i++;index++;changeCity()});document.addEventListener("babiaxrShow",function(event){clearInterval(timeEvolTimeout);eventData=event.detail.data;i=eventData.data;showLegendUiNavBar(maxFiles-i-1);last_uinavbar=maxFiles-i-1;index=i-1;changeCity(true)})}let loop=()=>{timeEvolTimeout=setTimeout(function(){if(ui_navbar){showLegendUiNavBar(maxFiles-index-2)}last_uinavbar=maxFiles-index-2;loopLogic(maxFiles,i);if(i<maxFiles-1){loop()}},deltaTimeEvolution)};let doIt=()=>{loop()};doIt()}let loopLogic=(maxFiles,i)=>{console.log("Loop number",i);changeCity();if(time_evolution_past_present){index--;if(index==0){console.log("finished")}i--}else{index++;i++;if(index>maxFiles-1){index=0}}};let changeCity=bigStepCommitByCommit=>{let key="data_"+(index+1);let key2;if(bigStepCommitByCommit){key2="data_"+(index+1)+"_allfiles"}else{if(time_evolution_past_present){key2="data_reverse_"+(index+1)}else{key2="data_"+(index+1)}}let text="Date: "+new Date(timeEvolutionItems[key].date*1e3).toLocaleDateString();if(timeEvolutionItems[key].commit_sha){text+="\n\nCommit: "+timeEvolutionItems[key].commit_sha}dateBarEntity.setAttribute("text-geometry","value",text);changedItems=[];if(time_evolution_color){currentColorPercentage+=5;if(currentColorPercentage!==80){currentColor=getNewBrightnessColor(currentColor,currentColorPercentage)}else{colorEvolutionArrayStartingPoint++;if(colorEvolutionArrayStartingPoint>colorEvolutionArray.length-1){colorEvolutionArrayStartingPoint=0}currentColor=colorEvolutionArray[colorEvolutionArrayStartingPoint];currentColorPercentage=20}}if(timeEvolutionItems[key][key2]){timeEvolutionItems[key][key2].forEach(item=>{changeBuildingLayout(item)})}else{timeEvolutionItems[key][key].forEach(item=>{changeBuildingLayout(item)})}if(!time_evolution_commit_by_commit){initItems.forEach(item=>{if(!changedItems.includes(item.id)){dissapearBuildingAnimation(item.id)}})}updateCity()};let currentColorPercentage=20;let currentColor;let colorEvolutionArray=["#000066","#006600","#666600","#660000"];let colorEvolutionArrayStartingPoint=0;let changeBuildingLayout=item=>{if(document.getElementById(item.id)!=undefined&&item.area!=0){changedItems.push(item.id);let prevPos=document.getElementById(item.id).getAttribute("position");let oldX=document.getElementById(item.id).getAttribute("position").x;let oldY=document.getElementById(item.id).getAttribute("position").y;let oldZ=document.getElementById(item.id).getAttribute("position").z;let prevWidth=document.getElementById(item.id).getAttribute("geometry").width;let prevDepth=document.getElementById(item.id).getAttribute("geometry").depth;let prevHeight=document.getElementById(item.id).getAttribute("geometry").height;let oldRawArea=parseFloat(document.getElementById(item.id).getAttribute("babiaxr-rawarea"));if(prevHeight.toFixed(6)!==item.height.toFixed(6)||oldRawArea.toFixed(6)!==item.area.toFixed(6)){if(time_evolution_color){document.getElementById(item.id).setAttribute("material",{color:currentColor})}let reverseWidthDepth=false;let AR=prevWidth/prevDepth;if(AR<1){reverseWidthDepth=true;AR=prevDepth/prevWidth}let newAreaDep=item.area*(prevDepth*prevWidth)/oldRawArea;let newWidth=Math.sqrt(newAreaDep*AR);let newDepth=Math.sqrt(newAreaDep/AR);if(reverseWidthDepth){newDepth=Math.sqrt(newAreaDep*AR);newWidth=Math.sqrt(newAreaDep/AR)}document.getElementById(item.id).setAttribute("babiaxr-rawarea",item.area);if(time_evolution_animation){let duration=500;if(newWidth>prevWidth||newDepth>prevDepth){let incrementWidth=20*(newWidth-prevWidth)/duration;let incrementDepth=20*(newDepth-prevDepth)/duration;let sizeWidth=prevWidth;let sizeDepth=prevDepth;let idIncA=setInterval(function(){animationAreaIncrease()},1);function animationAreaIncrease(){if(sizeWidth>=newWidth||sizeDepth>=newDepth){document.getElementById(item.id).setAttribute("geometry","width",newWidth);document.getElementById(item.id).setAttribute("geometry","depth",newDepth);clearInterval(idIncA)}else{sizeWidth+=incrementWidth;sizeDepth+=incrementDepth;document.getElementById(item.id).setAttribute("geometry","width",sizeWidth);document.getElementById(item.id).setAttribute("geometry","depth",sizeDepth)}}}else if(newWidth<prevWidth||newDepth<prevDepth){let incrementWidth=20*(prevWidth-newWidth)/duration;let incrementDepth=20*(prevDepth-newDepth)/duration;let sizeWidth=prevWidth;let sizeDepth=prevDepth;let idDecA=setInterval(function(){animationAreaDecrease()},1);function animationAreaDecrease(){if(sizeWidth<=newWidth||sizeDepth<=newDepth){document.getElementById(item.id).setAttribute("geometry","width",newWidth);document.getElementById(item.id).setAttribute("geometry","depth",newDepth);clearInterval(idDecA)}else{sizeWidth-=incrementWidth;sizeDepth-=incrementDepth;document.getElementById(item.id).setAttribute("geometry","width",sizeWidth);document.getElementById(item.id).setAttribute("geometry","depth",sizeDepth)}}}if(item.height<0){dissapearBuildingAnimation(item.id)}else if(item.height>prevHeight){let increment=20*(item.height-prevHeight)/duration;let size=prevHeight;let idIncH=setInterval(function(){animationHeightIncrease()},1);function animationHeightIncrease(){if(size>=item.height){document.getElementById(item.id).setAttribute("position",{x:oldX,y:oldY-prevHeight/2+item.height/2,z:oldZ});clearInterval(idIncH)}else{size+=increment;document.getElementById(item.id).setAttribute("geometry","height",size);document.getElementById(item.id).setAttribute("position",{x:oldX,y:oldY-prevHeight/2+size/2,z:oldZ})}}}else if(item.height<prevHeight){let increment=20*(prevHeight-item.height)/duration;let size=prevHeight;let idDecH=setInterval(function(){animationHeightDecrease()},1);function animationHeightDecrease(){if(size<=item.height){document.getElementById(item.id).setAttribute("position",{x:oldX,y:oldY-prevHeight/2+item.height/2,z:oldZ});clearInterval(idDecH)}else{size-=increment;document.getElementById(item.id).setAttribute("geometry","height",size);document.getElementById(item.id).setAttribute("position",{x:oldX,y:oldY-prevHeight/2+size/2,z:oldZ})}}}}else{document.getElementById(item.id).setAttribute("geometry","width",newWidth);document.getElementById(item.id).setAttribute("geometry","depth",newDepth);document.getElementById(item.id).setAttribute("geometry","height",item.height);document.getElementById(item.id).setAttribute("position",{x:prevPos.x,y:prevPos.y-prevHeight/2+item.height/2,z:prevPos.z})}}}};let dissapearBuildingAnimation=itemId=>{let oldColor=document.getElementById(itemId).getAttribute("material").color;document.getElementById(itemId).setAttribute("material",{color:"black"});document.getElementById(itemId).setAttribute("material",{opacity:"0.3"});let dissapearId=setInterval(function(){dissapearBuilding()},1e3);function dissapearBuilding(){let prevPos=document.getElementById(itemId).getAttribute("position");let prevHeight=document.getElementById(itemId).getAttribute("geometry").height;document.getElementById(itemId).setAttribute("geometry","height",-.1);document.getElementById(itemId).setAttribute("position",{x:prevPos.x,y:prevPos.y-prevHeight/2+-.1/2,z:prevPos.z});document.getElementById(itemId).setAttribute("material",{color:oldColor});document.getElementById(itemId).setAttribute("material",{opacity:"1.0"});clearInterval(dissapearId)}};let updateCity=()=>{console.log("Changing city")};let findLeafs=(data,entities)=>{data.forEach(item=>{if(item["children"]){findLeafs(item["children"],entities)}else{entities[item.id]=item}});return entities};let showLegendUiNavBar=i=>{let entities=document.getElementsByClassName("babiaxrTimeBar")[0].children;if(last_uinavbar||last_uinavbar==0){let pointToHide=entities[last_uinavbar];pointToHide.emit("removeinfo")}let pointToShow=entities[i];pointToShow.emit("showinfo")};function getNewBrightnessColor(rgbcode,brightness){let r=parseInt(rgbcode.slice(1,3),16),g=parseInt(rgbcode.slice(3,5),16),b=parseInt(rgbcode.slice(5,7),16),HSL=rgbToHsl(r,g,b),RGB;RGB=hslToRgb(HSL[0],HSL[1],brightness/100);rgbcode="#"+convertToTwoDigitHexCodeFromDecimal(RGB[0])+convertToTwoDigitHexCodeFromDecimal(RGB[1])+convertToTwoDigitHexCodeFromDecimal(RGB[2]);return rgbcode}function convertToTwoDigitHexCodeFromDecimal(decimal){let code=Math.round(decimal).toString(16);code.length>1||(code="0"+code);return code}function rgbToHsl(r,g,b){r/=255,g/=255,b/=255;let max=Math.max(r,g,b),min=Math.min(r,g,b);let h,s,l=(max+min)/2;if(max==min){h=s=0}else{let d=max-min;s=l>.5?d/(2-max-min):d/(max+min);switch(max){case r:h=(g-b)/d+(g<b?6:0);break;case g:h=(b-r)/d+2;break;case b:h=(r-g)/d+4;break}h/=6}return[h,s,l]}function hslToRgb(h,s,l){let r,g,b;if(s==0){r=g=b=l}else{function hue2rgb(p,q,t){if(t<0)t+=1;if(t>1)t-=1;if(t<1/6)return p+(q-p)*6*t;if(t<1/2)return q;if(t<2/3)return p+(q-p)*(2/3-t)*6;return p}let q=l<.5?l*(1+s):l+s-l*s;let p=2*l-q;r=hue2rgb(p,q,h+1/3);g=hue2rgb(p,q,h);b=hue2rgb(p,q,h-1/3)}return[r*255,g*255,b*255]}let parseEmbeddedJSONData=embedded=>{let dataRetrieved=JSON.parse(embedded);return dataRetrieved};let dataReadyToSend=(propertyName,self)=>{self.interestedElements.forEach(element=>{dispatchEventOnElement(element,propertyName)})};let dispatchEventOnElement=(element,propertyName)=>{element.emit("babiaVisualizerUpdated",propertyName)};let findTreeGenerator=(data,el,self)=>{if(data.from){let querierElement=document.getElementById(data.from);if(querierElement.components["babia-treebuilder"]){self.dataComponent=querierElement.components["babia-treebuilder"]}else{console.error("Problem registering to the treegenerator");return}}else{if(el.components["babia-treebuilder"]){self.dataComponent=el.components["babia-treebuilder"]}else{if(document.querySelectorAll("[babia-treebuilder]").length>0){self.dataComponent=document.querySelectorAll("[babia-treebuilder]")[0].components["babia-treebuilder"]}else{console.error("Error, treegenerator not found");return}}}}},function(module,exports){if(typeof AFRAME==="undefined"){throw new Error("Component attempted to register before AFRAME was available.")}AFRAME.registerComponent("babia-cyls",{schema:{data:{type:"string"},height:{type:"string",default:"height"},radius:{type:"string",default:"radius"},x_axis:{type:"string",default:"x_axis"},from:{type:"string"},legend:{type:"boolean"},axis:{type:"boolean",default:true},animation:{type:"boolean",default:false},palette:{type:"string",default:"ubuntu"},title:{type:"string"},titleFont:{type:"string"},titleColor:{type:"string"},titlePosition:{type:"string",default:"0 0 0"},scale:{type:"number"},heightMax:{type:"number"},radiusMax:{type:"number"}},visProperties:["height","radius","x_axis"],multiple:false,init:function(){},update:function(oldData){const self=this;let el=this.el;let data=this.data;if(data.data&&oldData.data!==data.data){self.babiaData=self.data;self.babiaMetadata={id:self.babiaMetadata.id++};while(self.el.firstChild)self.el.firstChild.remove();console.log("Generating 3Dcylynderchart from data...");self.chart=generateCylinderChart(self.data,JSON.parse(self.data.data),self.el,self.proportion,self.valueMax,self.maxRadius,self.radius_scale,self.firstradius);dataReadyToSend("babiaData",self)}else{if(data.from!==oldData.from){if(self.dataComponent){self.dataComponent.unregister(el)}let eventName=findDataComponent(data,el,self);if(self.dataComponentEventName&&self.dataComponentEventName!==eventName){el.removeEventListener(self.dataComponentEventName,_listener,true)}self.dataComponentEventName=eventName;el.addEventListener(self.dataComponentEventName,_listener=(e=>{attachNewDataEventCallback(self,e)}));self.dataComponent.register(el);return}if(data!==oldData&&self.babiaData){while(self.el.firstChild)self.el.firstChild.remove();console.log("Generating Cylinder...");self.chart=generateCylinderChart(self.data,self.babiaData,self.el,self.proportion,self.valueMax,self.maxRadius,self.radius_scale,self.firstradius);dataReadyToSend("babiaData",self)}}},remove:function(){},pause:function(){},play:function(){},register:function(interestedElem){let el=this.el;this.interestedElements.push(interestedElem);if(this.babiaData){dispatchEventOnElement(interestedElem,"babiaData")}},unregister:function(interestedElem){const index=this.interestedElements.indexOf(interestedElem);if(index>-1){this.interestedElements.splice(index,1)}},interestedElements:[],dataComponent:undefined,dataComponentDataPropertyName:"babiaData",dataComponentEventName:undefined,babiaData:undefined,babiaMetadata:{id:0},proportion:undefined,valueMax:undefined,maxRadius:undefined,radius_scale:undefined,firstradius:undefined});let findDataComponent=(data,el,self)=>{let eventName="babiaQuerierDataReady";if(data.from){let dataElement=document.getElementById(data.from);if(dataElement.components["babia-filter"]){self.dataComponent=dataElement.components["babia-filter"];eventName="babiaFilterDataReady"}else if(dataElement.components["babia-queryjson"]){self.dataComponent=dataElement.components["babia-queryjson"]}else if(dataElement.components["babia-queryes"]){self.dataComponent=dataElement.components["babia-queryes"]}else if(dataElement.components["babia-querygithub"]){self.dataComponent=dataElement.components["babia-querygithub"]}else{console.error("Problem registering to the querier");return}}else{if(el.components["babia-filter"]){self.dataComponent=el.components["babia-filter"];eventName="babiaFilterDataReady"}else if(el.components["babia-queryjson"]){self.dataComponent=el.components["babia-queryjson"]}else if(el.components["babia-queryes"]){self.dataComponent=el.components["babia-queryes"]}else if(el.components["babia-querygithub"]){self.dataComponent=el.components["babia-querygithub"]}else{if(document.querySelectorAll("[babia-filter]").length>0){self.dataComponent=document.querySelectorAll("[babia-filter]")[0].components["babia-filter"];eventName="babiaFilterDataReady"}else if(document.querySelectorAll("[babia-queryjson]").length>0){self.dataComponent=document.querySelectorAll("[babia-queryjson]")[0].components["babia-queryjson"]}else if(document.querySelectorAll("[babia-queryjson]").length>0){self.dataComponent=document.querySelectorAll("[babia-queryes]")[0].components["babia-queryes"]}else if(document.querySelectorAll("[babia-querygithub]").length>0){self.dataComponent=document.querySelectorAll("[babia-querygithub]")[0].components["babia-querygithub"]}else{console.error("Error, querier not found");return}}}return eventName};let attachNewDataEventCallback=(self,e)=>{self.dataComponentDataPropertyName=e.detail;let rawData=self.dataComponent[self.dataComponentDataPropertyName];self.babiaData=rawData;self.babiaMetadata={id:self.babiaMetadata.id++};while(self.el.firstChild)self.el.firstChild.remove();console.log("Generating Cylinder...");self.chart=generateCylinderChart(self.data,rawData,self.el,self.proportion,self.valueMax,self.maxRadius,self.radius_scale,self.firstradius);dataReadyToSend("babiaData",self)};let generateCylinderChart=(data,dataRetrieved,element,proportion,valueMax,maxRadius,radius_scale,firstradius)=>{if(dataRetrieved){const dataToPrint=dataRetrieved;const palette=data.palette;const title=data.title;const font=data.titleFont;const color=data.titleColor;const title_position=data.titlePosition;const scale=data.scale;const heightMax=data.heightMax;const radiusMax=data.radiusMax;let stepMax;let colorid=0;let stepX=0;let lastradius=0;let axis_dict=[];let animation=data.animation;let maxY=Math.max.apply(Math,dataToPrint.map(function(o){return o[data.height]}));maxRadius=Math.max.apply(Math,dataToPrint.map(function(o){return o[data.radius]}));if(scale){maxY=maxY/scale;maxRadius=maxRadius/scale}else if(heightMax||radiusMax){if(heightMax){valueMax=maxY;proportion=heightMax/maxY;maxY=heightMax}if(radiusMax){stepMax=maxRadius;radius_scale=radiusMax/maxRadius;maxRadius=radiusMax}}let chart_entity=document.createElement("a-entity");chart_entity.classList.add("babiaxrChart");element.appendChild(chart_entity);for(let cylinder of dataToPrint){let radius=cylinder[data.radius];let height=cylinder[data.height];if(cylinder!==dataToPrint[0]){if(scale){stepX+=lastradius+radius/scale+1}else if(radiusMax){stepX+=lastradius+radius*radius_scale+1}else{stepX+=lastradius+radius+1}}else{if(scale){firstradius=radius/scale}else if(radiusMax){firstradius=radius*radius_scale}else{firstradius=radius}}let cylinderEntity=generateCylinder(height,radius,colorid,palette,stepX,animation,scale,proportion,radius_scale);chart_entity.appendChild(cylinderEntity);cylinderEntity.classList.add("babiaxraycasterclass");if(data.legend){showLegend(data,cylinderEntity,cylinder,element,maxRadius)}let cylinder_printed={colorid:colorid,posX:stepX,key:cylinder[data.x_axis]};axis_dict.push(cylinder_printed);if(!scale&&!radius_scale){lastradius=radius}else{if(scale){lastradius=radius/scale}else{lastradius=radius_scale*radius}}colorid++}if(data.axis){showXAxis(element,stepX+lastradius,axis_dict,palette,maxRadius,firstradius);showYAxis(element,maxY,scale,proportion,valueMax,maxRadius,firstradius)}let title_3d=showTitle(title,font,color,title_position);element.appendChild(title_3d)}};function generateCylinder(height,radius,colorid,palette,position,animation,scale,proportion,radius_scale){let color=getColor(colorid,palette);let entity=document.createElement("a-cylinder");if(scale){height=height/scale;radius=radius/scale}else if(proportion||radius_scale){if(proportion){height=proportion*height}if(radius_scale){radius=radius_scale*radius}}entity.setAttribute("color",color);entity.setAttribute("height",0);entity.setAttribute("radius",radius);if(animation){var duration=4e3;var increment=20*height/duration;var size=0;var id=setInterval(animation,1);function animation(){if(size>=height){clearInterval(id)}else{size+=increment;entity.setAttribute("height",size);entity.setAttribute("position",{x:position,y:size/2,z:0})}}}else{entity.setAttribute("height",height);entity.setAttribute("position",{x:position,y:height/2,z:0})}return entity}function getColor(colorid,palette){let color;for(let i in colors){if(colors[i][palette]){color=colors[i][palette][colorid%4]}}return color}function showXAxis(parent,xEnd,cylinder_printed,palette,maxRadius,firstradius){let axis=document.createElement("a-entity");let axis_line=document.createElement("a-entity");axis_line.setAttribute("line__xaxis",{start:{x:-firstradius,y:0,z:0},end:{x:xEnd,y:0,z:0},color:"#ffffff"});axis_line.setAttribute("position",{x:0,y:0,z:maxRadius+1});axis.appendChild(axis_line);cylinder_printed.forEach(e=>{let key=document.createElement("a-entity");let color=getColor(e.colorid,palette);key.setAttribute("text",{value:e.key,align:"right",width:20,color:color});key.setAttribute("position",{x:e.posX,y:.1,z:maxRadius+11.5});key.setAttribute("rotation",{x:-90,y:90,z:0});axis.appendChild(key)});parent.appendChild(axis)}function showYAxis(parent,yEnd,scale,proportion,valueMax,maxRadius,firstradius){let axis=document.createElement("a-entity");let yLimit=yEnd;let axis_line=document.createElement("a-entity");axis_line.setAttribute("line__yaxis",{start:{x:-firstradius,y:0,z:0},end:{x:-firstradius,y:yEnd,z:0},color:"#ffffff"});axis_line.setAttribute("position",{x:0,y:0,z:maxRadius+1});axis.appendChild(axis_line);if(proportion){yLimit=yLimit/proportion;var mod=Math.floor(Math.log10(valueMax))}for(let i=0;i<=yLimit;i++){let key=document.createElement("a-entity");let value=i;let pow=Math.pow(10,mod-1);if(!proportion||proportion&&i%pow===0){key.setAttribute("text",{value:value,align:"right",width:10,color:"white "});if(scale){key.setAttribute("text",{value:value*scale});key.setAttribute("position",{x:-maxRadius-5.2,y:value,z:maxRadius+1})}else if(proportion){key.setAttribute("position",{x:-maxRadius-5.2,y:i*proportion,z:maxRadius+1})}else{key.setAttribute("position",{x:-maxRadius-5.2,y:i,z:maxRadius+1})}}axis.appendChild(key)}parent.appendChild(axis)}function showLegend(data,cylinderEntity,cylinder,element,maxRadius){cylinderEntity.addEventListener("mouseenter",function(){this.setAttribute("scale",{x:1.1,y:1.1,z:1.1});legend=generateLegend(data,cylinder,cylinderEntity,maxRadius);element.appendChild(legend)});cylinderEntity.addEventListener("mouseleave",function(){this.setAttribute("scale",{x:1,y:1,z:1});element.removeChild(legend)})}function generateLegend(data,cylinder,cylinderEntity,maxRadius){let text=cylinder[data.x_axis]+": "+cylinder[data.height];let width=5;if(text.length>16)width=text.length/2;let cylinderPosition=cylinderEntity.getAttribute("position");let entity=document.createElement("a-plane");entity.setAttribute("position",{x:cylinderPosition.x,y:2*cylinderPosition.y+2,z:cylinderPosition.z+maxRadius+.5});entity.setAttribute("rotation",{x:0,y:0,z:0});entity.setAttribute("height","1.5");entity.setAttribute("width",width);entity.setAttribute("color","white");entity.setAttribute("text",{value:cylinder[data.x_axis]+": "+cylinder[data.height],align:"center",width:20,color:"black"});entity.classList.add("babiaxrLegend");return entity}function showTitle(title,font,color,position){let entity=document.createElement("a-entity");entity.setAttribute("text-geometry",{value:title});if(font){entity.setAttribute("text-geometry",{font:font})}if(color){entity.setAttribute("material",{color:color})}var position=position.split(" ");entity.setAttribute("position",{x:position[0],y:position[1],z:position[2]});entity.setAttribute("rotation",{x:0,y:0,z:0});entity.classList.add("babiaxrTitle");return entity}let colors=[{blues:["#142850","#27496d","#00909e","#dae1e7"]},{foxy:["#f79071","#fa744f","#16817a","#024249"]},{flat:["#120136","#035aa6","#40bad5","#fcbf1e"]},{sunset:["#202040","#543864","#ff6363","#ffbd69"]},{bussiness:["#de7119","#dee3e2","#116979","#18b0b0"]},{icecream:["#f76a8c","#f8dc88","#f8fab8","#ccf0e1"]},{ubuntu:["#511845","#900c3f","#c70039","#ff5733"]},{pearl:["#efa8e4","#f8e1f4","#fff0f5","#97e5ef"]},{commerce:["#222831","#30475e","#f2a365","#ececec"]}];let dataReadyToSend=(propertyName,self)=>{self.interestedElements.forEach(element=>{dispatchEventOnElement(element,propertyName)})};let dispatchEventOnElement=(element,propertyName)=>{element.emit("babiaVisualizerUpdated",propertyName)}},function(module,exports){if(typeof AFRAME==="undefined"){throw new Error("Component attempted to register before AFRAME was available.")}AFRAME.registerComponent("babia-cylsmap",{schema:{data:{type:"string"},height:{type:"string",default:"height"},radius:{type:"string",default:"radius"},x_axis:{type:"string",default:"x_axis"},z_axis:{type:"string",default:"z_axis"},from:{type:"string"},legend:{type:"boolean"},axis:{type:"boolean",default:true},animation:{type:"boolean",default:false},palette:{type:"string",default:"ubuntu"},title:{type:"string"},titleFont:{type:"string"},titleColor:{type:"string"},titlePosition:{type:"string",default:"0 0 0"},scale:{type:"number"},heightMax:{type:"number"},radiusMax:{type:"number"}},visProperties:["height","radius","x_axis","z_axis"],multiple:false,init:function(){},update:function(oldData){const self=this;let el=this.el;let data=this.data;if(data.data&&oldData.data!==data.data){self.babiaData=self.data;self.babiaMetadata={id:self.babiaMetadata.id++};while(self.el.firstChild)self.el.firstChild.remove();console.log("Generating 3Dcylynderchart from data...");self.chart=generateCylinderChart(self.data,JSON.parse(data.data),self.el,self.maxRadius,self.proportion,self.valueMax,self.radius_scale);dataReadyToSend("babiaData",self)}else{if(data.from!==oldData.from){if(self.dataComponent){self.dataComponent.unregister(el)}let eventName=findDataComponent(data,el,self);if(self.dataComponentEventName&&self.dataComponentEventName!==eventName){el.removeEventListener(self.dataComponentEventName,_listener,true)}self.dataComponentEventName=eventName;el.addEventListener(self.dataComponentEventName,_listener=(e=>{attachNewDataEventCallback(self,e)}));self.dataComponent.register(el);return}if(data!==oldData&&self.babiaData){while(self.el.firstChild)self.el.firstChild.remove();console.log("Generating Cylinder...");self.chart=generateCylinderChart(self.data,self.babiaData,self.el,self.maxRadius,self.proportion,self.valueMax,self.radius_scale);dataReadyToSend("babiaData",self)}}},remove:function(){},pause:function(){},play:function(){},register:function(interestedElem){let el=this.el;this.interestedElements.push(interestedElem);if(this.babiaData){dispatchEventOnElement(interestedElem,"babiaData")}},unregister:function(interestedElem){const index=this.interestedElements.indexOf(interestedElem);if(index>-1){this.interestedElements.splice(index,1)}},interestedElements:[],dataComponent:undefined,dataComponentDataPropertyName:"babiaData",dataComponentEventName:undefined,babiaData:undefined,babiaMetadata:{id:0},proportion:undefined,valueMax:undefined,maxRadius:undefined,radius_scale:undefined});let findDataComponent=(data,el,self)=>{let eventName="babiaQuerierDataReady";if(data.from){let dataElement=document.getElementById(data.from);if(dataElement.components["babia-filter"]){self.dataComponent=dataElement.components["babia-filter"];eventName="babiaFilterDataReady"}else if(dataElement.components["babia-queryjson"]){self.dataComponent=dataElement.components["babia-queryjson"]}else if(dataElement.components["babia-queryes"]){self.dataComponent=dataElement.components["babia-queryes"]}else if(dataElement.components["babia-querygithub"]){self.dataComponent=dataElement.components["babia-querygithub"]}else{console.error("Problem registering to the querier");return}}else{if(el.components["babia-filter"]){self.dataComponent=el.components["babia-filter"];eventName="babiaFilterDataReady"}else if(el.components["babia-queryjson"]){self.dataComponent=el.components["babia-queryjson"]}else if(el.components["babia-queryes"]){self.dataComponent=el.components["babia-queryes"]}else if(el.components["babia-querygithub"]){self.dataComponent=el.components["babia-querygithub"]}else{if(document.querySelectorAll("[babia-filter]").length>0){self.dataComponent=document.querySelectorAll("[babia-filter]")[0].components["babia-filter"];eventName="babiaFilterDataReady"}else if(document.querySelectorAll("[babia-queryjson]").length>0){self.dataComponent=document.querySelectorAll("[babia-queryjson]")[0].components["babia-queryjson"]}else if(document.querySelectorAll("[babia-queryjson]").length>0){self.dataComponent=document.querySelectorAll("[babia-queryes]")[0].components["babia-queryes"]}else if(document.querySelectorAll("[babia-querygithub]").length>0){self.dataComponent=document.querySelectorAll("[babia-querygithub]")[0].components["babia-querygithub"]}else{console.error("Error, querier not found");return}}}return eventName};let attachNewDataEventCallback=(self,e)=>{self.dataComponentDataPropertyName=e.detail;let rawData=self.dataComponent[self.dataComponentDataPropertyName];self.babiaData=rawData;self.babiaMetadata={id:self.babiaMetadata.id++};while(self.el.firstChild)self.el.firstChild.remove();console.log("Generating Cylinder...");self.chart=generateCylinderChart(self.data,rawData,self.el,self.maxRadius,self.proportion,self.valueMax,self.radius_scale);dataReadyToSend("babiaData",self)};let generateCylinderChart=(data,dataRetrieved,element,maxRadius,proportion,valueMax,radius_scale)=>{let stepMax;if(dataRetrieved){const dataToPrint=dataRetrieved;const palette=data.palette;const title=data.title;const font=data.titleFont;const color=data.titleColor;const title_position=data.titlePosition;const scale=data.scale;const heightMax=data.heightMax;const radiusMax=data.radiusMax;let colorid=0;let maxColorId=0;let stepX=0;let maxX=0;let keys_used={};let stepZ=0;let maxZ=0;let z_axis={};let xaxis_dict=[];let zaxis_dict=[];let animation=data.animation;let maxY=Math.max.apply(Math,dataToPrint.map(function(o){return o[data.height]}));maxRadius=Math.max.apply(Math,dataToPrint.map(function(o){return o[data.radius]}));if(scale){maxY=maxY/scale;maxRadius=maxRadius/scale}else if(heightMax||radiusMax){if(heightMax){valueMax=maxY;proportion=heightMax/maxY;maxY=heightMax}if(radiusMax){stepMax=maxRadius;radius_scale=radiusMax/maxRadius;maxRadius=radiusMax}}let chart_entity=document.createElement("a-entity");chart_entity.classList.add("babiaxrChart");element.appendChild(chart_entity);for(let cylinder of dataToPrint){if(keys_used[cylinder[data.x_axis]]){stepX=keys_used[cylinder[data.x_axis]].posX;colorid=keys_used[cylinder[data.x_axis]].colorid}else{stepX=maxX;colorid=maxColorId;keys_used[cylinder[data.x_axis]]={posX:maxX,colorid:maxColorId};let cylinder_printed={colorid:colorid,posX:stepX,key:cylinder[data.x_axis]};xaxis_dict.push(cylinder_printed);maxX+=2*maxRadius+1;maxColorId++}if(z_axis[cylinder[data.z_axis]]){stepZ=z_axis[cylinder[data.z_axis]].posZ}else{stepZ=maxZ;z_axis[cylinder[data.z_axis]]={posZ:maxZ};let cylinder_printed={colorid:colorid,posZ:stepZ,key:cylinder[data.z_axis]};zaxis_dict.push(cylinder_printed);maxZ+=2*maxRadius+1}let cylinderEntity=generateCylinder(cylinder[data.height],cylinder[data.radius],colorid,palette,stepX,stepZ,animation,scale,proportion,radius_scale);cylinderEntity.classList.add("babiaxraycasterclass");if(data.legend){showLegend(data,cylinderEntity,cylinder,element)}chart_entity.appendChild(cylinderEntity,element);let title_3d=showTitle(title,font,color,title_position);element.appendChild(title_3d)}if(data.axis){showXAxis(element,maxX,xaxis_dict,palette,maxRadius);showZAxis(element,maxZ,zaxis_dict,maxRadius);showYAxis(element,maxY,scale,maxRadius,proportion,valueMax)}}};function generateCylinder(height,radius,colorid,palette,positionX,positionZ,animation,scale,proportion,radius_scale){let color=getColor(colorid,palette);let entity=document.createElement("a-cylinder");if(scale){height=height/scale;radius=radius/scale}else if(proportion||radius_scale){if(proportion){height=proportion*height}if(radius_scale){radius=radius_scale*radius}}entity.setAttribute("color",color);entity.setAttribute("height",0);entity.setAttribute("radius",radius);if(animation){var duration=4e3;var increment=20*height/duration;var size=0;var id=setInterval(animation,1);function animation(){if(size>=height){clearInterval(id)}else{size+=increment;entity.setAttribute("height",size);entity.setAttribute("position",{x:positionX,y:size/2,z:positionZ})}}}else{entity.setAttribute("height",height);entity.setAttribute("position",{x:positionX,y:height/2,z:positionZ})}return entity}function getColor(colorid,palette){let color;for(let i in colors){if(colors[i][palette]){color=colors[i][palette][colorid%4]}}return color}function showXAxis(parent,xEnd,cylinder_printed,palette,maxRadius){let axis=document.createElement("a-entity");let axis_line=document.createElement("a-entity");axis_line.setAttribute("line__xaxis",{start:{x:-maxRadius-1,y:0,z:-maxRadius},end:{x:xEnd,y:0,z:-maxRadius},color:"#ffffff"});axis_line.setAttribute("position",{x:0,y:.1,z:-1});axis.appendChild(axis_line);cylinder_printed.forEach(e=>{let key=document.createElement("a-entity");let color=getColor(e.colorid,palette);key.setAttribute("text",{value:e.key,align:"left",width:30,color:color});key.setAttribute("position",{x:e.posX,y:.1,z:-maxRadius-16.5});key.setAttribute("rotation",{x:-90,y:90,z:0});axis.appendChild(key)});parent.appendChild(axis)}function showYAxis(parent,yEnd,scale,maxRadius,proportion,valueMax){let axis=document.createElement("a-entity");let yLimit=yEnd;let axis_line=document.createElement("a-entity");axis_line.setAttribute("line__yaxis",{start:{x:-maxRadius,y:0,z:0},end:{x:-maxRadius,y:yEnd,z:0},color:"#ffffff"});axis_line.setAttribute("position",{x:-1,y:0,z:-maxRadius-1});axis.appendChild(axis_line);if(proportion){yLimit=yLimit/proportion;var mod=Math.floor(Math.log10(valueMax))}for(let i=0;i<=yLimit;i++){let key=document.createElement("a-entity");let value=i;let pow=Math.pow(10,mod-1);if(!proportion||proportion&&i%pow===0){key.setAttribute("text",{value:value,align:"right",width:10,color:"white "});if(scale){key.setAttribute("text",{value:value*scale});key.setAttribute("position",{x:-maxRadius-6.5,y:value,z:-maxRadius-1})}else if(proportion){key.setAttribute("position",{x:-maxRadius-6.5,y:i*proportion,z:-maxRadius-1})}else{key.setAttribute("position",{x:-maxRadius-6.5,y:i,z:-maxRadius-1})}}axis.appendChild(key)}parent.appendChild(axis)}function showZAxis(parent,zEnd,cylinder_printed,maxRadius){let axis=document.createElement("a-entity");let axis_line=document.createElement("a-entity");axis_line.setAttribute("line__xaxis",{start:{x:-maxRadius,y:.1,z:0},end:{x:-maxRadius,y:.1,z:zEnd+maxRadius},color:"#ffffff"});axis_line.setAttribute("position",{x:-1,y:0,z:-maxRadius-1});axis.appendChild(axis_line);cylinder_printed.forEach(e=>{let key=document.createElement("a-entity");key.setAttribute("text",{value:e.key,align:"right",width:30,color:"#ffffff"});key.setAttribute("position",{x:-maxRadius-16.5,y:.1,z:e.posZ});key.setAttribute("rotation",{x:-90,y:.1,z:0});axis.appendChild(key)});parent.appendChild(axis)}function showLegend(data,cylinderEntity,cylinder,element){cylinderEntity.addEventListener("mouseenter",function(){this.setAttribute("scale",{x:1.1,y:1.1,z:1.1});legend=generateLegend(data,cylinder,cylinderEntity);element.appendChild(legend)});cylinderEntity.addEventListener("mouseleave",function(){this.setAttribute("scale",{x:1,y:1,z:1});element.removeChild(legend)})}function generateLegend(data,cylinder,cylinderEntity){let text="";let lines=[];lines.push(cylinder[data.x_axis]+" "+cylinder[data.z_axis]+"\n");lines.push("Height: "+cylinder[data.height]+"\n");lines.push("Radius: "+cylinder[data.radius]);let width=5;for(let line of lines){if(line.length>10&&width<line.length/2){width=line.length/2}text+=line}let cylinderPosition=cylinderEntity.getAttribute("position");let entity=document.createElement("a-plane");entity.setAttribute("position",{x:cylinderPosition.x,y:2*cylinderPosition.y+3,z:cylinderPosition.z+cylinder[data.radius]/2});entity.setAttribute("rotation",{x:0,y:0,z:0});entity.setAttribute("height","4");entity.setAttribute("width",width);entity.setAttribute("color","white");entity.setAttribute("text",{value:text,align:"center",width:20,color:"black"});entity.classList.add("babiaxrLegend");return entity}function showTitle(title,font,color,position){let entity=document.createElement("a-entity");entity.setAttribute("text-geometry",{value:title});if(font){entity.setAttribute("text-geometry",{font:font})}if(color){entity.setAttribute("material",{color:color})}var position=position.split(" ");entity.setAttribute("position",{x:position[0],y:position[1],z:position[2]});entity.setAttribute("rotation",{x:0,y:0,z:0});entity.classList.add("babiaxrTitle");return entity}let colors=[{blues:["#142850","#27496d","#00909e","#dae1e7"]},{foxy:["#f79071","#fa744f","#16817a","#024249"]},{flat:["#120136","#035aa6","#40bad5","#fcbf1e"]},{sunset:["#202040","#543864","#ff6363","#ffbd69"]},{bussiness:["#de7119","#dee3e2","#116979","#18b0b0"]},{icecream:["#f76a8c","#f8dc88","#f8fab8","#ccf0e1"]},{ubuntu:["#511845","#900c3f","#c70039","#ff5733"]},{pearl:["#efa8e4","#f8e1f4","#fff0f5","#97e5ef"]},{commerce:["#222831","#30475e","#f2a365","#ececec"]}];let dataReadyToSend=(propertyName,self)=>{self.interestedElements.forEach(element=>{dispatchEventOnElement(element,propertyName)})};let dispatchEventOnElement=(element,propertyName)=>{element.emit("babiaVisualizerUpdated",propertyName)}},function(module,exports){if(typeof AFRAME==="undefined"){throw new Error("Component attempted to register before AFRAME was available.")}AFRAME.registerComponent("babia-doughnut",{schema:{data:{type:"string"},size:{type:"string",default:"size"},key:{type:"string",default:"key"},from:{type:"string"},legend:{type:"boolean"},palette:{type:"string",default:"ubuntu"},title:{type:"string"},titleFont:{type:"string"},titleColor:{type:"string"},titlePosition:{type:"string",default:"0 0 0"},animation:{type:"boolean",default:false}},visProperties:["size","key"],multiple:false,init:function(){},update:function(oldData){let self=this;let data=this.data;let el=this.el;if(data.data&&oldData.data!==data.data){self.babiaData=self.data;self.babiaMetadata={id:self.babiaMetadata.id++};while(self.el.firstChild)self.el.firstChild.remove();console.log("Generating 3Dcylynderchart from data...");self.chart=generateDoughnut(self.data,JSON.parse(self.data.data),self.el,self.total_duration,self.slice_array);self.loaded=true;dataReadyToSend("babiaData",self)}else{if(data.from!==oldData.from){if(self.dataComponent){self.dataComponent.unregister(el)}let eventName=findDataComponent(data,el,self);if(self.dataComponentEventName&&self.dataComponentEventName!==eventName){el.removeEventListener(self.dataComponentEventName,_listener,true)}self.dataComponentEventName=eventName;el.addEventListener(self.dataComponentEventName,_listener=(e=>{self.slice_array=[];attachNewDataEventCallback(self,e)}));self.dataComponent.register(el);return}if(data!==oldData&&self.babiaData){while(self.el.firstChild)self.el.firstChild.remove();console.log("Generating Cylinder...");self.slice_array=[];self.chart=generateDoughnut(self.data,self.babiaData,self.el,self.total_duration,self.slice_array);self.loaded=true;dataReadyToSend("babiaData",self)}}},remove:function(){},tick:function(t,delta){let self=this;if(self.data.animation&&self.loaded){let elements=document.getElementsByClassName("babiaxrChart")[0].children;for(let slice in self.slice_array){let delay=self.slice_array[slice].delay;let max_arc=self.slice_array[slice].arc;let arc=parseFloat(elements[slice].getAttribute("arc"));if(t>=delay&&arc<max_arc){arc+=360*delta/self.total_duration;if(arc>max_arc){arc=max_arc}elements[slice].setAttribute("arc",arc)}}}},pause:function(){},play:function(){},register:function(interestedElem){let el=this.el;this.interestedElements.push(interestedElem);if(this.babiaData){dispatchEventOnElement(interestedElem,"babiaData")}},unregister:function(interestedElem){const index=this.interestedElements.indexOf(interestedElem);if(index>-1){this.interestedElements.splice(index,1)}},interestedElements:[],loaded:false,slice_array:[],total_duration:4e3,dataComponent:undefined,dataComponentDataPropertyName:"babiaData",dataComponentEventName:undefined,babiaData:undefined,babiaMetadata:{id:0}});let findDataComponent=(data,el,self)=>{let eventName="babiaQuerierDataReady";if(data.from){let dataElement=document.getElementById(data.from);if(dataElement.components["babia-filter"]){self.dataComponent=dataElement.components["babia-filter"];eventName="babiaFilterDataReady"}else if(dataElement.components["babia-queryjson"]){self.dataComponent=dataElement.components["babia-queryjson"]}else if(dataElement.components["babia-queryes"]){self.dataComponent=dataElement.components["babia-queryes"]}else if(dataElement.components["babia-querygithub"]){self.dataComponent=dataElement.components["babia-querygithub"]}else{console.error("Problem registering to the querier");return}}else{if(el.components["babia-filter"]){self.dataComponent=el.components["babia-filter"];eventName="babiaFilterDataReady"}else if(el.components["babia-queryjson"]){self.dataComponent=el.components["babia-queryjson"]}else if(el.components["babia-queryes"]){self.dataComponent=el.components["babia-queryes"]}else if(el.components["babia-querygithub"]){self.dataComponent=el.components["babia-querygithub"]}else{if(document.querySelectorAll("[babia-filter]").length>0){self.dataComponent=document.querySelectorAll("[babia-filter]")[0].components["babia-filter"];eventName="babiaFilterDataReady"}else if(document.querySelectorAll("[babia-queryjson]").length>0){self.dataComponent=document.querySelectorAll("[babia-queryjson]")[0].components["babia-queryjson"]}else if(document.querySelectorAll("[babia-queryjson]").length>0){self.dataComponent=document.querySelectorAll("[babia-queryes]")[0].components["babia-queryes"]}else if(document.querySelectorAll("[babia-querygithub]").length>0){self.dataComponent=document.querySelectorAll("[babia-querygithub]")[0].components["babia-querygithub"]}else{console.error("Error, querier not found");return}}}return eventName};let attachNewDataEventCallback=(self,e)=>{self.dataComponentDataPropertyName=e.detail;let rawData=self.dataComponent[self.dataComponentDataPropertyName];self.babiaData=rawData;self.babiaMetadata={id:self.babiaMetadata.id++};while(self.el.firstChild)self.el.firstChild.remove();console.log("Generating Cylinder...");self.chart=generateDoughnut(self.data,rawData,self.el,self.total_duration,self.slice_array);self.loaded=true;dataReadyToSend("babiaData",self)};let generateDoughnut=(data,dataRetrieved,element,total_duration,slice_array)=>{if(dataRetrieved){const dataToPrint=dataRetrieved;const palette=data.palette;const title=data.title;const font=data.titleFont;const color=data.titleColor;const title_position=data.titlePosition;let animation=data.animation;let totalSize=0;for(let slice of dataToPrint){totalSize+=slice[data.size]}let degreeStart=0;let degreeEnd=0;let colorid=0;let chart_entity=document.createElement("a-entity");chart_entity.classList.add("babiaxrChart");chart_entity.setAttribute("rotation",{y:90});element.appendChild(chart_entity);let prev_delay=0;for(let slice of dataToPrint){degreeEnd=360*slice[data.size]/totalSize;let sliceEntity;if(animation){let duration_slice=total_duration*degreeEnd/360;slice_array.push({arc:degreeEnd,duration:duration_slice,delay:prev_delay});prev_delay+=duration_slice;sliceEntity=generateDoughnutSlice(degreeStart,.01,1,colorid,palette)}else{sliceEntity=generateDoughnutSlice(degreeStart,degreeEnd,1,colorid,palette)}sliceEntity.classList.add("babiaxraycasterclass");degreeStart+=degreeEnd;if(data.legend){showLegend(data,sliceEntity,slice,element)}chart_entity.appendChild(sliceEntity);colorid++}let title_3d=showTitle(title,font,color,title_position);element.appendChild(title_3d)}};function generateDoughnutSlice(position_start,arc,radius,colorid,palette){let color=getColor(colorid,palette);console.log("Generating slice...");let entity=document.createElement("a-torus");entity.setAttribute("color",color);entity.setAttribute("rotation",{x:90,y:0,z:position_start});entity.setAttribute("arc",arc);entity.setAttribute("side","double");entity.setAttribute("radius",radius);entity.setAttribute("radius-tubular",radius/4);return entity}function getColor(colorid,palette){let color;for(let i in colors){if(colors[i][palette]){color=colors[i][palette][colorid%4]}}return color}function generateLegend(data,slice){let text=slice[data.key]+": "+slice[data.size];let width=2;if(text.length>16)width=text.length/8;let entity=document.createElement("a-plane");entity.setAttribute("position",{x:0,y:1,z:-2});entity.setAttribute("rotation",{x:-90,y:0,z:0});entity.setAttribute("height","1");entity.setAttribute("width",width);entity.setAttribute("color","white");entity.setAttribute("text",{value:slice[data.key]+": "+slice[data.size],align:"center",width:6,color:"black"});entity.classList.add("babiaxrLegend");return entity}function showLegend(data,sliceEntity,slice,element){sliceEntity.addEventListener("mouseenter",function(){this.setAttribute("scale",{x:1.1,y:1.1,z:1.1});legend=generateLegend(data,slice);element.appendChild(legend)});sliceEntity.addEventListener("mouseleave",function(){this.setAttribute("scale",{x:1,y:1,z:1});element.removeChild(legend)})}function showTitle(title,font,color,position){let entity=document.createElement("a-entity");entity.setAttribute("text-geometry",{value:title});if(font){entity.setAttribute("text-geometry",{font:font})}if(color){entity.setAttribute("material",{color:color})}var position=position.split(" ");entity.setAttribute("position",{x:position[0],y:position[1],z:position[2]});entity.setAttribute("rotation",{x:-90,y:0,z:0});entity.classList.add("babiaxrTitle");return entity}let colors=[{blues:["#142850","#27496d","#00909e","#dae1e7"]},{foxy:["#f79071","#fa744f","#16817a","#024249"]},{flat:["#120136","#035aa6","#40bad5","#fcbf1e"]},{sunset:["#202040","#543864","#ff6363","#ffbd69"]},{bussiness:["#de7119","#dee3e2","#116979","#18b0b0"]},{icecream:["#f76a8c","#f8dc88","#f8fab8","#ccf0e1"]},{ubuntu:["#511845","#900c3f","#c70039","#ff5733"]},{pearl:["#efa8e4","#f8e1f4","#fff0f5","#97e5ef"]},{commerce:["#222831","#30475e","#f2a365","#ececec"]}];let dataReadyToSend=(propertyName,self)=>{self.interestedElements.forEach(element=>{dispatchEventOnElement(element,propertyName)})};let dispatchEventOnElement=(element,propertyName)=>{element.emit("babiaVisualizerUpdated",propertyName)}},function(module,exports){if(typeof AFRAME==="undefined"){throw new Error("Component attempted to register before AFRAME was available.")}AFRAME.registerComponent("babia-pie",{schema:{data:{type:"string"},size:{type:"string",default:"size"},key:{type:"string",default:"key"},from:{type:"string"},legend:{type:"boolean"},palette:{type:"string",default:"ubuntu"},title:{type:"string"},titleFont:{type:"string"},titleColor:{type:"string"},titlePosition:{type:"string",default:"0 0 0"},animation:{type:"boolean",default:false}},visProperties:["size","key"],multiple:false,init:function(){},update:function(oldData){let self=this;let data=this.data;let el=this.el;if(data.data&&oldData.data!==data.data){self.babiaData=self.data;self.babiaMetadata={id:self.babiaMetadata.id++};while(self.el.firstChild)self.el.firstChild.remove();console.log("Generating 3Dcylynderchart from data...");self.chart=generatePie(self.data,JSON.parse(self.data.data),self.el,self.slice_array,self.total_duration);self.loaded=true;dataReadyToSend("babiaData",self)}else{if(data.from!==oldData.from){if(self.dataComponent){self.dataComponent.unregister(el)}let eventName=findDataComponent(data,el,self);if(self.dataComponentEventName&&self.dataComponentEventName!==eventName){el.removeEventListener(self.dataComponentEventName,_listener,true)}self.dataComponentEventName=eventName;el.addEventListener(self.dataComponentEventName,_listener=(e=>{self.slice_array=[];attachNewDataEventCallback(self,e)}));self.dataComponent.register(el);return}if(data!==oldData&&self.babiaData){while(self.el.firstChild)self.el.firstChild.remove();console.log("Generating Cylinder...");self.slice_array=[];self.chart=generatePie(self.data,self.babiaData,self.el,self.slice_array,self.total_duration);self.loaded=true;dataReadyToSend("babiaData",self)}}},remove:function(){},tick:function(t,delta){let self=this;if(self.data.animation&&self.loaded){let elements=document.getElementsByClassName("babiaxrChart")[0].children;for(let slice in self.slice_array){let delay=self.slice_array[slice].delay;let max_length=self.slice_array[slice].degreeLenght;let theta_length=parseFloat(elements[slice].getAttribute("theta-length"));if(t>=delay&&theta_length<max_length){theta_length+=360*delta/self.total_duration;if(theta_length>max_length){theta_length=max_length}elements[slice].setAttribute("theta-length",theta_length)}}}},pause:function(){},play:function(){},register:function(interestedElem){let el=this.el;this.interestedElements.push(interestedElem);if(this.babiaData){dispatchEventOnElement(interestedElem,"babiaData")}},unregister:function(interestedElem){const index=this.interestedElements.indexOf(interestedElem);if(index>-1){this.interestedElements.splice(index,1)}},interestedElements:[],loaded:false,slice_array:[],total_duration:4e3,dataComponent:undefined,dataComponentDataPropertyName:"babiaData",dataComponentEventName:undefined,babiaData:undefined,babiaMetadata:{id:0}});let findDataComponent=(data,el,self)=>{let eventName="babiaQuerierDataReady";if(data.from){let dataElement=document.getElementById(data.from);if(dataElement.components["babia-filter"]){self.dataComponent=dataElement.components["babia-filter"];eventName="babiaFilterDataReady"}else if(dataElement.components["babia-queryjson"]){self.dataComponent=dataElement.components["babia-queryjson"]}else if(dataElement.components["babia-queryes"]){self.dataComponent=dataElement.components["babia-queryes"]}else if(dataElement.components["babia-querygithub"]){self.dataComponent=dataElement.components["babia-querygithub"]}else{console.error("Problem registering to the querier");return}}else{if(el.components["babia-filter"]){self.dataComponent=el.components["babia-filter"];eventName="babiaFilterDataReady"}else if(el.components["babia-queryjson"]){self.dataComponent=el.components["babia-queryjson"]}else if(el.components["babia-queryes"]){self.dataComponent=el.components["babia-queryes"]}else if(el.components["babia-querygithub"]){self.dataComponent=el.components["babia-querygithub"]}else{if(document.querySelectorAll("[babia-filter]").length>0){self.dataComponent=document.querySelectorAll("[babia-filter]")[0].components["babia-filter"];eventName="babiaFilterDataReady"}else if(document.querySelectorAll("[babia-queryjson]").length>0){self.dataComponent=document.querySelectorAll("[babia-queryjson]")[0].components["babia-queryjson"]}else if(document.querySelectorAll("[babia-queryjson]").length>0){self.dataComponent=document.querySelectorAll("[babia-queryes]")[0].components["babia-queryes"]}else if(document.querySelectorAll("[babia-querygithub]").length>0){self.dataComponent=document.querySelectorAll("[babia-querygithub]")[0].components["babia-querygithub"]}else{console.error("Error, querier not found");return}}}return eventName};let attachNewDataEventCallback=(self,e)=>{self.dataComponentDataPropertyName=e.detail;let rawData=self.dataComponent[self.dataComponentDataPropertyName];self.babiaData=rawData;self.babiaMetadata={id:self.babiaMetadata.id++};while(self.el.firstChild)self.el.firstChild.remove();console.log("Generating Cylinder...");self.chart=generatePie(self.data,rawData,self.el,self.slice_array,self.total_duration);self.loaded=true;dataReadyToSend("babiaData",self)};let generatePie=(data,dataRetrieved,element,slice_array,total_duration)=>{if(dataRetrieved){const dataToPrint=dataRetrieved;const palette=data.palette;const title=data.title;const font=data.titleFont;const color=data.titleColor;const title_position=data.titlePosition;let animation=data.animation;let totalSize=0;for(let slice of dataToPrint){totalSize+=slice[data.size]}let degreeStart=0;let degreeEnd=0;let colorid=0;let chart_entity=document.createElement("a-entity");chart_entity.classList.add("babiaxrChart");element.appendChild(chart_entity);let prev_delay=0;for(let slice of dataToPrint){degreeEnd=360*slice[data.size]/totalSize;let sliceEntity;if(animation){let duration_slice=total_duration*degreeEnd/360;slice_array.push({degreeLenght:degreeEnd,duration:duration_slice,delay:prev_delay});prev_delay+=duration_slice;sliceEntity=generateSlice(degreeStart,.01,1,colorid,palette)}else{sliceEntity=generateSlice(degreeStart,degreeEnd,1,colorid,palette)}sliceEntity.classList.add("babiaxraycasterclass");degreeStart+=degreeEnd;if(data.legend){showLegend(data,sliceEntity,slice,element)}chart_entity.appendChild(sliceEntity);colorid++}let title_3d=showTitle(title,font,color,title_position);element.appendChild(title_3d)}};function generateSlice(theta_start,theta_length,radius,colorid,palette){let color=getColor(colorid,palette);console.log("Generating slice...");let entity=document.createElement("a-cylinder");entity.setAttribute("color",color);entity.setAttribute("theta-start",theta_start);entity.setAttribute("theta-length",theta_length);entity.setAttribute("side","double");entity.setAttribute("radius",radius);return entity}function getColor(colorid,palette){let color;for(let i in colors){if(colors[i][palette]){color=colors[i][palette][colorid%4]}}return color}function generateLegend(data,slice){let text=slice[data.key]+": "+slice[data.size];let width=2;if(text.length>16)width=text.length/8;let entity=document.createElement("a-plane");entity.setAttribute("position",{x:0,y:0,z:-2});entity.setAttribute("rotation",{x:-90,y:0,z:0});entity.setAttribute("height","1");entity.setAttribute("width",width);entity.setAttribute("color","white");entity.setAttribute("text",{value:slice[data.key]+": "+slice[data.size],align:"center",width:6,color:"black"});entity.classList.add("babiaxrLegend");return entity}function showLegend(data,sliceEntity,slice,element){sliceEntity.addEventListener("mouseenter",function(){this.setAttribute("scale",{x:1.1,y:1.1,z:1.1});legend=generateLegend(data,slice);element.appendChild(legend)});sliceEntity.addEventListener("mouseleave",function(){this.setAttribute("scale",{x:1,y:1,z:1});element.removeChild(legend)})}function showTitle(title,font,color,position){let entity=document.createElement("a-entity");entity.setAttribute("text-geometry",{value:title});if(font){entity.setAttribute("text-geometry",{font:font})}if(color){entity.setAttribute("material",{color:color})}var position=position.split(" ");entity.setAttribute("position",{x:position[0],y:position[1],z:position[2]});entity.setAttribute("rotation",{x:-90,y:0,z:0});entity.classList.add("babiaxrTitle");return entity}let colors=[{blues:["#142850","#27496d","#00909e","#dae1e7"]},{foxy:["#f79071","#fa744f","#16817a","#024249"]},{flat:["#120136","#035aa6","#40bad5","#fcbf1e"]},{sunset:["#202040","#543864","#ff6363","#ffbd69"]},{bussiness:["#de7119","#dee3e2","#116979","#18b0b0"]},{icecream:["#f76a8c","#f8dc88","#f8fab8","#ccf0e1"]},{ubuntu:["#511845","#900c3f","#c70039","#ff5733"]},{pearl:["#efa8e4","#f8e1f4","#fff0f5","#97e5ef"]},{commerce:["#222831","#30475e","#f2a365","#ececec"]}];let dataReadyToSend=(propertyName,self)=>{self.interestedElements.forEach(element=>{dispatchEventOnElement(element,propertyName)})};let dispatchEventOnElement=(element,propertyName)=>{element.emit("babiaVisualizerUpdated",propertyName)}},function(module,exports){AFRAME.registerComponent("babia-terrain",{schema:{width:{type:"number",default:1},height:{type:"number",default:1},segmentsHeight:{type:"number",default:1},segmentsWidth:{type:"number",default:1},data:{type:"array"},color:{type:"string",default:"0xdddddd"},filled:{type:"boolean",default:false}},init:function(){var data=this.data;var el=this.el;var vertices=data.data;console.log("Vertices:");console.log(vertices);this.geometry=new THREE.PlaneGeometry(data.width,data.height,data.segmentsHeight,data.segmentsWidth);for(var i=0,l=this.geometry.vertices.length;i<l;i++){this.geometry.vertices[i].z=vertices[i]}var color=data.color;if(data.filled){this.material=new THREE.MeshPhongMaterial({color:color,wireframe:false})}else{this.material=new THREE.MeshPhongMaterial({color:color,wireframe:true})}this.mesh=new THREE.Mesh(this.geometry,this.material);el.setObject3D("mesh",this.mesh)}})},function(module,exports,__webpack_require__){if(typeof AFRAME==="undefined"){throw new Error("Component attempted to register before AFRAME was available.")}let rootCodecityEntity;AFRAME.registerComponent("babiaxr-codecity",{schema:{absolute:{type:"boolean",default:false},width:{type:"number",default:20},depth:{type:"number",default:20},split:{type:"string",default:"naive"},data:{type:"string",default:JSON.stringify({id:"CodeCity",area:1,height:1})},farea:{type:"string",default:"area"},fmaxarea:{type:"string",default:"max_area"},fheight:{type:"string",default:"height"},titles:{type:"boolean",default:true},building_color:{type:"color",default:"#E6B9A1"},building_model:{type:"string",default:null},base:{type:"boolean",default:true},base_thick:{type:"number",default:.2},base_color:{type:"color",default:"#98e690"},border:{type:"number",default:1},extra:{type:"number",default:1.4},zone_elevation:{type:"number",default:1},unicolor:{type:"color",default:false},wireframe:{type:"boolean",default:false},colormap:{type:"array",default:["blue","green","yellow","brown","orange","magenta","grey","cyan","azure","beige","blueviolet","coral","crimson","darkblue","darkgrey","orchid","olive","navy","palegreen"]},time_evolution_delta:{type:"number",default:8e3},time_evolution_init:{type:"string",default:"data_0"},time_evolution_past_present:{type:"boolean",default:false},time_evolution_animation:{type:"boolean",default:true},time_evolution_color:{type:"boolean",default:false},ui_navbar:{type:"string",default:""}},multiple:false,init:function(){},update:function(oldData){this.loader=new THREE.FileLoader;let data=this.data;let el=this.el;currentColor=data.building_color;rootCodecityEntity=el;if(typeof data.data=="string"){if(data.data.endsWith("json")){raw_items=requestJSONDataFromURL(data)}else{raw_items=JSON.parse(data.data)}}else{raw_items=data.data}el.emit("babiaxr-dataLoaded",{data:raw_items,codecity:true});deltaTimeEvolution=data.time_evolution_delta;this.zone_data=raw_items;let zone=new Zone({data:this.zone_data,extra:function(area){return area*data.extra},farea:data.farea,fheight:data.fheight,fmaxarea:data.fmaxarea});let width,depth;if(data.absolute==true){width=Math.sqrt(zone.areas.canvas)*data.width/data.depth;depth=zone.areas.canvas/width}else{width=data.width;depth=data.depth}let relative=false;let canvas=new Rectangle({width:width,depth:depth,x:0,z:0});zone.add_rects({rect:canvas,split:data.split,relative:relative});let base=document.createElement("a-entity");this.base=base;let visible=true;zone.draw_rects({ground:canvas,el:base,base:data.base,level:0,elevation:0,relative:relative,base_thick:data.base_thick,wireframe:data.wireframe,building_color:data.building_color,base_color:data.base_color,model:data.building_model,visible:visible,titles:data.titles});el.appendChild(base);if(time_evolution){time_evolution_past_present=data.time_evolution_past_present;time_evolution_animation=data.time_evolution_animation;time_evolution_color=data.time_evolution_color;dateBar(data);time_evol()}},remove:function(){},play:function(){}});let Zone=class{constructor({data:data,extra:extra=function(area){return area},farea:farea="area",fmaxarea:fmaxarea="max_area",fheight:fheight="height"}){this.data=data;this.id=this.data.id;this.extra=extra;this.farea=farea;this.fmaxarea=fmaxarea;this.fheight=fheight;this.areas=this.areas_tree();this.el=null;this.pending_rects=0}areas_tree({data:data=this.data,level:level=0}={}){let data_node=data;let node={data:data_node};if("children"in data_node){node.inner=0;node.area=0;node.children=[];for(const data_child of data_node.children){let child=this.areas_tree({data:data_child,level:level+1});node.inner+=child.canvas;node.area+=child.area;node.children.push(child)}}else{node.area=data_node[this.farea];node.max_area=data_node[this.fmaxarea];node.inner=node.max_area;node.inner_real=node.area}node.canvas=this.extra(node.inner,level);return node}add_rects({rect:rect,area:area=this.areas,relative:relative=true,split:split="naive"}={}){area.rect=rect;area.rect.inner(area.canvas,area.inner,area.inner_real);if("children"in area){let child_areas=new Values(area.children.map(child=>child.canvas),area.inner);let child_rect;if(split==="naive"){child_rect=area.rect.split(child_areas,relative)}else if(split==="pivot"){child_rect=area.rect.split_pivot(child_areas,relative)}else{throw new Error("CodeCity: Unknwon split method")}for(const i in area.children){this.add_rects({rect:child_rect[i],area:area.children[i],relative:relative,split:split})}}}draw_rects({ground:ground,el:el,area:area=this.areas,level:level=0,elevation:elevation=0,relative:relative=true,base_thick:base_thick=.2,wireframe:wireframe=false,building_color:building_color="red",base_color:base_color="green",model:model=null,visible:visible=true,titles:titles=true}){if(level===0){this.el=el}let pending_rects=this.pending_rects;if("children"in area){let base=area.rect.box({elevation:elevation,height:base_thick,color:base_color,inner:false,wireframe:wireframe,visible:visible,id:area.data["id"],rawarea:0});if(titles){let legend;let transparentBox;base.addEventListener("click",function(){if(legend){rootCodecityEntity.removeChild(transparentBox);rootCodecityEntity.removeChild(legend);legend=undefined;transparentBox=undefined}else{transparentBox=document.createElement("a-entity");let oldGeometry=base.getAttribute("geometry");let boxPosition=base.getAttribute("position");transparentBox.setAttribute("geometry",{height:oldGeometry.height+10,depth:oldGeometry.depth,width:oldGeometry.width});transparentBox.setAttribute("position",boxPosition);transparentBox.setAttribute("material",{visible:true,opacity:.4});legend=generateLegend(this.getAttribute("id"),oldGeometry.height+10,boxPosition,null,rootCodecityEntity);rootCodecityEntity.appendChild(legend);rootCodecityEntity.appendChild(transparentBox)}})}base.setAttribute("class","babiaxraycasterclass");el.appendChild(base);let root_el=base;if(!relative){root_el=el}for(const child of area.children){let next_elevation=base_thick/2;if(!relative){next_elevation=elevation+base_thick}this.draw_rects({ground:area.rect,el:root_el,area:child,level:level+1,elevation:next_elevation,relative:relative,building_color:building_color,base_color:base_color,model:model,base_thick:base_thick,wireframe:wireframe,visible:visible,titles:titles})}}else{let height=area.data[this.fheight];let box=area.rect.box({height:area.data[this.fheight],elevation:elevation,wireframe:wireframe,color:building_color,model:model,visible:visible,id:area.data["id"],rawarea:area.data[this.farea],inner_real:true});box.setAttribute("class","babiaxraycasterclass");el.appendChild(box);if(titles){let legend;let legendBox;let alreadyActive=false;box.addEventListener("click",function(){if(alreadyActive){rootCodecityEntity.removeChild(legend);rootCodecityEntity.removeChild(legendBox);legend=undefined;legendBox=undefined;alreadyActive=false}else{alreadyActive=true}});box.addEventListener("mouseenter",function(){if(!alreadyActive){legendBox=document.createElement("a-entity");let oldGeometry=box.getAttribute("geometry");let boxPosition=box.getAttribute("position");legendBox.setAttribute("position",boxPosition);legendBox.setAttribute("material",{visible:true});legendBox.setAttribute("geometry",{height:oldGeometry.height+.1,depth:oldGeometry.depth+.1,width:oldGeometry.width+.1});legend=generateLegend(this.getAttribute("id"),oldGeometry.height+.1,boxPosition,null,rootCodecityEntity);rootCodecityEntity.appendChild(legend);rootCodecityEntity.appendChild(legendBox)}});box.addEventListener("mouseleave",function(){if(!alreadyActive&&legend){rootCodecityEntity.removeChild(legend);rootCodecityEntity.removeChild(legendBox);legend=undefined;legendBox=undefined}})}}}};let Values=class{constructor(values,total){this.items=values;if(typeof total!=="undefined"){this.total=total}else{this.total=values.reduce((acc,a)=>acc+a,0)}}imax(){let largest=this.items[0];let largest_i=0;for(let i=0;i<this.items.length;i++){if(largest<this.items[i]){largest=this.items[i];largest_i=i}}return largest_i}static range(start,length){var indexes=[];for(let i=start;i<start+length;i++){indexes.push(i)}return indexes}scaled_area(area,item){return this.items[item]*area/this.total}values_i(positions){let values=[];for(const position of positions){values.push(this.items[position])}return new Values(values)}pivot_regions(width,depth){if(this.items.length<3){throw new Error("CodeCity - Values.pivot_regions: less than three items")}if(width<depth){throw new Error("Codecity - Values.pivot_regions: rectangle should be laying")}let a1_len,a2_len,a3_len;let pivot_i=this.imax();if(this.items.lenght==pivot_i+1){return{pivot:pivot_i,a1:Values.range(0,pivot_i),a2:[],a3:[]}}if(this.items.length==pivot_i+2){return{pivot:pivot_i,a1:Values.range(0,pivot_i),a2:[pivot_i+1],a3:[]}}let area=width*depth;let pivot_area=this.scaled_area(area,pivot_i);let a2_width_ideal=Math.sqrt(pivot_area);let a2_area_ideal=a2_width_ideal*depth-pivot_area;let a2_area=0;let a2_area_last=a2_area;let i=pivot_i+1;while(a2_area<a2_area_ideal&&i<this.items.length){a2_area_last=a2_area;a2_area+=this.scaled_area(area,i);i++}let a3_first=i;if(i-1>pivot_i&&Math.abs(a2_area-a2_area_ideal)>Math.abs(a2_area_last-a2_area_ideal)){a3_first=i-1}a2_len=a3_first-pivot_i-1;a3_len=this.items.length-a3_first;return{pivot:pivot_i,a1:Values.range(0,pivot_i),a2:Values.range(pivot_i+1,a2_len),a3:Values.range(pivot_i+1+a2_len,a3_len)}}pivot_region_width(values,width){let region_total=0;for(const i of values){region_total+=this.items[i]}return region_total/this.total*width}};let Rectangle=class{constructor({width:width,depth:depth,x:x=0,z:z=0}){this.width=width;this.depth=depth;this.x=x;this.z=z}is_ilaying(){let longest=Math.max(this.width,this.depth);return longest==this.width}inner(acanvas,ainner,ainner_real){if(acanvas<ainner){throw"Rectangle.inner: Area for inner rectangle larger than my area"}if(typeof acanvas!=="undefined"){let ratio=Math.sqrt(ainner/acanvas);this.iwidth=ratio*this.width;this.idepth=ratio*this.depth;if(ainner_real){let ratio_real=Math.sqrt(ainner_real/acanvas);this.iwidth_real=ratio_real*this.width;this.idepth_real=ratio_real*this.depth}}else{this.iwidth=this.width;this.idepth=this.depth}}reflect(){[this.width,this.depth]=[this.depth,this.width];[this.x,this.z]=[this.z,this.x]}idims_as_laying(){if(this.is_ilaying()){return[this.iwidth,this.idepth,this.x,this.z,false]}else{return[this.idepth,this.iwidth,this.z,this.x,true]}}split(values,relative=true){let[width,depth,x,z,reflected]=this.idims_as_laying();let ratio=width/values.total;let current_x=-width/2;let current_z=0;if(!relative){current_x+=x;current_z=z}let rects=[];for(const value of values.items){let sub_width=value*ratio;let rect=new Rectangle({width:sub_width,depth:depth,x:current_x+sub_width/2,z:current_z});if(reflected){rect.reflect()}rects.push(rect);current_x+=sub_width}return rects}split_pivot(values,relative=true){if(values.items.length<=2){return this.split(values,relative)}let[width,depth,x,z,reflected]=this.idims_as_laying();if(relative){x=0;z=0}let{pivot:pivot,a1:a1,a2:a2,a3:a3}=values.pivot_regions(width,depth);let width_a1=values.pivot_region_width(a1,width);let width_a2=values.pivot_region_width(a2.concat(pivot),width);let width_a3=values.pivot_region_width(a3,width);let x_a1=x-width/2+width_a1/2;let x_a2=x-width/2+width_a1+width_a2/2;let x_a3=x-width/2+width_a1+width_a2+width_a3/2;let rects=[];let depth_pivot=values.scaled_area(width*depth,pivot)/width_a2;rects[pivot]=new Rectangle({width:width_a2,depth:depth_pivot,x:x_a2,z:z+depth/2-depth_pivot/2});let dim_areas=[[a1,width_a1,depth,x_a1,z],[a2,width_a2,depth-depth_pivot,x_a2,z-depth_pivot/2],[a3,width_a3,depth,x_a3,z]];for(const[values_i,width_i,depth_i,x_i,z_i]of dim_areas){if(values_i.length>0){let subrect=new Rectangle({width:width_i,depth:depth_i,x:x_i,z:z_i});subrect.inner();let subvalues=values.values_i(values_i);let rects_i=subrect.split_pivot(subvalues,false);let counter=0;for(const i of values_i){rects[i]=rects_i[counter];counter++}}}if(reflected){for(const rect of rects){rect.reflect()}}return rects}box({height:height,elevation:elevation=0,color:color="red",model:model=null,inner:inner=true,wireframe:wireframe=false,visible:visible=true,id:id="",rawarea:rawarea=0,inner_real:inner_real=false}){let depth,width;if(inner_real){[depth,width]=[this.idepth_real,this.iwidth_real]}else if(inner){[depth,width]=[this.idepth,this.iwidth]}else{[depth,width]=[this.depth,this.width]}let box=document.createElement("a-entity");box.setAttribute("geometry",{primitive:"box",skipCache:true,depth:depth,width:width,height:height});box.setAttribute("material",{color:color});box.setAttribute("position",{x:this.x,y:elevation+height/2,z:this.z});box.setAttribute("id",id);box.setAttribute("babiaxr-rawarea",rawarea);return box}};let rnd_producer=function(levels=2,number=3,area=20,height=30){if(levels==1){return{id:"A",area:Math.random()*area,height:Math.random()*height}}else if(levels>1){let children=Array.from({length:number},function(){return rnd_producer(levels-1,number,area,height)});return{id:"BlockAA",children:children}}};if(true){module.exports={Values:Values,Rectangle:Rectangle,Zone:Zone}}let requestJSONDataFromURL=data=>{let items=data.data;let raw_items;let request=new XMLHttpRequest;request.open("get",items,false);request.onload=function(){if(this.status>=200&&this.status<300){if(typeof request.response==="string"||request.response instanceof String){raw_items=JSON.parse(request.response)}else{raw_items=request.response}}else{reject({status:this.status,statusText:xhr.statusText})}};request.onerror=function(){reject({status:this.status,statusText:xhr.statusText})};request.send();if(raw_items.time_evolution){main_json=raw_items;time_evolution=true;time_evolution_commit_by_commit=raw_items.time_evolution_commit_by_commit;let first_tree=raw_items.data_files.find(o=>o.key_tree==="data_0_tree");raw_items=first_tree["data_0_tree"];initItems=first_tree["data_0"];let navbarData=[];for(let i=0;i<main_json.data_files.length;i++){let array_of_tree_to_retrieve="data_"+i;timeEvolutionItems[array_of_tree_to_retrieve]=main_json.data_files[i];navbarData.push({date:new Date(main_json.data_files[i].date*1e3).toLocaleDateString(),commit:main_json.data_files[i].commit_sha,data:i})}if(data.ui_navbar){if(data.time_evolution_past_present){last_uinavbar=parseInt(data.time_evolution_init.split("_")[1])}else{last_uinavbar=main_json.data_files.length-1}ui_navbar=data.ui_navbar;document.getElementById(ui_navbar).setAttribute("babiaxr-navigation-bar","commits",JSON.stringify(navbarData.reverse()))}if(data.time_evolution_init!=="data_0"){let key;if(timeEvolutionItems[data.time_evolution_init][data.time_evolution_init+"_allfiles"]){key=data.time_evolution_init+"_allfiles"}else{key=data.time_evolution_init}let leafEntities=findLeafs(raw_items["children"],{});timeEvolutionItems[data.time_evolution_init][key].forEach(item=>{if(leafEntities[item.id]){leafEntities[item.id].height=item.height;leafEntities[item.id].area=item.area;leafEntities[item.id].max_area=item.max_area}});index=parseInt(data.time_evolution_init.split("_")[1])}}return raw_items};let time_evolution=false;let time_evolution_animation=true;let time_evolution_color=false;let time_evolution_commit_by_commit=false;let ui_navbar=undefined;let last_uinavbar=undefined;let timeEvolutionItems={};let dateBarEntity;let deltaTimeEvolution=8e3;let main_json={};let initItems=undefined;let changedItems=[];let index=0;let timeEvolTimeout=undefined;let dateBar=data=>{let component;if(document.getElementById("scene")){component=document.getElementById("scene")}else{component=document.getElementsByTagName("a-scene");let entities=document.getElementsByTagName("a-entity")}let entity=document.createElement("a-entity");entity.classList.add("babiaxrDateBar");entity.setAttribute("position",{x:-13,y:10,z:-3});entity.setAttribute("rotation",{x:0,y:0,z:0});entity.setAttribute("material",{color:"black"});entity.setAttribute("height",.5);entity.setAttribute("width",2);entity.setAttribute("scale",{x:1,y:1,z:1});let text="Date: "+new Date(timeEvolutionItems[data.time_evolution_init].date*1e3).toLocaleDateString();if(timeEvolutionItems[data.time_evolution_init].commit_sha){text+="\n\nCommit: "+timeEvolutionItems[data.time_evolution_init].commit_sha}entity.setAttribute("text-geometry",{value:text});dateBarEntity=entity;component.appendChild(entity)};let generateLegend=(text,heightItem,boxPosition,model,rootCodecityEntity)=>{let width=2;if(text.length>16)width=text.length/8;let height=heightItem;let entity=document.createElement("a-plane");entity.setAttribute("babia-lookat","[camera]");entity.setAttribute("position",{x:boxPosition.x,y:boxPosition.y+height/2+1,z:boxPosition.z});entity.setAttribute("rotation",{x:0,y:0,z:0});entity.setAttribute("height","1");entity.setAttribute("width",width);entity.setAttribute("color","white");entity.setAttribute("material",{side:"double"});entity.setAttribute("text",{value:text,align:"center",width:6,color:"black"});let scaleParent=rootCodecityEntity.getAttribute("scale");if(scaleParent&&(scaleParent.x!==scaleParent.y||scaleParent.x!==scaleParent.z)){entity.setAttribute("scale",{x:1/scaleParent.x,y:1/scaleParent.y,z:1/scaleParent.z})}return entity};function time_evol(){const maxFiles=Object.keys(timeEvolutionItems).length;let i=0;if(ui_navbar){document.addEventListener("babiaxrToPast",function(){time_evolution_past_present=false});document.addEventListener("babiaxrToPresent",function(){time_evolution_past_present=true});document.addEventListener("babiaxrStop",function(){clearInterval(timeEvolTimeout)});document.addEventListener("babiaxrContinue",function(){timeEvolTimeout=setTimeout(function(){loopLogic(maxFiles,i);if(i<maxFiles-1){loop()}},deltaTimeEvolution)});document.addEventListener("babiaxrSkipNext",function(){time_evolution_past_present=false;clearInterval(timeEvolTimeout);showLegendUiNavBar(maxFiles-index-1);last_uinavbar=maxFiles-index-1;i--;index--;changeCity()});document.addEventListener("babiaxrSkipPrev",function(){time_evolution_past_present=true;clearInterval(timeEvolTimeout);showLegendUiNavBar(maxFiles-index-3);last_uinavbar=maxFiles-index-3;i++;index++;changeCity()});document.addEventListener("babiaxrShow",function(event){clearInterval(timeEvolTimeout);eventData=event.detail.data;i=eventData.data;showLegendUiNavBar(maxFiles-i-1);last_uinavbar=maxFiles-i-1;index=i-1;changeCity(true)})}let loop=()=>{timeEvolTimeout=setTimeout(function(){if(ui_navbar){showLegendUiNavBar(maxFiles-index-2)}last_uinavbar=maxFiles-index-2;loopLogic(maxFiles,i);if(i<maxFiles-1){loop()}},deltaTimeEvolution)};let doIt=()=>{loop()};doIt()}let loopLogic=(maxFiles,i)=>{console.log("Loop number",i);changeCity();if(time_evolution_past_present){index--;if(index==0){console.log("finished")}i--}else{index++;i++;if(index>maxFiles-1){index=0}}};let changeCity=bigStepCommitByCommit=>{let key="data_"+(index+1);let key2;if(bigStepCommitByCommit){key2="data_"+(index+1)+"_allfiles"}else{if(time_evolution_past_present){key2="data_reverse_"+(index+1)}else{key2="data_"+(index+1)}}let text="Date: "+new Date(timeEvolutionItems[key].date*1e3).toLocaleDateString();if(timeEvolutionItems[key].commit_sha){text+="\n\nCommit: "+timeEvolutionItems[key].commit_sha}dateBarEntity.setAttribute("text-geometry","value",text);changedItems=[];if(time_evolution_color){currentColorPercentage+=5;if(currentColorPercentage!==80){currentColor=getNewBrightnessColor(currentColor,currentColorPercentage)}else{colorEvolutionArrayStartingPoint++;if(colorEvolutionArrayStartingPoint>colorEvolutionArray.length-1){colorEvolutionArrayStartingPoint=0}currentColor=colorEvolutionArray[colorEvolutionArrayStartingPoint];currentColorPercentage=20}}if(timeEvolutionItems[key][key2]){timeEvolutionItems[key][key2].forEach(item=>{changeBuildingLayout(item)})}else{timeEvolutionItems[key][key].forEach(item=>{changeBuildingLayout(item)})}if(!time_evolution_commit_by_commit){initItems.forEach(item=>{if(!changedItems.includes(item.id)){dissapearBuildingAnimation(item.id)}})}updateCity()};let currentColorPercentage=20;let currentColor;let colorEvolutionArray=["#000066","#006600","#666600","#660000"];let colorEvolutionArrayStartingPoint=0;let changeBuildingLayout=item=>{if(document.getElementById(item.id)!=undefined&&item.area!=0){changedItems.push(item.id);let prevPos=document.getElementById(item.id).getAttribute("position");let oldX=document.getElementById(item.id).getAttribute("position").x;let oldY=document.getElementById(item.id).getAttribute("position").y;let oldZ=document.getElementById(item.id).getAttribute("position").z;let prevWidth=document.getElementById(item.id).getAttribute("geometry").width;let prevDepth=document.getElementById(item.id).getAttribute("geometry").depth;let prevHeight=document.getElementById(item.id).getAttribute("geometry").height;let oldRawArea=parseFloat(document.getElementById(item.id).getAttribute("babiaxr-rawarea"));if(prevHeight.toFixed(6)!==item.height.toFixed(6)||oldRawArea.toFixed(6)!==item.area.toFixed(6)){if(time_evolution_color){document.getElementById(item.id).setAttribute("material",{color:currentColor})}let reverseWidthDepth=false;let AR=prevWidth/prevDepth;if(AR<1){reverseWidthDepth=true;AR=prevDepth/prevWidth}let newAreaDep=item.area*(prevDepth*prevWidth)/oldRawArea;let newWidth=Math.sqrt(newAreaDep*AR);let newDepth=Math.sqrt(newAreaDep/AR);if(reverseWidthDepth){newDepth=Math.sqrt(newAreaDep*AR);newWidth=Math.sqrt(newAreaDep/AR)}document.getElementById(item.id).setAttribute("babiaxr-rawarea",item.area);if(time_evolution_animation){let duration=500;if(newWidth>prevWidth||newDepth>prevDepth){let incrementWidth=20*(newWidth-prevWidth)/duration;let incrementDepth=20*(newDepth-prevDepth)/duration;let sizeWidth=prevWidth;let sizeDepth=prevDepth;let idIncA=setInterval(function(){animationAreaIncrease()},1);function animationAreaIncrease(){if(sizeWidth>=newWidth||sizeDepth>=newDepth){document.getElementById(item.id).setAttribute("geometry","width",newWidth);document.getElementById(item.id).setAttribute("geometry","depth",newDepth);clearInterval(idIncA)}else{sizeWidth+=incrementWidth;sizeDepth+=incrementDepth;document.getElementById(item.id).setAttribute("geometry","width",sizeWidth);document.getElementById(item.id).setAttribute("geometry","depth",sizeDepth)}}}else if(newWidth<prevWidth||newDepth<prevDepth){let incrementWidth=20*(prevWidth-newWidth)/duration;let incrementDepth=20*(prevDepth-newDepth)/duration;let sizeWidth=prevWidth;let sizeDepth=prevDepth;let idDecA=setInterval(function(){animationAreaDecrease()},1);function animationAreaDecrease(){if(sizeWidth<=newWidth||sizeDepth<=newDepth){document.getElementById(item.id).setAttribute("geometry","width",newWidth);document.getElementById(item.id).setAttribute("geometry","depth",newDepth);clearInterval(idDecA)}else{sizeWidth-=incrementWidth;sizeDepth-=incrementDepth;document.getElementById(item.id).setAttribute("geometry","width",sizeWidth);document.getElementById(item.id).setAttribute("geometry","depth",sizeDepth)}}}if(item.height<0){dissapearBuildingAnimation(item.id)}else if(item.height>prevHeight){let increment=20*(item.height-prevHeight)/duration;let size=prevHeight;let idIncH=setInterval(function(){animationHeightIncrease()},1);function animationHeightIncrease(){if(size>=item.height){document.getElementById(item.id).setAttribute("position",{x:oldX,y:oldY-prevHeight/2+item.height/2,z:oldZ});clearInterval(idIncH)}else{size+=increment;document.getElementById(item.id).setAttribute("geometry","height",size);document.getElementById(item.id).setAttribute("position",{x:oldX,y:oldY-prevHeight/2+size/2,z:oldZ})}}}else if(item.height<prevHeight){let increment=20*(prevHeight-item.height)/duration;let size=prevHeight;let idDecH=setInterval(function(){animationHeightDecrease()},1);function animationHeightDecrease(){if(size<=item.height){document.getElementById(item.id).setAttribute("position",{x:oldX,y:oldY-prevHeight/2+item.height/2,z:oldZ});clearInterval(idDecH)}else{size-=increment;document.getElementById(item.id).setAttribute("geometry","height",size);document.getElementById(item.id).setAttribute("position",{x:oldX,y:oldY-prevHeight/2+size/2,z:oldZ})}}}}else{document.getElementById(item.id).setAttribute("geometry","width",newWidth);document.getElementById(item.id).setAttribute("geometry","depth",newDepth);document.getElementById(item.id).setAttribute("geometry","height",item.height);document.getElementById(item.id).setAttribute("position",{x:prevPos.x,y:prevPos.y-prevHeight/2+item.height/2,z:prevPos.z})}}}};let dissapearBuildingAnimation=itemId=>{let oldColor=document.getElementById(itemId).getAttribute("material").color;document.getElementById(itemId).setAttribute("material",{color:"black"});document.getElementById(itemId).setAttribute("material",{opacity:"0.3"});let dissapearId=setInterval(function(){dissapearBuilding()},1e3);function dissapearBuilding(){let prevPos=document.getElementById(itemId).getAttribute("position");let prevHeight=document.getElementById(itemId).getAttribute("geometry").height;document.getElementById(itemId).setAttribute("geometry","height",-.1);document.getElementById(itemId).setAttribute("position",{x:prevPos.x,y:prevPos.y-prevHeight/2+-.1/2,z:prevPos.z});document.getElementById(itemId).setAttribute("material",{color:oldColor});document.getElementById(itemId).setAttribute("material",{opacity:"1.0"});clearInterval(dissapearId)}};let updateCity=()=>{console.log("Changing city")};let findLeafs=(data,entities)=>{data.forEach(item=>{if(item["children"]){findLeafs(item["children"],entities)}else{entities[item.id]=item}});return entities};let showLegendUiNavBar=i=>{let entities=document.getElementsByClassName("babiaxrTimeBar")[0].children;if(last_uinavbar||last_uinavbar==0){let pointToHide=entities[last_uinavbar];pointToHide.emit("removeinfo")}let pointToShow=entities[i];pointToShow.emit("showinfo")};function getNewBrightnessColor(rgbcode,brightness){let r=parseInt(rgbcode.slice(1,3),16),g=parseInt(rgbcode.slice(3,5),16),b=parseInt(rgbcode.slice(5,7),16),HSL=rgbToHsl(r,g,b),RGB;RGB=hslToRgb(HSL[0],HSL[1],brightness/100);rgbcode="#"+convertToTwoDigitHexCodeFromDecimal(RGB[0])+convertToTwoDigitHexCodeFromDecimal(RGB[1])+convertToTwoDigitHexCodeFromDecimal(RGB[2]);return rgbcode}function convertToTwoDigitHexCodeFromDecimal(decimal){let code=Math.round(decimal).toString(16);code.length>1||(code="0"+code);return code}function rgbToHsl(r,g,b){r/=255,g/=255,b/=255;let max=Math.max(r,g,b),min=Math.min(r,g,b);let h,s,l=(max+min)/2;if(max==min){h=s=0}else{let d=max-min;s=l>.5?d/(2-max-min):d/(max+min);switch(max){case r:h=(g-b)/d+(g<b?6:0);break;case g:h=(b-r)/d+2;break;case b:h=(r-g)/d+4;break}h/=6}return[h,s,l]}function hslToRgb(h,s,l){let r,g,b;if(s==0){r=g=b=l}else{function hue2rgb(p,q,t){if(t<0)t+=1;if(t>1)t-=1;if(t<1/6)return p+(q-p)*6*t;if(t<1/2)return q;if(t<2/3)return p+(q-p)*(2/3-t)*6;return p}let q=l<.5?l*(1+s):l+s-l*s;let p=2*l-q;r=hue2rgb(p,q,h+1/3);g=hue2rgb(p,q,h);b=hue2rgb(p,q,h-1/3)}return[r*255,g*255,b*255]}},function(module,exports,__webpack_require__){__webpack_require__(10);__webpack_require__(11);__webpack_require__(9);__webpack_require__(3);__webpack_require__(0);__webpack_require__(1);__webpack_require__(6);__webpack_require__(4);__webpack_require__(20);__webpack_require__(12);__webpack_require__(13);__webpack_require__(15);__webpack_require__(22);__webpack_require__(16);__webpack_require__(17);__webpack_require__(18);__webpack_require__(19);__webpack_require__(8);__webpack_require__(21);__webpack_require__(7);__webpack_require__(5);__webpack_require__(14);__webpack_require__(2)}]);
